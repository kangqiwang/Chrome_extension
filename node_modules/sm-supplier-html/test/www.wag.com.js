var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.wag.com/dog/p/wellness-core-original-recipe-natural-grain-free-dry-dog-food-original-26-lb-1256093?sku=WLP-026&qid=1827812701&sr=1-1"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Wellness CORE Original Recipe Natural Grain Free Dry Dog Food - Original - 26 lb",
                    "price": "58.48",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://c2.q-assets.com/images/products/p/wlp/wlp-026_1z.jpg',
                    "country": 'us',
                    "description": 'Grocery Products & Nutritional Supplements: These products are made primarily of natural ingredients with minimal processing. Natural ingredients are extracted directly from plants or animal products as opposed to being produced synthetically. These products do not contain any substances on our Banned Ingredients List.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

     describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "https://www.wag.com/search/food?s=food&ref=srbr_wa_unav"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "food"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "https://www.wag.com/search/food?s=food&ref=srbr_wa_unav"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 60,
                    "pages": 126
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.wag.com/search/food?s=food&ref=srbr_wa_unav"
        }

        // Change to be the number of products on the page
        var x = 56;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Original Recipe Natural Grain Free Dry Dog Food...';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '58.48',
                    url: 'https://www.wag.com/p/wellness-original-recipe-natural-grain-free-dry-dog-food-1256093?sku=WLP-026&qid=1827812701&sr=1-1',
                    image: 'https://c4.q-assets.com/images/products/WLP/WLP-026_med5a.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Healthy Weight Dry Dog Food - Chicken, Rice & B...';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '57.79',
                    url: 'https://www.wag.com/p/nature-s-recipe-healthy-weight-dry-dog-food-chicken-rice-b-1319086?sku=DMF-299&qid=1827812701&sr=1-60',
                    image: 'https://c4.q-assets.com/images/products/DMF/DMF-299_med5a.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
