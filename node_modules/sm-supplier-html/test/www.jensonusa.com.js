var should = require('should');
var Structure = require('../lib/structure.js')

describe('www.jensonusa.com', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.jensonusa.com/Bicycle-Components/Shimano-XT-M8000-Disc-Brake"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Shimano XT M8000 Disc Brake",
                    "price": "99.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://www.jensonusa.com/images/Default-Image/MobileImage/3/BR212C01.jpg',
                    "country": 'us',
                    "description": ' Shimano XT BR-M8000 Hydraulic Disc BrakeRiding comfortably at white-knuckle speeds requires an unconscious, intuitive confidence in your machine. It requires knowing that whatever conditions you come across, your brakes will be ready and able to deliver reliable control in any situation. Say hello to the XT M8000 Brakes, and say goodbye to compromise. The integration of Servo-Wave brake-boosting technology into XT brakes delivers gobs of lightweight stopping power.Where the M8000 steps up from the already industry-standard BR-M785B is through its upgraded, integrated master cylinder which sports a sleeker look, saves weight and frees up valuable handlebar real estate. It also gains a beautiful black finish that will upgrade the look of any bike.With ceramic pistons to increase power, reduce vibrations and shed performance-sapping heat, when coupled with innovative IceTech aluminum-core rotors (sold separately) to even further keep heat buildup at bay, the XT BR-M8000 brakes maintain cool, quiet performance under fire.Shimano XT BR-M8000 Hydraulic Disc Brake Features:Power level is specifically tuned for trail ridingServo Wave modulated levers offer high power and short stroke by varying pad speed throughout the lever strokeIntegrated master cylinder is lighter, cleaner and more durableRefined Servo Wave for improved feel and feedback, improved adjustabilityNarrow clamp band offers increased positional adjustmentFree stroke and tool-free reach adjustCeramic pistons for maximum heat insulationSpecifications:Model Number: BR-M8000Series: DEORE XT M8000Brake Pad Types: G02A Resin, J02 A Resin, G04S Metal, J04C MetalHydraulic Fluid: SHIMANO Mineral OilBrake Hose Type: SM-BH90-SBM High Power Brake HoseCaliper Mount Type: Hydraulic Disc BrakePiston Count: 2 (Dual)Pre-Bled (Bleed Kit sold Separately)Hose Length: Rear 1700mm, Front 1000mmI-Spec II CompatibleWeight: 277g / side '
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.jensonusa.com/Mountain-Bikes?by=Category"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 100,
                    "pages": 10
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.jensonusa.com/Backpacks?by=Category"
        }

        it('should be true when correct category is returned', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Backpacks"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.jensonusa.com/Bicycle-Components/MTB?by=Category"
        }

        // Change to be the number of products on the page
        var x = 24;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Shimano XT BR-M8000 Disc Brake';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '89.99',
                    url: 'http://www.jensonusa.com/Bicycle-Components/Shimano-XT-BR-M8000-Disc-Brake',
                    image: 'http://www.jensonusa.com/images/Default-Image/Gallery_Main/3/BR212C01.jpg',
                    country: 'us',
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Shimano J04C Metal Disc Brake Pads';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '19.99',
                    url: 'http://www.jensonusa.com/Bicycle-Components/Shimano-J04C-Metal-Disc-Brake-Pads',
                    image: 'http://www.jensonusa.com/images/Default-Image/Gallery_Main/1/BR208C00.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
