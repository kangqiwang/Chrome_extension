var should = require('should');
var Structure = require('../lib/structure.js')


describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.soap.com/p/charmin-ultra-soft-toilet-paper-mega-roll-12-pk-921265?sku=PG-7583&qid=2226520069&sr=1-2"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Charmin Ultra Soft Toilet Paper",
                    "price": "20.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://c1.q-assets.com/images/products/p/pg/pg-7583_1z.jpg',
                    "country": 'us',
                    "description": "Charmin Ultra Soft Toilet Paper 9 Mega Rolls = 36 Regular RollsGive your family the softness of Charmin Ultra Soft bath tissue! Its unique Comfort Cushions are soft and absorbent, giving you the softness you love. But it's not just soft: Charmin Ultra Soft 2-ply toilet paper is septic safe and strong, too—in fact, you can use 4X less*. That means the Charmin Ultra Soft softness can last even longer. We all go; those who go with Charmin Ultra Soft really Enjoy the Go. (*Vs. the Leading Bargain Brand.); Irresistibly soft & absorbent so you can use less* (*Vs. Basic); Unique Comfort Cushions; 2-ply toilet paper; 1 Mega Roll equals 4 Regular Rolls; Unscented and Septic Safe; Enjoy the Go with Charmin Ultra Soft Bath Tissue. Charmin Ultra Soft Toilet Paper 6 Mega Rolls = 24 Regular RollsGive your family the softness of Charmin Ultra Soft bath tissue! Its unique Comfort Cushions are soft and absorbent, giving you the softness you love. But it's not just soft: Charmin Ultra Soft 2-ply toilet paper is septic safe and strong, too—in fact, you can use 4X less*. That means the Charmin Ultra Soft softness can last even longer. We all go; those who go with Charmin Ultra Soft really Enjoy the Go. (*Vs. the Leading Bargain Brand.); Irresistibly soft & absorbent so you can use less* (*Vs. Basic); Unique Comfort Cushions; 2-ply toilet paper; 1 Mega Roll equals 4 Regular Rolls; Unscented and Septic Safe; Enjoy the Go with Charmin Ultra Soft Bath Tissue. Charmin Ultra Soft Toilet Paper 6 Double Rolls = 12 Regular RollsGive your family the softness of Charmin Ultra Soft bath tissue! Its unique Comfort Cushions are soft and absorbent, giving you the softness you love. But it's not just soft: Charmin Ultra Soft 2-ply toilet paper is septic safe and strong, too—in fact, you can use 4X less*. That means the Charmin Ultra Soft softness can last even longer. We all go; those who go with Charmin Ultra Soft really Enjoy the Go. (*Vs. the Leading Bargain Brand.); Irresistibly soft & absorbent so you can use less* (*Vs. Basic); Unique Comfort Cushions; 2-ply toilet paper; 1 Double Roll equals 2 Regular Rolls; Unscented and Septic Safe; Enjoy the Go with Charmin Ultra Soft Bath Tissue. Charmin Ultra Soft Toilet Paper 24 Double Rolls = 48 Regular RollsGive your family the softness of Charmin Ultra Soft bath tissue! Its unique Comfort Cushions are soft and absorbent, giving you the softness you love. But it's not just soft: Charmin Ultra Soft 2-ply toilet paper is septic safe and strong, too—in fact, you can use 4X less*. That means the Charmin Ultra Soft softness can last even longer. We all go; those who go with Charmin Ultra Soft really Enjoy the Go. (*Vs. the Leading Bargain Brand.); Irresistibly soft & absorbent so you can use less* (*Vs. Basic); Unique Comfort Cushions; 2-ply toilet paper; 1 Double Roll equals 2 Regular Rolls; Unscented and Septic Safe; Enjoy the Go with Charmin Ultra Soft Bath Tissue. Charmin Ultra Soft Toilet Paper 12 Mega Rolls = 48 Regular RollsGive your family the softness of Charmin Ultra Soft bath tissue! Its unique Comfort Cushions are soft and absorbent, giving you the softness you love. But it's not just soft: Charmin Ultra Soft 2-ply toilet paper is septic safe and strong, too—in fact, you can use 4X less*. That means the Charmin Ultra Soft softness can last even longer. We all go; those who go with Charmin Ultra Soft really Enjoy the Go. (*Vs. the Leading Bargain Brand.); Irresistibly soft & absorbent so you can use less* (*Vs. Basic); Unique Comfort Cushions; 2-ply toilet paper; 1 Mega Roll equals 4 Regular Rolls; Unscented and Septic Safe; Enjoy the Go with Charmin Ultra Soft Bath Tissue. Charmin Ultra Soft Toilet Paper 12 Double Rolls = 24 Regular RollsGive your family the softness of Charmin Ultra Soft bath tissue! Its unique Comfort Cushions are soft and absorbent, giving you the softness you love. But it's not just soft: Charmin Ultra Soft 2-ply toilet paper is septic safe and strong, too—in fact, you can use 4X less*. That means the Charmin Ultra Soft softness can last even longer. We all go; those who go with Charmin Ultra Soft really Enjoy the Go. (*Vs. the Leading Bargain Brand.); Irresistibly soft & absorbent so you can use less* (*Vs. Basic); Unique Comfort Cushions; 2-ply toilet paper; 1 Double Roll equals 2 Regular Rolls; Unscented and Septic Safe; Enjoy the Go with Charmin Ultra Soft Bath Tissue. ,,, Charmin Ultra Soft Toilet Paper - Big Roll - 9 pkCharmin Ultra Soft toilet paper is the softer way to get clean and use less. It has comfort cushions that are softer and 75% more absorbent. You can use up to 4X less than the leading bargain brand. Charmin Ultra Soft toilet paper is 2-ply and also septic-safe. We all go to the bathroom, those who go with Charmin Ultra Soft toilet paper really Enjoy the Go! (vs. leading bargain brand)Pack contains 9 Big Rolls (121 sheets per roll) of Charmin Ultra Soft toilet paperThe softer way to get clean and use less vs. the leading bargain brandOur softest 2-ply toilet paperClog-safe and septic-safe; Roto-Rooter approvedUnique comfort cushion design you can seeSafety:To avoid danger of suffocation, keep this bag away from babies and children. • Made in the USA"
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "https://www.soap.com/search/soap?s=soap&ref=srbr_so_unav"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 60,
                    "pages": 1098
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.soap.com/search/soap?s=soap&ref=srbr_so_unav"
        }

        // Change to be the number of products on the page
        var x = 60;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Method Kitchen Hand Wash - Lemongrass';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '5.39',
                    url: 'https://www.soap.com/p/method-kitchen-hand-wash-lemongrass-1157042?sku=ME-108&sr=1-1&pf_rd_r=YD47HNFRDB7YPA3105D8&pf_rd_p=77cae5b9-7769-435c-ad9f-ee758d48dfd5',
                    image: 'https://c3.q-assets.com/images/products/ME/ME-108_med5a.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Seventh Generation Dishwasher Detergent Gel - Free & Clear - 42 oz';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '10.11',
                    url: 'https://www.soap.com/p/seventh-generation-dishwasher-detergent-gel-free-clear-42-oz-5546?sku=SG-108&qid=2226520069&sr=1-59',
                    image: 'https://c3.q-assets.com/images/products/SG/SG-108_med5a.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "https://www.soap.com/subcat=Body-Washes-Soaps-10661?pf_rd_r=QAFJNS5WGBFQYVWN981K&pf_rd_p=27096c5d-786a-40a3-a740-3aff0edf9260&ref=s_bro_tcrc5_qhpbc"
        }

        it('should be true when the category is correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Body Washes & Soaps"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

});
