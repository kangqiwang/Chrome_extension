var should = require('should');
var Structure = require('../lib/structure.js')
const cache = require('../lib/cache')


describe('www.blinq.com', function() {


    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.blinq.com/detail/home-garden/home-supplies-cleaning/cleaning-supplies/evercare-professional-lint-pic-up-roller-dry-cleaner-grade/657374?condition=brand-new",
            "html" : cache.load("https://www.blinq.com/detail/home-garden/home-supplies-cleaning/cleaning-supplies/evercare-professional-lint-pic-up-roller-dry-cleaner-grade/657374?condition=brand-new")
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(err, inStockPage) {
                var expected = JSON.stringify({
                    "name": "Evercare Professional Lint Pic-Up Roller - Dry Cleaner Grade",
                    "price": "5.99",
                    "url": payload.url,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'https://inventory-photos-1.global.ssl.fastly.net/1762564/two_fifty/56290196gnrkiuL.UL500.jpg.jpg?1449501502',
                    "country": 'us'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });


    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "https://www.blinq.com/cat/home-garden/home-supplies-cleaning/cleaning-supplies/" ,
            "html" : cache.load("https://www.blinq.com/cat/home-garden/home-supplies-cleaning/cleaning-supplies/")
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(err, category) {
                var expected = JSON.stringify({
                    "name": "Cleaning Supplies",
                    "url" : "https://www.blinq.com/cat/home-garden/home-supplies-cleaning/cleaning-supplies/"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.blinq.com/cat/home-garden/tools-home-improvement/power-tools-accessories/",
            "html" : cache.load("https://www.blinq.com/cat/home-garden/tools-home-improvement/power-tools-accessories/")
        }

        // Change to be the number of products on the page
 // Change to be the number of products on the page
 var x = 7;
 it('should return ' + x + ' numer of products', function () {
     let result = Structure(payload)
     result.length.should.equal(x);
 });

 var firstProductName = 'Critters Go For A Ride 100 Large Piece Jigsaw Puzzle';
 it('first product should be ' + firstProductName, function() {

     var expected = JSON.stringify({
         barcode: null,
         name: firstProductName,
         price: '4.99',
         url: 'http://www.bitsandpieces.com/product/critters-go-for-a-ride-100-large-piece-jigsaw-puzzle-42777',
         image: 'https://s3.amazonaws.com/cdn.bitsandpieces.com/images/160/42777.jpg',
         country: 'us'
     })
     
     let result = Structure(payload)

     var first = result.shift()
     
     JSON.stringify(first).should.equal(expected)

 })

 var lastProductName = 'Soccer Sliding Wooden Puzzle';
 it('last product should be ' + lastProductName, function () {
     var expected = JSON.stringify({
         barcode: null,
         name: lastProductName,
         price: '14.99',
         url: 'http://www.bitsandpieces.com/product/soccer-sliding-wooden-puzzle',
         image: 'https://s3.amazonaws.com/cdn.bitsandpieces.com/images/160/43952.jpg',
         country: 'us'
     })

     const result = Structure(payload);

     var last = result.pop()
     JSON.stringify(last).should.equal(expected)
 })

}); 

});
