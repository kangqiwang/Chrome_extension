var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.theshoemart.com/alden-mens-alden-fine-shoe-paste-wax-color-8"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Alden Men's Alden Fine Shoe Paste Wax Color 8",
                    "price": "5.50",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://www.theshoemart.com/media/catalog/product/cache/1/thumbnail/900x/9df78eab33525d08d6e5fb8d27136e95/1/d/1d_wax_color_8_cordovan_1.jpg',
                    "country": 'us',
                    "description": 'The Alden Fine Shoe Paste Wax in Color 8 helps condition and seal your leather shoes. Ideal for Alden Color 8 Shell Cordovan shoes and boots, Alden Fine Shoe Paste Wax can buff your shoes to a high shine. Instructions: "Remove dust and dirt from shoes. Apply Alden Paste Wax with cloth. Allow to dry. Polish with brush. Finish with soft, clean cloth." Alden Fine Shoe Paste Wax Ideal for Alden Color 8 Shell Cordovan shoes and boots Conditions and seals leather Color 8 (Burgundy) color'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.theshoemart.com/mens-shoes?limit=48"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 48,
                    "pages": 23
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.theshoemart.com/mens-shoes?limit=48"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Men's"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.theshoemart.com/mens-shoes?limit=48"
        }

        // Change to be the number of products on the page
        var x = 48;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Alden Men\'s Alden Fine Shoe Paste Wax Color 8';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '5.50',
                    url: 'http://www.theshoemart.com/alden-mens-alden-fine-shoe-paste-wax-color-8',
                    image: 'http://www.theshoemart.com/media/catalog/product/cache/1/thumbnail/500x/602f0fa2c1f0d1ba5e241f914e856ff9/1/d/1d_wax_color_8_cordovan_1.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Sperry Top-Sider Men\'s Authentic Original 2-Eye';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '79.95',
                    url: 'http://www.theshoemart.com/sperry-top-sider-mens-authentic-original-2-eye-ice-0195149',
                    image: 'http://www.theshoemart.com/media/catalog/product/cache/1/thumbnail/500x/602f0fa2c1f0d1ba5e241f914e856ff9/1/d/1d_0195149_1.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
