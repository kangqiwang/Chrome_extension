var should = require('should');
var Structure = require('../lib/structure.js')
const cache = require('../lib/cache')

describe('replaceWithwebAddress', function() {


    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.samsclub.com/sams/60-120hz-led-smart-1080p-3-hdmi/prod17180594.ip"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "VIZIO 60\" Class 1080p LED Smart HDTV - E60-C3",
                    "price": "648.00",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": "http://scene7.samsclub.com/is/image/samsclub/0084522601185_A?$img_size_380x380$",
                    "country": "us",
                    "description": 'HD Entertainment in Brilliant 1080p The VIZIO 60" Class 1080p LED Smart HDTV comes loaded with the hottest entertainment apps, including Netflix, Amazon Instant Video, iHeartRadio, Hulu Plus, Spotify, YouTube and more. 1080p Full HD resolution delivers a crystal-clear picture, and built-in high-speed Wi-Fi gets you connected in a snap. Full-array LED backlighting offers superior light uniformity, and up to 12 Active LED Zones™ produce vivid colors with deep, pure black levels. Clear Action 240 combines powerful image processing with a 120Hz effective refresh rate for enhanced detail in action-packed, fast-moving scenes.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.samsclub.com/sams/70-1080p-smart-120hz-5-hdmi-wifi/prod20062126.ip?xid=plp1088-elec:product:1:15"
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": 'Vizio 70" Class 1080P LED Smart TV - D70-D3',
                    "price": "988.00",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": "http://scene7.samsclub.com/is/image/samsclub/0084522604359_A?$img_size_380x380$",
                    "country": "us",
                    "description": "The all-new 2016 D-series 70” full-array LED Smart TV has arrived. Featuring brilliant picture quality, and a faster, easier-to-use smart TV experience, VIZIO’s 2016 D-series brings you premium HD entertainment at an incredible value. Full-array LED backlighting and 12 Active LED Zones produce deeper black levels and brighter colors that makes your favorite shows more vibrant and beautiful."
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });
    

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.samsclub.com/sams/new-toys/7230148.cp"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 48,
                    "pages": 2
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.samsclub.com/sams/new-toys/7230148.cp"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "New Toys"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.samsclub.com/sams/tvs-lcd-tv-led-tv-and-plasma-tv-screens/1088.cp?xid=cat1087-elec:carousel-featured-categories:2:1",
            "html": cache.load("https://www.samsclub.com/sams/tvs-lcd-tv-led-tv-and-plasma-tv-screens/1088.cp?xid=cat1087-elec:carousel-featured-categories:2:1")

        }

        // Change to be the number of products on the page
        var x = 22;
        it('should return ' + x + ' numer of products', function () {
            let result = Structure(payload)
            result.length.should.equal(x);
        });

        var firstProductName = 'Marley Pug Pop Over Phone Case';
        it('first product should be ' + firstProductName, function() {

            var expected = JSON.stringify({
                barcode: null,
                name: firstProductName,
                price: '4.80',
                url: 'https://www.claires.com/marley-pug-pop-over-phone-case-229291M.html?cgid=168&lang=en_GB',
                image: 'https://www.claires.com/dw/image/v2/BBTK_PRD/on/demandware.static/-/Sites-master-catalog/default/dw3b322a6b/images/hi-res/98823_1.jpg?sw=290&sh=290&sm=fit',
                country: 'us'
            })
            
            let result = Structure(payload)

            var first = result.shift()
            
            JSON.stringify(first).should.equal(expected)

        })

        var lastProductName = 'Rainbow Marble with Gold Foil Flakes Phone Case';
        it('last product should be ' + lastProductName, function () {
            var expected = JSON.stringify({
                barcode: null,
                name: lastProductName,
                price: '4.80',
                url: 'https://www.claires.com/rainbow-marble-with-gold-foil-flakes-phone-case-230461.html?cgid=168&lang=en_GB',
                image: 'https://www.claires.com/dw/image/v2/BBTK_PRD/on/demandware.static/-/Sites-master-catalog/default/dw7ad4ce93/images/hi-res/23509_1.jpg?sw=290&sh=290&sm=fit',
                country: 'us'
            })

            const result = Structure(payload);

            var last = result.pop()
            JSON.stringify(last).should.equal(expected)
        })

    }); 

});
