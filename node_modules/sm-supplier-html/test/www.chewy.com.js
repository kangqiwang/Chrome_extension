var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.chewy.com/blue-buffalo-life-protection-formula/dp/32041"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Blue Buffalo Life Protection Formula Adult Chicken & Brown Rice Recipe Dry Dog Food",
                    "price": "45.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://d1rgby1m7uuvjr.cloudfront.net/is/catalog/46861._AC_SL1500_V1460478783_.jpg',
                    "country": 'us',
                    "description": 'Blue Buffalo Life Protection Formula was created for the health and well-being of dogs. All formulas start with real meat, whole grains, garden veggies and fruit, plus added LifeSource Bits, a precise blend of nutrients that have been enhanced with a Super 7 package of antioxidant-rich ingredients. This Adult Chicken & Brown Rice Recipe features delicious, protein-rich deboned chicken and other natural ingredients for a healthy meal your dog will love. Key Benefits Essential, high-quality protein for healthy muscle development and carbs for energy for an active life Calcium, phosphorus and essential Vitamins for strong bones and teeth Glucosamine for joint health and mobility Vitamins, chelated minerals and antioxidants for immune system health No corn, wheat, soy or chicken (or poultry) by-product meals See all items by Blue Buffalo'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "https://www.chewy.com/s?query=adult&nav-submit-button="
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 36,
                    "pages": 260
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "https://www.chewy.com/b/dry-food-294"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Dry Dog Food"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.chewy.com/s?query=adult&nav-submit-button="
        }

        // Change to be the number of products on the page
        var x = 36;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Blue Buffalo Life Protection Formula Adult Chicken & Brown Rice Recipe Dry Dog Food, 30-lb bagâ€¦';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '45.99',
                    url: 'https://www.chewy.com/blue-buffalo-life-protection-formula/dp/32041',
                    image: 'https://d1rgby1m7uuvjr.cloudfront.net/is/catalog/46861._AC_SS190_V1460478783_.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Wellness Complete Health Adult Deboned Chicken & Oatmeal Recipe Dry Dog Food, 30-lb bag';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '49.48',
                    url: 'https://www.chewy.com/wellness-complete-health-adult/dp/34361',
                    image: 'https://d1rgby1m7uuvjr.cloudfront.net/is/catalog/49180_MAIN._AC_SS190_V1477926075_.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
