var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.michaels.com/10225629.html"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Wilton® Decorator Preferred Decorating Set™",
                    "price": "99.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://img.michaels.com/L6/3/IOGLO/820084525/179000240/10225629_1.jpg?fit=inside|1024:1024',
                    "country": 'us',
                    "description": 'Creating beautiful party cakes has never been easier! Stored inside this caddy, you’ll find all the essential tools for decorating with buttercream and royal icings. 16 decorating tips are included in round, star, basket weave, leaf, petal, drop flower, multi-opening, and bismarck shapes. Details:Caddy measures 8.25" x 16.25" x 6.25"Great valueContents:48 piece set16 decorating tips2 angled spatulas4 standard couplers2 Bake-Even StripsDecorating bagsFlower nailTip brushFlower lifter6 silicone tip covers'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.michaels.com/baking-and-party/baking/845009276?pmpt=qualifying&sz=72"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 72,
                    "pages": 11
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.michaels.com/baking-and-party/baking/845009276?pmpt=qualifying&sz=72"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Baking"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.michaels.com/baking-and-party/baking/845009276?pmpt=qualifying&sz=72"
        }

        // Change to be the number of products on the page
        var x = 72;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Wilton® Decorator Preferred Decorating Set™';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '99.99',
                    url: 'http://www.michaels.com/10225629.html',
                    image: 'http://img.michaels.com/L6/3/IOGLO/820084525/179000240/10225629_1.jpg?fit=inside|220:220',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Wilton® Featherweight® Decorating Bag';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '6.49',
                    url: 'http://www.michaels.com/wilton-featherweight-decorating-bag/M10051297.html',
                    image: 'http://img.michaels.com/L6/3/IOGLO/820079073/178997140/10051301_1.jpg?fit=inside|220:220',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
