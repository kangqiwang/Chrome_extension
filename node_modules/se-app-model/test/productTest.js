const should = require('should');
const ProductModel = require('../index.js').model.product;

const config = require('../config').es;

describe('Product Test', function() {

        this.timeout(10000);

        it('should return us  products', function(done) {
                var Product = new ProductModel(config, 'us')

                Product.find({}, (err, result) => {
                    should(err).be.equal(null)
                    result.should.have.property('total')
                    result.should.have.property('records')
                    result.total.should.be.above(0)
                    result.records.length.should.be.above(0)
                    done();
                })

        })

        xit('should return us Amazon product', function(done) {
                var Product = new ProductModel(config, 'us');

                Product.findAmazon({
                        id: 'B008JFUO72'
                }, (err, result) => {
                    console.log('result: ', result);
                    should(err).be.equal(null)
                    result.should.have.property('asin')
                    result.asin.should.be.equal('B008JFUO72')
                    done();
                })

        })

         it('should return NOT_FOUND Amazon product not in the db', function(done) {
                var Product = new ProductModel(config, 'us')

                Product.findAmazon({
                    id: 'B008JFUO72d'
                }, (err, result) => {
                    should(err).be.equal('NOT_FOUND')
                    should(result).be.equal(undefined)
                    done();
                })

        })



         xit('should save us Amazon product', function(done) {
                var Product = new ProductModel(config, 'us')

                Product.saveAmazon({
                      data: {
                        my: "data"
                      }
                }, (err, result) => {
                    should(err).be.equal(null)
                    done();
                })

        })

        xit('should Save us Supplier product', function(done) {
                var Product = new ProductModel(config, 'us')

                Product.saveSupplier({
                      name: 'Product Name',
                      url: 'http://www.tesco.com/newProduct/3434',
                      data: {
                        my: "data"
                      }
                }, (err, result) => {
                    should(err).be.equal(null)
                    done();
                })

        })

        xit('should Return us Supplier product', function(done) {
                var Product = new ProductModel(config, 'us')

                Product.findSupplier({
                      url: 'http://www.tesco.com/newProduct/3434',
                      name: "Product Name"
                }, (err, result) => {
                    should(err).be.equal(null)
                    Product.close()
                    done();
                })

        })

        xit('should update the Amazon Delta', (done) => {
            var payload = {
                salesRank: '11111',
                category: 'home_garden_display_on_website',
                competitivePricing: '30.99',
                asin: 'B008JFUO72'
            }

            var Product = new ProductModel(config, 'us')
            Product.updateAmazonDelta(payload, (err, result) => {

                done();
            })
        })

        xit('Should check for description and add a description if no description is found', function(done){
            var Product = new ProductModel(config, 'us')

            Product.findSupplier({
                      url: 'http://www.tesco.com/newProduct/3434',
                      name: "Product Name"
                }, (err, result) => {
                    should(err).be.equal(null)
                    result.should.have.property('description')
                    result.description.should.be.equal('Home shopping for less with Tesco. Browse online for everything from groceries and recipes to homeware, electricals, Clubcard and more. Every Little Helps.')
                    done();
                })

        })

})
