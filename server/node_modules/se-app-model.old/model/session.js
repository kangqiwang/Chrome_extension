const Base = require('../lib/mongo/base')
const splitArrIntoSmallerBits = require('../lib/splitArrIntoSmallerBits')
const SearchModel = require('./search.js')
const async = require('async')
const mongodb = require('mongodb')
const url = require('url')

class Session extends Base {

    constructor(config) {
        super(config, 'sessions')
    }

    findUserSession(sessionId, next) {
        this.findOne({
           _id: sessionId
        }, (err, result) => {
            if(err) {
                next(err)
            } else {
                if(result) {
                    try {
                        var s = JSON.parse(result.session);
                        s.passport.user.userName = s.passport.user.userName.toLowerCase();
                        next(null, s)
                    } catch(e) {
                        next(e)
                    }
                } else {
                    next('SESSION_NO_FOUND')
                }

            }
        })
    }

}


module.exports = Session