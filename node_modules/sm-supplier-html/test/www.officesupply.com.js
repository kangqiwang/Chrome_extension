var should = require('should');
var Structure = require('../lib/structure.js');
const cache = require('../lib/cache')

describe('www.officesupply.com', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.officesupply.com/technology/printers-multifunction-printing-supplies/multifunction/multifunction-machines/brother-9330cdw-multifunction-printer/p342392.html",
            "html": cache.load("https://www.officesupply.com/technology/printers-multifunction-printing-supplies/multifunction/multifunction-machines/brother-9330cdw-multifunction-printer/p342392.html")
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(err, inStockPage) {
                var expected = JSON.stringify({
                    "name": "Brother MFC-9330CDW LED Multifunction Printer",
                    "price": "468.23",
                    "url": payload.url,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'https://de2wfhoo6xqi5.cloudfront.net/size/300/537/1de/6e8332973d3189a5d65ae464e8c705bfd3.jpg',
                    "country": 'us',
                    "description": "Brother MFC-9330CDW LED Multifunction Printer - Digital wireless multifunction printer is an ideal choice for the small business looking for a fast, reliable color all-in-one with duplex (two-sided) printing. Compact design is packed with big business features like a 3.7 color touch screen and wireless networking. Print and copy high-impact color and crisp black documents at up to 23 pages per minute with up to 600 x 2400 dpi resolution as well as fax and scan with up to 19200 x 19200 dpi. You can also wirelessly print from your mobile device via AirPrint, Google Cloud Print, Brother iPrint&Scan, Cortado Workplace and Wi-Fi Direct. Built-in wireless and Ethernet network interfaces install on a wired or wireless network or connect locally to a single computer via USB. Use the Secure Function Lock feature to restrict color printing for up to 25 users. MFC-9330CDW printer also offers USB Direct Interface, 192MB memory, 33.6Kbps Super G3 Fax Modem, 35-page auto feeder and 250-sheet input tray. Energy Star qualified.\""
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.officesupply.com/office-supplies/writing-correction/correction-supplies-erasers/correction-tapes/wite-refill-correction-tape-refill/p101948.html",
            "html": cache.load("https://www.officesupply.com/office-supplies/writing-correction/correction-supplies-erasers/correction-tapes/wite-refill-correction-tape-refill/p101948.html")
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(err, inStockPage) {
                var expected = JSON.stringify({
                    "name": "Wite-Out EZ Refill Correction Tape & Refill",
                    "price": "",
                    "url": payload.url,
                    "inStock": false,
                    "stockLevel": null,
                    "image": 'https://de2wfhoo6xqi5.cloudfront.net/size/300/27d/bb7/2d5f0572e690df4671e0ae26ab41fce16e.jpg',
                    "country": 'us',
                    "description": 'Wite-Out EZ Refill Correction Tape & Refill - Easy-to-use refill system for BICÂ® correction tape dispensers. Applies smooth and even for complete coverage. Durable tape is tear-resistant.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Search page pagination', function() {

    //     var payload = {
    //         "pageType" : "pagination",
    //         "url" : ""
    //     }

    //     it('should be true when number of items and pages correct', function (done) {

    //         Structure(payload, function(pagination) {
    //             var expected = JSON.stringify({
    //                 "items": "",
    //                 "pages": ""
    //             })
    //             JSON.stringify(pagination).should.equal(expected);
    //             done()
    //         })
    //     });

    // })

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.officesupply.com/office-supplies/paper-pads/cards-stationery/business-cards/c113444.html",
            "html": cache.load("https://www.officesupply.com/office-supplies/paper-pads/cards-stationery/business-cards/c113444.html")
        }

        // Change to be the number of products on the page
        var x = 24;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(err, result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Avery Business Cards Avery Printable Microperf Business Cards, Laser, 2 x 3 1/2, White, Uncoated, 2500/Box';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(err, result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '66.33',
                    url: 'https://www.officesupply.com/office-supplies/paper-pads/cards-stationery/business-cards/avery-business-cards/p4152.html?q=',
                    image: 'https://de2wfhoo6xqi5.cloudfront.net/size/200/0a5/60a/9f5fe51959dceb30ad048cae1a9546ae7a.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Avery Clean Edge Business Cards Avery Clean Edge Business Card Value Pack, Laser, 2 x 3 1/2, White, 2000/Box';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(err, result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '93.68',
                    url: 'https://www.officesupply.com/office-supplies/paper-pads/cards-stationery/business-cards/avery-clean-edge-business-cards/p4146.html?q=',
                    image: 'https://de2wfhoo6xqi5.cloudfront.net/size/200/ae9/247/35c8319aa0ea382784aeed1dbf3ce56b92.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });
      describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "https://www.officesupply.com/technology/printers-multifunction-printing-supplies/multifunction/multifunction-machines/c114260.html",
            "html": cache.load("https://www.officesupply.com/technology/printers-multifunction-printing-supplies/multifunction/multifunction-machines/c114260.html")
        }

        it('should be true when the category is correct', function (done) {

            Structure(payload, function(err, category) {
                var expected = JSON.stringify({
                    "name": "Multifunction/All-in-One Machines",
                    "url":"https://www.officesupply.com/technology/printers-multifunction-printing-supplies/multifunction/multifunction-machines/c114260.html"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

});
