var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.repairclinic.com/PartDetail/Washing-Machine-Motor-Coupling/285753A/1195967?ss=a11&mr=0"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Washing Machine Motor Coupling 285753A",
                    "price": "8.60",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'https://www.rcappliancepartsimages.com/dbImages/i/00003423/Motor-Coupling-285753A-01029880.jpg',
                    "country": 'us',
                    "description": 'Washer drive motor coupler. New style with metal sleeves for added strength. This version replaces all previous motor coupler styles and versions. For direct drive washing machines. Common symptom of failed coupler is washer will fill, not agitate or spin but will drain the water from the tub.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "https://www.repairclinic.com/Shop-For-Parts/a11/Washing-Machine-Parts"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 50,
                    "pages": 10
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "https://www.repairclinic.com/Shop-For-Parts/a11/Washing-Machine-Parts"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Washing Machine Parts"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.repairclinic.com/Shop-For-Parts/a11/Washing-Machine-Parts"
        }

        // Change to be the number of products on the page
        var x = 50;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Washing Machine Motor Coupling';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '8.60',
                    url: 'https://www.repairclinic.com/PartDetail/Washing-Machine-Motor-Coupling/285753A/1195967?ss=a11&mr=0',
                    image: 'https://www.rcappliancepartsimages.com/dbImages/i/00003423/Motor-Coupling-285753A-01029882.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Washing Machine Shipping Bolt';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '5.95',
                    url: 'https://www.repairclinic.com/PartDetail/Washing-Machine-Shipping-Bolt/FAA31690704/3287753?ss=a11&mr=0',
                    image: 'https://www.rcappliancepartsimages.com/dbImages/i/00005886/Shipping-Bolt-FAA31690704-01875441.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
