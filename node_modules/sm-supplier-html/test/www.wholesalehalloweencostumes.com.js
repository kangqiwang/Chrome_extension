var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.wholesalehalloweencostumes.com/products/deluxe-velvet-xxl-santa-suit?via=5743170f69702d4920000b7c%2C57431af669702d4920000be9"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Deluxe Velvet XXL Santa Suit",
                    "price": "69.90",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'https://wholesalehalloweencostumes-weblinc.netdna-ssl.com/product_images/deluxe-velvet-xxl-santa-suit/580b373769702d2019015066/detail.jpg?c=1482421854',
                    "country": 'us',
                    "description": 'Make other guests\' believe that you rode a sleigh to the party by showing up in the Deluxe Velvet Santa Suit! This high quality costume is guaranteed to get everyone in the holiday spirit and will help you look like you\'ve flown straight from the North Pole. The pants and jacket come in a bright shade of red and are trimmed with white plush that\'s super soft to the touch. You will also receive a black belt, boot covers in the same color so you can wear the shoes of your choice and a matching hat. If you\'re taking part in a Christmas play or dressing up for the kids at a family celebration, make your costume even more realistic by adding accessories such as a curly white beard, toy sack, bell and thin framed glasses, all of which are sold separately on our site. Product Number: 13077FZ Item Attribute Seasons: CHRISTMAS Gender: M'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "https://www.wholesalehalloweencostumes.com/categories/mens-new-arrivals?via=5743170f69702d4920000b7c%2C57431af669702d4920000be9"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 24,
                    "pages": 10
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "https://www.wholesalehalloweencostumes.com/categories/mens-new-arrivals?via=5743170f69702d4920000b7c%2C57431af669702d4920000be9"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Men's Costumes"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.wholesalehalloweencostumes.com/categories/mens-new-arrivals?via=5743170f69702d4920000b7c%2C57431af669702d4920000be9"
        }

        // Change to be the number of products on the page
        var x = 24;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Deluxe Velvet XXL Santa Suit';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '69.90',
                    url: 'https://www.wholesalehalloweencostumes.com/products/deluxe-velvet-xxl-santa-suit?via=5743170f69702d4920000b7c%2C57431af669702d4920000be9',
                    image: 'https://wholesalehalloweencostumes-weblinc.netdna-ssl.com/product_images/deluxe-velvet-xxl-santa-suit/580b373769702d2019015066/large_thumb.jpg?c=1482421854',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Adult Santa Suit Disposable';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '7.90',
                    url: 'https://www.wholesalehalloweencostumes.com/products/adult-santa-suit-disposable?via=5743170f69702d4920000b7c%2C57431af669702d4920000be9',
                    image: 'https://wholesalehalloweencostumes-weblinc.netdna-ssl.com/product_images/adult-santa-suit-disposable/57b6d52669702d65f2005df0/large_thumb.jpg?c=1471599910',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
