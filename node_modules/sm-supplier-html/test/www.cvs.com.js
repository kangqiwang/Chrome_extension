var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.cvs.com/shop/diet-nutrition/weight-loss/weight-loss-supplements/nature-s-bounty-l-carnitine-400mg-and-ala-200mg-capsules-30ct-prodid-1010595"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Nature's Bounty L-Carnitine 400mg and ALA 200mg Capsules, 30CT",
                    "price": "16.79",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://www.cvs.com/bizcontent/merchandising/productimages/large/7431266070.jpg',
                    "country": 'us',
                    "description": "Details Nature's Bounty L-Carnitine 400mg and ALA 200mg Capsules, 30CT Health Goals Supported by This Product Energy & Alertness Want to feel energized and alert? Discover how vitamins and supplements may help. Learn More Acetyl L-carnitine and alpha lipoic acid unite in this healthy aging formula to help protect your body against the cell damaging effects of free radicals. These capsules also support energy metabolism. Thank You Is the information in this section helpful? Yes / No Overview Acetyl L-Carnitine 400 mg & ALA 200 mg, 30 Capsules Acetyl L-carnitine and alpha lipoic acid (ALA) unite in this healthy-aging formula to help fight against the cell-damaging effects of free radicals.* These capsules also support brain energy metabolism.*What's in Box Acetyl L-Carnitine 400 mg & ALA 200 mg, 30 Capsules At a Glance: Exceptional antioxidant support* Contributes to energy metabolism* Supports nervous system health* Promotes Metabolic Functioning to Fight Free Radicals* The combination of alpha lipoic acid and acetyl L-carnitine can be part of your healthy approach to growing older.* Together, ALA and acetyl L-carnitine help promote metabolic functioning to fight against free radicals and oxidative stress.* ALA also supports nervous system health.* General Wellness Everyone wants to live a healthier life. Nature's Bounty general wellness supplements give you the nutritional support you need to maintain a general wellness.* *These statements have not been evaluated by the Food and Drug Administration. This product is not intended to diagnose, treat, cure, or prevent any disease. The information above is powered by Ingredients Other Ingredients: Gelatin, Vegetable Magnesium Stearate, Vegetable Cellulose. Contains <2% of: Acacia Gum, Titanium Dioxide Color. Nutritional Facts Serving Size: 1capsule Servings Per Container: 30 Nutrient Amount per Serving % Daily Value Flavor Alpha Lipoic Acid 200 mg Acetyl L-Carnitine (as Acetyl L-Carnitine Hydrochloride) 400 mg Directions For adults, take one (1) capsule four times daily, preferably with meals. Warnings If you are pregnant, nursing, taking any medications or have any medical condition, consult your doctor before use. Discontinue use and consult your doctor if any adverse reactions occur. Keep out of reach of children. Store at room temperature. Do not use if seal under cap is broken or missing."
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.cvs.com/search/N-0?pt=product&searchTerm=energ"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 100,
                    "pages": 18
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })


    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.cvs.com/shop/diet-nutrition/protein/N-3tZaxo0whZ2k?WT.ac=Shop-Home-LeftNav-Dept-DietNutrition"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Protein"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    })

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.cvs.com/search/N-0?pt=product&searchTerm=energ"
        }

        // Change to be the number of products on the page
        var x = 100;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = "Nature's Bounty L-Carnitine 400mg and ALA 200mg Capsules, 30CT";
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '16.79',
                    url: 'http://www.cvs.com/shop/diet-nutrition/weight-loss/weight-loss-supplements/nature-s-bounty-l-carnitine-400mg-and-ala-200mg-capsules-30ct-prodid-1010595',
                    image: 'http://www.cvs.com/bizcontent/merchandising/productimages/small/7431266070.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = "AnuMed International e-HGH Liquid";
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '51.99',
                    url: 'http://www.cvs.com/shop/vitamins/health-goals/energy-alertness/anumed-international-e-hgh-liquid-prodid-1070645',
                    image: 'http://www.cvs.com/bizcontent/merchandising/productimages/small/85550100350.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
