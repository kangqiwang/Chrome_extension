var should = require('should');
var Structure = require('../lib/structure.js')

describe('www.maplin.com', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.maplin.co.uk/p/seagate-expansion-1tb-portable-hard-drive-usb-30-a17kk"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Seagate Expansion 1TB Portable Hard Drive - USB 3.0",
                    "price": "47.99",
                    "url": payload.url,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://images.maplinmedia.co.uk/seagate-expansion-1tb-portable-hard-drive-usb-30.jpg?w=283&h=283&r=4&o=r0PMTWnljGwpR5Wx1eh31p9eXfYj&V=pp6n',
                    "country": 'uk',
                    "description": '•1TB portable hard drive gives you a large storage capacity for all your documents, pictures and videos•USB 3.0 (SuperSpeed) connections can transfer up to 10 times faster than USB 2.0, while the drive spins at 5,400rpm •Perfect for storing all your valuable documents and pictures as a backup•USB powered and small enough to fit in your hand makes this a great portable drive•Manufacturer code: STEA1000400What can I store on this hard drive?This hard drive has 1TB (1,000GB) of storage, so you have plenty of space for your files. You can store up to 7.75 hours of 4K video at 30fps, 33 hours of 1080p video at 30fps, 250 two-hour DVD films, 320,000 digital photos or 16,300 hours of digital music.Why should I choose a portable drive?This portable drive is great if you are constantly on the move or you need a space saving design. As it’s powered by USB you can connect it to any computer or newer smart TV with a USB port.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.maplin.co.uk/p/microsoft-800-wireless-keyboard-n93nt"
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Microsoft 800 Wireless Keyboard",
                    "price": "13.50",
                    "url": payload.url,
                    "inStock": false,
                    "stockLevel": null,
                    "image": 'http://images.maplinmedia.co.uk/microsoft-800-wireless-keyboard.jpg?w=283&h=283&r=4&o=W7MrxgUNRppyuIQ$4Z$e4lOyfJEj&V=$$dy',
                    "country": 'uk',
                    "description": '•Wireless 2.4GHz keyboard for a reliable connection •Low profile keys for comfortable typing•Full sized keyboard with number pad - great for your PC•Compatible with Windows and Mac •Comes with programmable hot keys and multimedia keys•Powers from two AAA batteries (included)What advantages does this keyboard have?Free your typing with this 2.4GHz full sized wireless keyboard. Comfortable to use with number pad and quiet touch keys it’s perfect to use with your home or work computer.  With a sleek black face and a spill resistant design this keyboard is compatible with Windows and Mac. The wireless 800 keyboard powers itself from two AAA batteries (included) and has a low battery indicator to let you know when they need changing. What features does the keyboard have?With easy access hot keys you have your frequently used tools and functions at your fingertips. Open the Windows start menu with the dedicated button.  With multimedia keys you can mute, play and pause music and video.  What is this keyboard compatible with?The K290 keyboard is compatible with Windows XP, Vista, 7, RT and 8 and Mac OS X 10.4x-10.7x. Simple and easy to use just plug the receiver into a USB socket and get connected up to 5m away.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.maplin.co.uk/c/clearance/clearance-computing-and-office?page=0"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 150,
                    "pages": 1
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.maplin.co.uk/c/clearance/clearance-computing-and-office"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Clearance - Computing & Office"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.maplin.co.uk/c/audio-entertainment/tv-home-entertainment/remote-controls"
        }

        // Change to be the number of products on the page
        var x = 20;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Keyring Universal Remote Control';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '0.74',
                    url: 'http://www.maplin.co.uk/p/keyring-universal-remote-control-a10gz',
                    image: "http://i1.adis.ws/s/maplin/A10GZ_set/Audio+%26+Entertainment/TV+%26+Home+Entertainment/Remote+Controls/Keyring+Universal+Remote+Control.jpg?locale=en-GB,en-*,*&w=150&h=150",
                    country: 'uk'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'One For All URC7110 Essence Universal Remote Control';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '14.99',
                    url: 'http://www.maplin.co.uk/p/one-for-all-urc7110-essence-universal-remote-control-n94nj',
                    image: 'http://i1.adis.ws/s/maplin/N94NJ_set/Audio+%26+Entertainment/TV+%26+Home+Entertainment/Remote+Controls/One+For+All+URC7110+Essence+Universal+Remote+Control.jpg?locale=en-GB,en-*,*&w=150&h=150',
                    country: 'uk'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
