var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.knifecenter.com/item/KSAB0800/kai-pure-komachi-2-8-slot-acrylic-block-ab0800"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "KAI Pure Komachi 2 8-Slot Acrylic Block (AB0800)",
                    "price": "39.95",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'https://images.knifecenter.com/thumb/1500x1500/knifecenter/shun/images/KSAB0800.jpg',
                    "country": 'us',
                    "description": "DescriptionKSAB0800: Pure Komachi 2 8-Slot Block Only AB0800KAI Pure Komachi We know how it is. You buy one Pure Komachi 2 knife and you like it. So you buy another one. Then another and another. Pretty soon, you're wondering where to put all those colorful, razor-sharp knives when you're not cooking.We have the answer. The Pure Komachi 2 clear, acrylic block.The clear block lets you brighten your kitchen and show off your collection. With this block's open design, there's plenty of air circulation, too. That helps guard against bacteria growth for a healthy kitchen. This clear block holds up to eight of your Pure Komachi 2 knives."
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "https://www.knifecenter.com/kc_new/store_store.html?a=kitchen&b=block&s=1"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 28,
                    "pages": 2
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "https://www.knifecenter.com/kc_new/store_store.html?a=kitchen&b=block&s=1"
        }

        it('should be true when correct category is returned', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Kitchen"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });


    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.knifecenter.com/kc_new/store_store.html?a=kitchen&b=block&s=1"
        }

        // Change to be the number of products on the page
        var x = 28;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'KAI Pure Komachi 2 8-Slot Acrylic Block (AB0800)';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '39.95',
                    url: 'www.knifecenter.com/item/KSAB0800/kai-pure-komachi-2-8-slot-acrylic-block-ab0800',
                    image: 'https://images.knifecenter.com/thumb/165x165/knifecenter/shun/images/KSAB0800.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Wusthof 17-Slot Walnut Knife Block';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '39.95',
                    url: 'www.knifecenter.com/item/WU72673/Wusthof-17-Slot-Walnut-Knife-Block',
                    image: 'https://images.knifecenter.com/thumb/165x165/knifecenter/wusthof/images/WU72673.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
