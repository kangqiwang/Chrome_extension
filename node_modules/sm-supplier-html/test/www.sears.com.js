var should = require('should');
var Structure = require('../lib/structure.js')


describe('www.sears.com', function() {

    before(function()  {
        this.timeout(5000);
    })


    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.sears.com/tvs-electronics-computers-laptops-tablets-ereaders-tablets/b-1231482572"
        }

        it('should return 50 products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(16);
                done()
            })
        });

        it('last product should be a Zeepad New 7inch Zeepad-KIDS Android 4.4 KitKat Quad Core Capacitive touch Screen Dual Camera Bluetooth Tablet PC -Pink', function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: 'Zeepad New 7inch Zeepad-KIDS Android 4.4 KitKat Quad Core Capacitive touch Screen Dual Camera Bluetooth Tablet PC -Pink',
                    price: '45.00',
                    url: 'http://www.sears.com/zeepad-new-7inch-zeepad-kids-android-4.4-kitkat/p-SPM9341980717?plpSellerId=Tablet World&prdNo=16&blockNo=16&blockType=G16',
                    image: 'http://c.shld.net/rpx/i/s/i/mp/34306/prod_7338023317?hei=245&wid=245&op_sharpen=1&qlt=85',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

        it('first product should be a Samsung SM-T580NZKAXAR T580 Galaxy Tab A 10.1\\" Tablet with 16 GB and Android 6.0 - Black', function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: 'Samsung SM-T580NZKAXAR T580 Galaxy Tab A 10.1\" Tablet with 16 GB and Android 6.0 - Black',
                    price: '229.99',
                    url: 'http://www.sears.com/samsung-t580-galaxy-tab-a-10.1-8221-tablet-with/p-00358591000P?plpSellerId=Sears&prdNo=1&blockNo=1&blockType=G1',
                    image:'http://c.shld.net/rpx/i/s/i/spin/10103564/prod_2131356312?hei=245&wid=245&op_sharpen=1&qlt=85',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

    });


    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.sears.com/optimus-16-inch-oscillating-stand-fan-with-remote/p-03213783000P?prdNo=21&blockNo=21&blockType=G21"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Optimus 16 Inch Oscillating Stand Fan with Remote Control",
                    "price": "44.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": "http://c.shld.net/rpx/i/s/i/spin/10129818/prod_1674828312?hei=416&wid=416&op_sharpen=1",
                    "country": 'us'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });



    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should return false when product is out of stock', function(done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     })
    // })


     describe('Redirect Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.sears.com/en_us/yikes.html"
        }

        it('should return false when redirected to a "Yikes!" 404', function(done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": null,
                    "price": null,
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "country": 'us'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        })
    })
     describe('Store pick up only', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.sears.com/intex-swim-center-family-lounge-pool/p-004W008648981001P?prdNo=11&blockNo=11&blockType=G11"
        }

        it('should return false when Available for in store pick up only', function(done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Intex Swim Center Family Lounge Pool",
                    "price": "29.99",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "country": 'us'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        })
    })
    //  describe('Refurbished', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : "http://www.sears.com/apple-11.6inch-macbook-air-intel-core-i5/p-SPM8266267827?prdNo=2&blockNo=2&blockType=G2"
    //     }

    //     it('should return false when Product is Refurbished', function(done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "Apple Apple MacBook 11.6\" Air Intel Core i5-4250U 1.3GHz 4GB 128GB Laptop MD711LLA Refurbished",
    //                 "price": "499.99",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "country": 'us'
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     })
    // })

    describe('Temporarily unavailable', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.sears.com/disney-sofia-the-first-royal-friends-figure-set/p-004W003044483002P?prdNo=20&blockNo=20&blockType=G20"
        }

        it('should return false when Product is Refurbished', function(done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Disney Sofia The First: Royal Friends Figure Set - Mermaid",
                    "price": null,
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": 'http://c.shld.net/rpx/i/s/i/spin/10123958/prod_1874400112?hei=416&wid=416&op_sharpen=1',
                    "country": 'us'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        })
    })


        describe('No longer available', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.sears.com/toy-quest-16&#39;-splash-sprint-racing-slide/p-004W004337353003P?plpSellerId=Kmart&prdNo=45&blockNo=45&blockType=G45"
        }

        it('should return false when Product is no longer available', function(done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": null,
                    "price": null,
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "country": 'us'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        })
    })
    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.sears.com/appliances-fans/b-1202533080?Price=0-50&previousSort=ORIGINAL_SORT_ORDER&subCatView=true&viewItems=50&lastSelectedFilter=Price&filterList=Price&searchBot=301"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 50,
                    "pages": 25
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    });

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.sears.com/appliances-fans/b-1202533080?Price=0-50&previousSort=ORIGINAL_SORT_ORDER&subCatView=true&viewItems=50&lastSelectedFilter=Price&filterList=Price&searchBot=301"
        }

        it('should be true when the category is correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "View All"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });


});
