var should = require('should');
var Structure = require('../lib/structure.js')
const cache = require('../lib/cache')

describe('a1toys.com', function () {

    this.timeout(5000);

    describe('In Stock Page', function () {

        var payload = {
            "pageType": "product",
            "url": "http://www.entertainmentearth.com/prodinfo.asp?number=CS74149",
            "html": cache.load("http://www.entertainmentearth.com/prodinfo.asp?number=CS74149")
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function (err, inStockPage) {
                var expected = JSON.stringify({
                    "name": "Star Wars Wicket the Ewok Super Deformed Plush",
                    "price": "11.99",
                    "url": payload.url,
                    "inStock": true,
                    "stockLevel": null,
                    "image": "http://www.entertainmentearth.com/images/AUTOIMAGES/CS74149lg.jpg",
                    "country": 'us',
                    "description": "Star Wars Wicket the Ewok  Super Deformed Plush - Comic Images - Star Wars - Plush - Experience Endor's natural wildlife with this Star Wars Wicket the Ewok Super Deformed Plush! Pint-sized Ewok in adorable plush form. Perfect for the Star Wars fan in your life! Squeezable and collectible! Experience Endor's natural wildlife with this Star Wars Wicket the Ewok Super Deformed Plush! On the forest moon of Endor, Ewoks ruled the land... until the Empire, that is. Now you..."
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Out of Stock Page', function () {

        var payload = {
            "pageType": "product",
            "url": "http://www.entertainmentearth.com/prodinfo.asp?number=SBDQ1284G#.WFfDuHWLT0o",
            "html": cache.load("http://www.entertainmentearth.com/prodinfo.asp?number=SBDQ1284G#.WFfDuHWLT0o")
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function (err, inStockPage) {
                var expected = JSON.stringify({
                    "name": "Disney Frozen Group Blue Glitter 16 oz. Flip Straw Travel Cup",
                    "price": "9.99",
                    "url": payload.url,
                    "inStock": false,
                    "stockLevel": null,
                    "image": 'http://www.entertainmentearth.com/images/AUTOIMAGES/SBDQ1284Glg.jpg',
                    "country": 'us',
                    "description": 'Disney Frozen Group Blue 16 oz. Flip Straw Travel Cup - Silver Buffalo - Frozen - Travel Cups - Anna, Olaf, and Snow Queen Elsa help you keep from spilling your drink! This Disney Frozen Group Blue Glitter 16 oz. Flip Straw Travel Cup features a nice image of Anna, Olaf, and Snow Queen Elsa on a white glitter background. This great travel cup holds up to 16 ounces of liquid and features a sturdy blue lid with convenient flip straw to help avoid spills. Hand wash only. Not...'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Sold Out of Stock Page', function () {

        var payload = {
            "pageType": "product",
            "url": "http://www.entertainmentearth.com/prodinfo.asp?number=JK31011",
            "html": cache.load("http://www.entertainmentearth.com/prodinfo.asp?number=JK31011")
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function (err, inStockPage) {
                var expected = JSON.stringify({
                    "name": "Disney Frozen Elsa Ice Skating Toddler Doll",
                    "price": "29.99",
                    "url": payload.url,
                    "inStock": false,
                    "stockLevel": null,
                    "image": 'http://www.entertainmentearth.com/images/AUTOIMAGES/JK31011lg.jpg',
                    "country": 'us',
                    "description": 'Disney Frozen Elsa Ice Skating Toddler Doll - Jakks Pacific - Frozen - Dolls - Do you want to... go ice skating? The Disney Frozen Elsa Ice Skating Toddler Doll comes with an adorable outfit children will recognize from the Disney film Frozen . The beautiful Elsa toddler doll has an elegant tiara and long hair that girls can brush and style. Elsa comes with removable play ice skates which allow children to re-create the ice skating scene from the movie Frozen ....'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });


    describe('Pre-order Page', function () {

        var payload = {
            "pageType": "product",
            "url": "http://www.entertainmentearth.com/prodinfo.asp?number=NC54039#.WFfDwXWLT0o",
            "html": cache.load("http://www.entertainmentearth.com/prodinfo.asp?number=NC54039#.WFfDwXWLT0o")
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function (err, inStockPage) {
                var expected = JSON.stringify({
                    "name": "Teenage Mutant Ninja Turtles Donatello 1:4 Scale Action Figure",
                    "price": "96.99",
                    "url": payload.url,
                    "inStock": false,
                    "stockLevel": null,
                    "image": 'http://www.entertainmentearth.com/images/AUTOIMAGES/NC54039lg.jpg',
                    "country": 'us',
                    "description": "TMNT Donatello 1:4 Scale Action Figure - NECA - Teenage Mutant Ninja Turtles - Action Figures - Cowabunga, dude! Action figure based on the classic Teenage Mutant Ninja Turtles movie. Donatello stands 16 1/2-inches tall and features 30 points of articulation! Accurate to the movie, he comes with a bo staff and interchangeable hands. Here's a 1:4 scale action figure based on the classic Teenage Mutant Ninja Turtles movie. Donatello is the Turtles' resident techno-genius, but make..."
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });


    describe('Coming in Soon Stock Page', function () {

        var payload = {
            "pageType": "product",
            "url": "http://www.entertainmentearth.com/prodinfo.asp?number=DCL11607#.V858QnUrL0p",
            "html": cache.load("http://www.entertainmentearth.com/prodinfo.asp?number=DCL11607#.V858QnUrL0p")
        }

        it('should return false when product is out of stock', function (done) {

            Structure(payload, function (err, inStockPage) {
                var expected = JSON.stringify({
                    "name": "Wonder Woman XXRAY 4-Inch Vinyl Figure",
                    "price": "19.99",
                    "url": payload.url,
                    "inStock": false,
                    "stockLevel": null,
                    "image": "http://www.entertainmentearth.com/images/AUTOIMAGES/DCL11607lg.jpg",
                    "country": 'us',
                    "description": "Wonder Woman XXRAY 4-Inch Vinyl Figure - Mighty Jaxx - Wonder Woman - Vinyl Figures - See Diana Prince like never before! The Wonder Woman XXRAY 4-Inch Vinyl Figure features a cross-section the Amazonian Princess. This awesome vinyl figure stands 4-inches tall, features a unique dissection designed by Jason Freeny, and is individually hand painted! Assemble the Justice League with Batman, Superman, The Flash, Aquaman, and Cyborg! (Sold Seperately)"
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        })
    });

    // describe('Search page pagination', function() {

    //     var payload = {
    //         "pageType" : "pagination",
    //         "url" : ""
    //     }

    //     it('should be true when number of items and pages correct', function (done) {

    //         Structure(payload, function(pagination) {
    //             var expected = JSON.stringify({
    //                 "items": "",
    //                 "pages": ""
    //             })
    //             JSON.stringify(pagination).should.equal(expected);
    //             done()
    //         })
    //     });

    // })

    // describe('Search page category', function() {

    //     var payload = {
    //         "pageType" : "category",
    //         "url" : ""
    //     }

    //     it('should be true when correct category is returned', function (done) {

    //         Structure(payload, function(category) {
    //             var expected = JSON.stringify({
    //                 "name": ""
    //             })
    //             JSON.stringify(category).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Search Page', function () {

        var payload = {
            "pageType": "search",
            "url": "https://a1toys.com/toys-figures-playsets.html",
            "html": cache.load("https://a1toys.com/toys-figures-playsets.html")
        }

        // Change to be the number of products on the page
        var x = 7;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function (err, result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Transformers vs. G.I. Joe Megatron 7-Inch Vinyl Figure';
        it('first product should be ' + firstProductName, function (done) {
            Structure(payload, function (err, result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '49.99',
                    url: 'https://www.entertainmentearth.com/prodinfo.asp?number=KRTBLCG078',
                    image: 'https://www.entertainmentearth.com/images/AUTOIMAGES\\KRTBLCG078.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Transformers Battle Ready Optimus Prime Hikari Premium Japanese Vinyl - Entertainment Earth Exclusive';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function (err, result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '79.99',
                    url: 'https://www.entertainmentearth.com/prodinfo.asp?number=FU4644R',
                    image: 'https://www.entertainmentearth.com/images/AUTOIMAGES\\FU4644R.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});


