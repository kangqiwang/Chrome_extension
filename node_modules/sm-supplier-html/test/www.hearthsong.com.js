var should = require('should');
var Structure = require('../lib/structure.js')
const cache = require('../lib/cache')


describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.hearthsong.com/zipfy-mini-luge-sled.htm",
            "html": cache.load("http://www.hearthsong.com/zipfy-mini-luge-sled.htm")
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(err, inStockPage) {
                var expected = JSON.stringify({
                    "name": "Zipfy Mini-Luge Sled",
                    "price": "39.98",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://hearthsongcdn.cachefly.net/getDynamicImage.aspx?path=726071blue_x.jpg&w=600&h=660',
                    "country": 'us',
                    "description": 'When the ground is covered by snow and ice, it’s time to take out this Zipfy mini luge from HearthSong and enjoy the winter wonderland! Kids ages 5 and older can ride this sled that holds up to 250 lbs. It is perfectly designed to fit the body, with a handle for control on the slopes. The small size and lightweight design make this sled easy to carry back up the hill, and also to store when spring returns. We offer the American-made Zipfy mini luge in bright colors that will stand out against the snow.• The Zipfy Mini Luge features Lightweight, Streamlined Design• Easy to carry and store with its 21”L x 13”W x 16”H size and lightweight design• Available from HearthSong in vibrant colors that stand out against the snow.• The contoured design perfectly fits the body of a child or an adult• The handle provides control on the slopes• The sled holds up to 250 lbs.• This Zipfy mini luge is made in America and intended for ages 5 and olderSize 21"L x 13"W x 16"HOne size fits up to 250 lbs.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.hearthsong.com/outdoor-play-toys/outdoor-play-toys.htm",
            "html": cache.load("http://www.hearthsong.com/outdoor-play-toys/outdoor-play-toys.htm")
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(err, pagination) {
                var expected = JSON.stringify({
                    "items": 96,
                    "pages": 3
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.hearthsong.com/outdoor-play-toys/outdoor-play-toys.htm",
            "html": cache.load("http://www.hearthsong.com/outdoor-play-toys/outdoor-play-toys.htm")
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(err, category) {
                var expected = JSON.stringify({
                    "name": "Outdoor Play Toys",
                    "url": payload.url
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.hearthsong.com/en/Interests/Sand-%26-Beach/c/8628",
            "html": cache.load("https://www.hearthsong.com/en/Interests/Sand-%26-Beach/c/8628")
        }

        // Change to be the number of products on the page
        var x = 29;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(err, result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Go! HangOut™ HugglePod® Beach Cabana';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(err, result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '179.00',
                    url: 'https://www.hearthsong.com/en/Ages/10-years-old/Go%21-HangOut%26trade%3B-HugglePod%26reg%3B-Beach-Cabana/p/730727',
                    image: 'https://www.hearthsong.com/medias/730727-HSSU16-AF2430.jpg-1200Wx1200H-300Wx300H?context=bWFzdGVyfGltYWdlc3wzMTYyNnxpbWFnZS9qcGVnfGltYWdlcy9oZDYvaGY5Lzg4MDAyMDQwMjk5ODIuanBnfDlkYzY0NTY4N2UwMTYzZTY1MGNkMzhhNTE1NDI0OTczMWZmNGIzYmU4MTFkNTJhZmEwNjI1NmM4NmMxNTQwODg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'New! Tynies® Handmade Glass Pets: Ocean (set of 7)';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(err, result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '34.98',
                    url: 'https://www.hearthsong.com/en/Ages/10-years-old/Tynies%26reg%3B-Handmade-Glass-Pets%3A-Ocean-%28set-of-7%29/p/732289',
                    image: 'https://www.hearthsong.com/medias/732289-HSSU818-JS57898-4.jpg-1200Wx1200H-300Wx300H?context=bWFzdGVyfGltYWdlc3wxNjgzOHxpbWFnZS9qcGVnfGltYWdlcy9oODkvaDRjLzg3OTk5OTczOTQ5NzQuanBnfGQ3ZGJjZjZjOWZmNDg3NmFjYTU1MmJjZjYxZGU3ZDIzZDU4NzI3NmUwN2Y3ZTM3ZTI3ZThiY2NhODBlY2JjMWY',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
