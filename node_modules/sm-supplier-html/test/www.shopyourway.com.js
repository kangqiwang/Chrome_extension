var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.shopyourway.com/craftsman-deluxe-miter-saw-stand/210680238"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Craftsman Deluxe Miter Saw Stand",
                    "price": "99.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://s3.sywcdn.net/getImage?url=http%3a%2f%2fc.shld.net%2frpx%2fi%2fs%2fi%2fspin%2fimage%2fspin_prod_745835512&t=Product&w=600&h=600&qlt=100&mrg=1&s=55e499a36ff6862d9c681baf13805ead',
                    "country": 'us',
                    "description": 'Deluxe Miter Saw Stand Has the Angles Covered If you have a project that calls for precision, the Craftsman deluxe miter saw stand will help you make sure you get it right the first time without frustrating slips and wasted wood. The stand rests on sturdy steel legs that lock in place to support up to 330 pounds-that\'s plenty of capacity for your saw and your project materials. Two steel rollers help keep your longer pieces moving along smoothly the 80-inch length, which means you won\'t have to worry about bumps that can make you start all over. This deluxe miter saw stand comes with universal mounting brackets that let you quickly place and remove most 10-inch and 12-inch miter saws. The stand includes a two-outlet power strip, giving you the freedom to work away from electrical outlets. Fold the stand and roll it away when you\'re finished. Mobile enough to move around the yard, sturdy enough to get the job done, the Craftsman deluxe miter saw stand makes a quick job of set up so you can get on with the work you need to doUniversal quick-release mounting bracketsFits most 10" and 12" miters sawsSupports up to 330 lbsSupport arms extend up to 80"Includes a two-outlet power strip with safety switchSupport legs are spring loaded and lock into place for working, then fold easily for storage 1-1/2" x 8" wheelsRound steel tubing provides stabilityTwo 11-1/2" steel rollers help feed long pieces'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : ""
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": "",
                    "pages": ""
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })*/

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.shopyourway.com/tag/planer-accessories/3092872/products?filters=availability:1"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Planer Accessories"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.shopyourway.com/tag/planer-accessories/3092872/products?filters=availability:1"
        }

        // Change to be the number of products on the page
        var x = 152;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Craftsman Deluxe Miter Saw Stand';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '99.99',
                    url: 'http://www.shopyourway.com/craftsman-deluxe-miter-saw-stand/210680238',
                    image: 'http://s2.sywcdn.net/getImage?url=http%3a%2f%2fc.shld.net%2frpx%2fi%2fs%2fi%2fspin%2fimage%2fspin_prod_745835512&t=Product&w=210&h=210&qlt=100&mrg=1&s=0e51adc3e371b67bd82247d8ef9be809',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Stanley 12-504 PLANE IRON 1-3/8"';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '11.06',
                    url: 'http://www.shopyourway.com/stanley-12-504-plane-iron-1-3-8/220496583',
                    image: 'http://s4.sywcdn.net/getImage?url=http%3a%2f%2fc.shld.net%2frpx%2fi%2fs%2fpi%2fmp%2f3125%2fprod_13351828519%3fsrc%3dhttp%253A%252F%252Fmedia.lifeandhome.com%252Fmedia%252Fcatalog%252Fproduct%252F2%252F1%252F2130000067_sg_03_20_08.gif%26d%3de43ec401cb790dc018ef54bcbb215be0f0b261ce&t=Product&w=210&h=210&qlt=100&mrg=1&s=aa19741f622f8cd84a3467c1ad19e110',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
