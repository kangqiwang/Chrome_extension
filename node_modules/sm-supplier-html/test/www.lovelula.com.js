var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.lovelula.com/products/kimberly-sayer-ultra-light-organic-facial-moisturiser-spf30-120ml"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Kimberly Sayer Ultra Light Organic Facial Moisturiser - SPF30 120ml",
                    "price": "26.50",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'https://www.lovelula.com/spree/products/8998/large/kimberly-sayer-ultra-light-organic-facial-moisturiser-spf30-120ml.jpg?1401199758',
                    "country": 'uk',
                    "description": 'Recommended for light non pore clogging day moisturiser with mineral SPF protection, anti aging protection for normal, oily and acne prone skin.AS SEEN IN SUNDAY TIMES STYLE MAGAZINE AND THE GREEN BEAUTY BIBLE.Kimberly Sayer creates an incredible line that offers light facial moisturisers that can be used by men and women and leave your skin looking and feeling its best. With the size, this bottle will bring you from the winter doldrums into the sunshine of spring and summer. - The Organic Beauty ExpertEasily absorbed lightweight formula won\'t clog pores. Contains Lemon Oil which will detoxify your skin, helps stop too much oil production and will help dry up acne and pimples. With Oat Beta Glucan which helps protect your skin against UV-A oxidative stress.Kimberly Sayer uses non-toxic sunblock derived from minerals Titanium Dioxide and Zinc Oxide to offer UV-A and UV-B protection from the sun without irritating the most sensitive of skin. Use daily and under make-up.A lightweight, protective day cream with mineral sunscreen that\'s easily absorbed and won\'t clog pores or cause breakouts. Kimberly Sayer Ultra Light Organic Facial Moisturiser contains lemon to detoxify the skin and minimize the production of oil, while drying up acne and zits. Ideal for use under make-up. Show More'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "https://www.lovelula.com/t/products/skin-care"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 64,
                    "pages": 19
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

     describe('Not a search page', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "https://www.lovelula.com/products/kimberly-sayer-ultra-light-organic-facial-moisturiser-spf30-120ml"
        }

        it('should return null items and pages', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": null,
                    "pages": null
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    });

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "https://www.lovelula.com/t/products/skin-care"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Natural and Organic Skin Care Products"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.lovelula.com/t/products/skin-care"
        }

        // Change to be the number of products on the page
        var x = 64;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Kimberly Sayer Ultra Light Organic Facial Moisturiser - SPF30 120ml';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '26.50',
                    url: 'https://www.lovelula.com/products/kimberly-sayer-ultra-light-organic-facial-moisturiser-spf30-120ml',
                    image: 'https://www.lovelula.com/spree/products/8998/product/kimberly-sayer-ultra-light-organic-facial-moisturiser-spf30-120ml.jpg?1401199758',
                    country: 'uk'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Trilogy Everything Balm 95ml';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '21.50',
                    url: 'https://www.lovelula.com/products/trilogy-everything-balm-95ml',
                    image: 'https://www.lovelula.com/spree/products/13042/product/trilogy-everything-balm-95ml.jpg?1409842206',
                    country: 'uk'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
