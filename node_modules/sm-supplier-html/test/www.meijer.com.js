var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.meijer.com/product/grocery/beverages/coffee-tea-cocoa/pods-cups/gmc-k-cup-breakfast-blend-487-oz-12-ct/t1/t1-865/t2/t2-9976/t3/t3-232/t4/t4-571/9955508520.uts"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Green Mountain K-Cups Breakfast Blend - 12 ct",
                    "price": "5.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'https://static.meijer.com/Media/000/99555/0009955508520_0600.png',
                    "country": 'us',
                    "description": "K-Cups Coffee Breakfast Blend Regular Light Roast. Bright sweet and engaging. Our favorite way to start the day. Keurig - premium coffee system. Gourmet single cup home brewing system. For use in Keurig brewing system. Excellence from tree to cup. Our frequent trips to source combined with the extraordinary skill of our Master Roasters create coffees you can enjoy only experience through Green Mountain Coffee and your Keurig brewer. From the Slopes of Mt. Kenya to the Highlands of Sumatra. We invite you to discover your favorite. Keurig makes it possible for everyone to brew their own perfect cup of gourmet coffee in less than a minute. The combination of Keurig's patented technology and the K-Cup portion pack guarantees fresh consistent unequaled flavor time after time. Choose your favorite variety from our unparalleled assortment of K-Cups. Made in the USA."
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "https://www.meijer.com/catalog/search_command.cmd?tierId=&keyword=coffee&sort=1&rows=120&start=0&spellCorrection=&facet="
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 120,
                    "pages": 10
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.meijer.com/catalog/search_command.cmd?tierId=&keyword=coffee&sort=1&rows=120&start=0&spellCorrection=&facet="
        }

        // Change to be the number of products on the page
        var x = 120;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Green Mountain K-Cups Breakfast Blend - 12 ct';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '5.99',
                    url: 'https://www.meijer.com/product/grocery/beverages/coffee-tea-cocoa/pods-cups/gmc-k-cup-breakfast-blend-487-oz-12-ct/t1/t1-865/t2/t2-9976/t3/t3-232/t4/t4-571/9955508520.uts',
                    image: 'https://static.meijer.com/Media/000/99555/0009955508520_0200.png',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Starbucks Verona Ground Coffee, 12 oz';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '7.99',
                    url: 'https://www.meijer.com/product/grocery/beverages/coffee-tea-cocoa/gourmet/starbucks-cafe-verona-ground-12-oz/t1/t1-865/t2/t2-9976/t3/t3-232/t4/t4-569/76211162287.uts',
                    image: 'https://static.meijer.com/Media/007/62111/0076211162287_0200.png',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });
    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "https://www.meijer.com/catalog/search_command.cmd?tierId=&keyword=coffee&sort=1&rows=120&start=0&spellCorrection=&facet="
        }

        it('should be true when the category is correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "coffee"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

});
