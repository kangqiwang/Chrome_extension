var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.cyclestore.co.uk/kona_sutra_ltd_2016_all_road_bike-ID_68749"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Kona Sutra Ltd All Road Bike 2016",
                    "price": "1274.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'https://www.cyclestore.co.uk/images/products/xtra/68749.jpg',
                    "country": 'uk',
                    "description": 'The Sutra LTD represents the converging trajectories of mountain and road bike parts. The focus of the design and specification allude to its multi-surface capabilities. Do the Oregon Outback (and if you don’t know get Googlin’) ride that extra section of trail on the way home from work do that gravel loop you’ve always wanted to do. Let the Sutra LTD be your steed (or mare).OptionQuantity'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "https://www.cyclestore.co.uk/road_bikes"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 120,
                    "pages": 14
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "https://www.cyclestore.co.uk/road_bikes"
        }

        it('should be true when correct category is returned', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Road Bikes"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.cyclestore.co.uk/lights_cateye_spares_and_accessories"
        }

        // Change to be the number of products on the page
        var x = 15;
        it('should return ' + x + ' number of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'CATEYE HANDLEBAR BRACKET STD H32';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '5.99',
                    url: 'https://www.cyclestore.co.uk/cateye_handlebar_bracket_std_h32-ID_5407',
                    image: 'https://www.cyclestore.co.uk/images/products/large/5407.jpg',
                    country: 'uk'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Cateye Volt 50 Seat Post Bracket';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '6.99',
                    url: 'https://www.cyclestore.co.uk/cateye_volt_50_seat_post_bracket-ID_65153',
                    image: 'https://www.cyclestore.co.uk/images/products/large/65153.jpg',
                    country: 'uk'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
