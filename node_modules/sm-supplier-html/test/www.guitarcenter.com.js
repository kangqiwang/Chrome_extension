var should = require('should');
var Structure = require('../lib/structure.js')
const cache = require('../lib/cache')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.guitarcenter.com/Rogue/RA-090-Dreadnought-Acoustic-Guitar.gc?_requestid=3153244",
            "html": cache.load("http://www.guitarcenter.com/Rogue/RA-090-Dreadnought-Acoustic-Guitar.gc?_requestid=3153244")
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(err, inStockPage) {
                var expected = JSON.stringify({
                    "name": "Rogue RA-090 Dreadnought Acoustic Guitar",
                    "price": "51.74",
                    "url": payload.url,
                    "inStock": "UNCHECKED",
                    "stockLevel": null,
                    "image": 'http://media.guitarcenter.com/is/image/MMGS7/RA-090-Dreadnought-Acoustic-Guitar-Sunburst/423794000027000-00-500x500.jpg',
                    "country": 'uk',
                    "description": 'Overview Videos From Rogue comes this amazing deal in the RA-90 dreadnought acoustic guitar. The Rogue guitar is an ideal instrument for the beginner, or young musician. The body depth and width bring out balanced tone and plenty of projection to be heard from across the room.This ultra-affordable dreadnought acoustic guitar features a whitewood body, which brings out lots of mid-range punch. The nato neck adds sustain without losing any strength in tone. The painted maple bridge and fingerboard add clarity to each note, and a striking look to the front of the guitar. The RA-090\'s C-shape neck, 1-2/3" nut width, and 16" radius help with intricate fretboard movements when running up and down the 20 frets. The RA-90 also features nickel hardware and covered tuners. This Rogue acoustic guitar will certainly get the job done, at a price that anybody can afford.Case sold separatelyCheck the drop-down menu to the right to select colors and/or other options. Features 6-string Dreadnought design Whitewood body 25-3/8" scale length Nato neck Painted maple bridge Painted maple fingerboard C-shape neck 20 frets (14 open) 1-2/3" nut width 16" radius Covered tuners Nickel hardware Case sold separately'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.guitarcenter.com/Guitars.gc",
            "html": cache.load("http://www.guitarcenter.com/Guitars.gc")
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(err, pagination) {
                var expected = JSON.stringify({
                    "items": 100,
                    "pages": 5,
                    "url" : "http://www.guitarcenter.com/Guitars.gc"
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.guitarcenter.com/Guitars.gc#pageName=department-page&N=18144&Nao=0&recsPerPage=100&v=g&profileCountryCode=UA&profileCurrencyCode=UAH&profileCountryCode=GB&profileCurrencyCode=GBP",
            "html": cache.load("http://www.guitarcenter.com/Guitars.gc#pageName=department-page&N=18144&Nao=0&recsPerPage=100&v=g&profileCountryCode=UA&profileCurrencyCode=UAH&profileCountryCode=GB&profileCurrencyCode=GBP")
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(err, category) {
                var expected = JSON.stringify({
                    "name": "Guitars",
                    "url" : "http://www.guitarcenter.com/Guitars.gc#pageName=department-page&N=18144&Nao=0&recsPerPage=100&v=g&profileCountryCode=UA&profileCurrencyCode=UAH&profileCountryCode=GB&profileCurrencyCode=GBP"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.guitarcenter.com/Bass.gc",
            "html": cache.load("https://www.guitarcenter.com/Bass.gc")
        }

        // Change to be the number of products on the page
        var x = 100;
        it('should return ' + x + ' number of products', function (done) {
            Structure(payload, function(err, result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Rogue RA-090 Dreadnought Acoustic Guitar';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(err, result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '43.10',
                    url: 'http://www.guitarcenter.com/Rogue/RA-090-Dreadnought-Acoustic-Guitar.gc',
                    image: 'http://media.guitarcenter.com/is/image/MMGS7/RA-090-Dreadnought-Acoustic-Guitar-Natural/423794000010000-00-180x180.jpg',
                    country: 'uk'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Alvarez MP610ESB Parlor Acoustic-Electric Guitar';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(err, result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '517.47',
                    url: 'http://www.guitarcenter.com/Alvarez/MP610ESB-Parlor-Acoustic-Electric-Guitar.gc',
                    image: 'http://media.guitarcenter.com/is/image/MMGS7/MP610ESB-Parlor-Acoustic-Electric-Guitar-Sunburst/J41408000001000-00-180x180.jpg',
                    country: 'uk'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
