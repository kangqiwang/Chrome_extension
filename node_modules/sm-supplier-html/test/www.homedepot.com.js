var should = require('should');
var Structure = require('../lib/structure.js')
const cache = require('../lib/cache')

describe('www.homedepot.com', function () {

    this.timeout(5000);

    describe('Search Page', function () {

        var payload = {
            "pageType": "search",
            "url": "https://www.homedepot.com/b/Building-Materials-Builders-Hardware/N-5yc1vZaqzs",
            "html": cache.load("https://www.homedepot.com/b/Building-Materials-Builders-Hardware/N-5yc1vZaqzs")
        }

        it('should return 19 products', function (done) {
            Structure(payload, function (err, result) {
                result.length.should.equal(19);
                done()
            })
        });


        it('first product should be', function (done) {

            Structure(payload, function (err, result) {

                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: 'Simpson Strong-Tie ABA 6 in. x 6 in. ZMAX Galvanized Adjustable Post Base',
                    price: '22.95',
                    url: 'http://www.homedepot.com/p/Simpson-Strong-Tie-ABA-6-in-x-6-in-ZMAX-Galvanized-Adjustable-Post-Base-ABA66Z/100375370',
                    image: 'https://images.homedepot-static.com/productImages/6f5a2fb3-834a-40a2-bce1-d7484f0fa417/svn/simpson-strong-tie-bases-aba66z-64_400_compressed.jpg',
                    country: 'us',
                    sku:"100375370"
                })

                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        it('last product should be', function (done) {
            Structure(payload, function (err, result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: 'Simpson Strong-Tie ZMAX Galvanized Half Base',
                    price: '12.77',
                    url: 'http://www.homedepot.com/p/Simpson-Strong-Tie-ZMAX-Galvanized-Half-Base-BC60Z/100375044',
                    image: 'https://images.homedepot-static.com/productImages/899dfe81-f95c-4a4d-ad17-4513e2c7fba5/svn/simpson-strong-tie-bases-bc60z-64_400_compressed.jpg',
                    country: 'us',
                    sku:"100375044"
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

    describe('Search page category', function () {

        var payload = {
            "pageType": "category",
            "url": "http://www.homedepot.com/b/Tools-Hardware-Hand-Tools-Hand-Tool-Sets/N-5yc1vZc22x",
            "html": cache.load("http://www.homedepot.com/b/Tools-Hardware-Hand-Tools-Hand-Tool-Sets/N-5yc1vZc22x")
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function (err, category) {
                var expected = JSON.stringify({
                    "name": "Hand Tool Sets",
                    "url": "http://www.homedepot.com/b/Tools-Hardware-Hand-Tools-Hand-Tool-Sets/N-5yc1vZc22x"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('In Stock Page', function () {

        var payload = {
            "pageType": "product",
            "url": "http://www.homedepot.com/p/Crescent-1-4-in-3-8-in-and-1-2-in-Drive-6-and-12-Point-SAE-Metric-Mechanics-Tool-Set-170-Piece-CTK170CMP2/205155848",
            "html": cache.load("http://www.homedepot.com/p/Crescent-1-4-in-3-8-in-and-1-2-in-Drive-6-and-12-Point-SAE-Metric-Mechanics-Tool-Set-170-Piece-CTK170CMP2/205155848")
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function (err, inStockPage) {
                var expected = JSON.stringify({
                    name: '1/4 in., 3/8 in. and 1/2 in. Drive 6 and 12 Point SAE/Metric Mechanics Tool Set (170-Piece)',
                    price: '98.99',
                    url: payload.url,
                    inStock: "UNCHECKED",
                    stockLevel: null,
                    image: 'http://www.homedepot.com/catalog/productImages/400/a5/a59661e7-026e-4ac2-aadf-bfbc678f9efc_400.jpg',
                    country: 'us',
                    sku: "205155848"
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });


    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should return false when product is out of stock', function(done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 name: '',
    //                 price: '',
    //                 url: null,
    //                 inStock: false,
    //                 stockLevel: null
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     })

    // })

});


