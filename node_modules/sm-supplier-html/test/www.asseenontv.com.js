var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.asseenontv.com/detail.php?p=552591"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Bodum Chambord Coffee Maker, 8 Cup, 34 oz",
                    "price": "24.97",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://www.asseenontv.com/imgcache/product/resized/000/552/591/catl/bodum-chambord-coffee-maker-8-cup-34-oz_670.jpg?k=0eb6047f&pid=552591&s=catl&sn=asseenontv',
                    "country": 'us',
                    "description": "Serious coffee lovers agree that the best way to brew everyone's favorite stimulant is also the simplest and quickest.The French press method prevents scorching of the beans, and because there's no filter involved, all of the flavorful oils stay in your drink. Simply measure out one rounded tablespoon of coarse ground per 4-ounce cup, pour very hot (not boiling) water over it, let the contents brew for at least 4 minutes, then slowly depress the plunger. The result is one of the richest cups of java you'll ever taste. Because the carafe is glass, it's best to use a little care when handling the press in the sink--but if it should break, don't panic: Bodum offers replacement parts.Features:Carafe is made of durable, heat-resistant borosilicate glassStainless Steel frame and heat resistant handleDishwasher Safe3-part stainless steel mesh filter helps extract your coffee's aromatic oils and subtle flavorsPressed coffee extracts the perfect amount of essentials oils and acids from the bean for the maximum amount of flavor from your coffee"
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : ""
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": "",
                    "pages": ""
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })*/

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.asseenontv.com/best-sellers/index.php?v=best-sellers&nvbar=Best+Sellers"
        }

        it('should be true when the category is correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Best Sellers"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.asseenontv.com/clearance/index.php?v=clearance&nvbar=Clearance"
        }

        // Change to be the number of products on the page
        var x = 103;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Gadget Grab Buy 1 Get 1 Free';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '9.95',
                    url: 'http://www.asseenontv.com/gadget-grab-buy-1-get-1-free/detail.php?p=961120&v=clearance',
                    image: 'http://www.asseenontv.com/imgcache/product/resized/000/961/120/catl/gadget-grab-buy-1-get-1-free_290.jpg?k=c69edb2b&pid=961120&s=catl&sn=asseenontv',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Calphalon Unison Nonstick 5 Piece Cookware Set';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '79.97',
                    url: 'http://www.asseenontv.com/calphalon-unison-nonstick-5-piece-cookware-set/detail.php?p=595063&v=clearance',
                    image: 'http://www.asseenontv.com/imgcache/product/resized/000/595/063/catl/calphalon-unison-nonstick-5-piece-cookware-set_290.jpg?k=e53bb165&pid=595063&s=catl&sn=asseenontv',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
