var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.shoecarnival.com/mens-nunn-bush-zac-two-eye-moc-toe-boat-shoe/sandstone/88901.scp"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Nunn Bush Zac Two Eye Moc Toe Boat Shoe",
                    "price": "29.98",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'https://i1.adis.ws/i/scvl/88901_170019_1?w=678&h=484&img404=404&v=1',
                    "country": 'us',
                    "description": "Men's Nunn Bush Lightweight Boat Shoes. Set sail in cool and casual style with the Nunn Bush Zac Two Eye Moc Toe Boat Shoe! These shoes feature durable canvas uppers, lightweight rubber sponge traction outsole, and Dual Comfortâ„¢ footbed with memory foam and EVA layers for comfort. From denim to khakis, the Nunn Bush Zac Two Eye Moc Toe Boat Shoe is sure to add classic laid back style to all of your looks!"
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.shoecarnival.com/browse/searchResults.jsp?keyword=shoes&x=0&y=0&inputSlyceSearch=#keyword=shoes&mpp=96"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 96,
                    "pages": 8
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.shoecarnival.com/browse/searchResults.jsp?keyword=shoes&x=0&y=0&inputSlyceSearch=#keyword=shoes&mpp=96"
        }

        // Change to be the number of products on the page
        var x = 93;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = "Nunn Bush Men's Zac Two Eye Moc Toe Boat Shoe";
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '29.98',
                    url: 'http://www.shoecarnival.com/mens-nunn-bush-zac-two-eye-moc-toe-boat-shoe/sandstone/88901.scp',
                    image: 'http://images.shoecarnival.com/i/scvl/88901_170019_1?$prod_thumb$&fit=constrain,1&w=293&h=250&fmt=jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = "Self Esteem Girls' Kyndall 11-4";
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '16.98',
                    url: 'http://www.shoecarnival.com/girls-self-esteem-kyndall-11-4/brown/90185.scp',
                    image: 'http://images.shoecarnival.com/i/scvl/90185_172822_1?$prod_thumb$&fit=constrain,1&w=293&h=250&fmt=jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

     describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.shoecarnival.com/browse/searchResults.jsp?keyword=shoes&x=0&y=0&inputSlyceSearch=#keyword=shoes&mpp=96"
        }

        it('should be true when the category is correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "shoes"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

});
