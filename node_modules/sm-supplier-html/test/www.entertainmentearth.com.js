var should = require('should');
var Structure = require('../lib/structure.js')
const cache = require('../lib/cache')

describe('www.entertainmentearth.com', function () {

    this.timeout(5000);

    describe('In Stock Page', function () {

        var payload = {
            "pageType": "product",
            "url": "https://www.entertainmentearth.com/product/lego-10700-green-baseplate/lg10700",
            "html": cache.load("https://www.entertainmentearth.com/product/lego-10700-green-baseplate/lg10700")
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function (err, inStockPage) {
                var expected = JSON.stringify({
                    "name": "LEGO 10700 Green Baseplate",
                    "price": "7.99",
                    "url": payload.url,
                    "inStock": true,
                    "stockLevel": null,
                    "image": "https://media.entertainmentearth.com/assets/images/ee3d9c03ff0648ee91f9a928fe80ec7flg.jpg",
                    "country": 'us',
                    "description": "Whether you're creating a garden, forest, or something of your own imagination, this green-colored 32x32-stud baseplate is the perfect starting point for building, displaying, and playing with your LEGO creations. Measures about 10-inches wide x 10-inches long. Includes 1 Green Baseplate, Ages 4-99."
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Out of Stock Page', function () {

        var payload = {
            "pageType": "product",
            "url": "https://www.entertainmentearth.com/product/inside-out-anger-disneypixar-pop-vinyl-figure/fu4874",
            "html": cache.load("https://www.entertainmentearth.com/product/inside-out-anger-disneypixar-pop-vinyl-figure/fu4874")
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function (err, inStockPage) {
                var expected = JSON.stringify({
                    "name": "Inside Out Anger Disney-Pixar Pop! Vinyl Figure",
                    "price": "10.99",
                    "url": payload.url,
                    "inStock": false,
                    "stockLevel": null,
                    "image": 'https://media.entertainmentearth.com/assets/images/20f15744824243eca1d806a539e20561lg.jpg',
                    "country": 'us',
                    "description": "Growing up can be a bumpy road! Told from the perspective of the emotions inside the mind of a little girl, Disney-Pixar's Inside Out takes a creative look at the conflicting emotions we all experience as we try to navigate the world. The Inside Out Anger Disney-Pixar Pop! Vinyl Figure features the hot-headed emotion voiced by Lewis Black and measures approximately 3 3/4-inches tall. For ages 3 and up."
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Sold Out of Stock Page', function () {

    //     var payload = {
    //         "pageType": "product",
    //         "url": "http://www.entertainmentearth.com/prodinfo.asp?number=JK31011",
    //         "html": cache.load("http://www.entertainmentearth.com/prodinfo.asp?number=JK31011")
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function (err, inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "Disney Frozen Elsa Ice Skating Toddler Doll",
    //                 "price": "29.99",
    //                 "url": payload.url,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": 'http://www.entertainmentearth.com/images/AUTOIMAGES/JK31011lg.jpg',
    //                 "country": 'us',
    //                 "description": 'Disney Frozen Elsa Ice Skating Toddler Doll - Jakks Pacific - Frozen - Dolls - Do you want to... go ice skating? The Disney Frozen Elsa Ice Skating Toddler Doll comes with an adorable outfit children will recognize from the Disney film Frozen . The beautiful Elsa toddler doll has an elegant tiara and long hair that girls can brush and style. Elsa comes with removable play ice skates which allow children to re-create the ice skating scene from the movie Frozen ....'
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });


    // describe('Pre-order Page', function () {

    //     var payload = {
    //         "pageType": "product",
    //         "url": "http://www.entertainmentearth.com/prodinfo.asp?number=NC54039#.WFfDwXWLT0o",
    //         "html": cache.load("http://www.entertainmentearth.com/prodinfo.asp?number=NC54039#.WFfDwXWLT0o")
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function (err, inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "Teenage Mutant Ninja Turtles Donatello 1:4 Scale Action Figure",
    //                 "price": "96.99",
    //                 "url": payload.url,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": 'http://www.entertainmentearth.com/images/AUTOIMAGES/NC54039lg.jpg',
    //                 "country": 'us',
    //                 "description": "TMNT Donatello 1:4 Scale Action Figure - NECA - Teenage Mutant Ninja Turtles - Action Figures - Cowabunga, dude! Action figure based on the classic Teenage Mutant Ninja Turtles movie. Donatello stands 16 1/2-inches tall and features 30 points of articulation! Accurate to the movie, he comes with a bo staff and interchangeable hands. Here's a 1:4 scale action figure based on the classic Teenage Mutant Ninja Turtles movie. Donatello is the Turtles' resident techno-genius, but make..."
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });


    // describe('Coming in Soon Stock Page', function () {

    //     var payload = {
    //         "pageType": "product",
    //         "url": "http://www.entertainmentearth.com/prodinfo.asp?number=DCL11607#.V858QnUrL0p",
    //         "html": cache.load("http://www.entertainmentearth.com/prodinfo.asp?number=DCL11607#.V858QnUrL0p")
    //     }

    //     it('should return false when product is out of stock', function (done) {

    //         Structure(payload, function (err, inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "Wonder Woman XXRAY 4-Inch Vinyl Figure",
    //                 "price": "19.99",
    //                 "url": payload.url,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": "http://www.entertainmentearth.com/images/AUTOIMAGES/DCL11607lg.jpg",
    //                 "country": 'us',
    //                 "description": "Wonder Woman XXRAY 4-Inch Vinyl Figure - Mighty Jaxx - Wonder Woman - Vinyl Figures - See Diana Prince like never before! The Wonder Woman XXRAY 4-Inch Vinyl Figure features a cross-section the Amazonian Princess. This awesome vinyl figure stands 4-inches tall, features a unique dissection designed by Jason Freeny, and is individually hand painted! Assemble the Justice League with Batman, Superman, The Flash, Aquaman, and Cyborg! (Sold Seperately)"
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     })
    // });

    // describe('Search page pagination', function() {

    //     var payload = {
    //         "pageType" : "pagination",
    //         "url" : ""
    //     }

    //     it('should be true when number of items and pages correct', function (done) {

    //         Structure(payload, function(pagination) {
    //             var expected = JSON.stringify({
    //                 "items": "",
    //                 "pages": ""
    //             })
    //             JSON.stringify(pagination).should.equal(expected);
    //             done()
    //         })
    //     });

    // })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "https://www.entertainmentearth.com/s/construction-toys/p",
            "html": cache.load('https://www.entertainmentearth.com/s/construction-toys/p')
        }

        it('should be true when correct category is returned', function (done) {

            Structure(payload, function(err, category) {
                var expected = JSON.stringify({
                    "name": "Construction Toys",
                    "url": payload.url
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function () {

        var payload = {
            "pageType": "search",
            "url": "https://www.entertainmentearth.com/s/construction-toys/p",
            "html": cache.load("https://www.entertainmentearth.com/s/construction-toys/p")
        }

        // Change to be the number of products on the page
        var x = 60;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function (err, result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'LEGO Boost 17101 Creative Toolbox';
        it('first product should be ' + firstProductName, function (done) {
            Structure(payload, function (err, result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '159.99',
                    url: 'https://www.entertainmentearth.com/product/lego-boost-17101-creative-toolbox/lg17101',
                    image: 'https://media.entertainmentearth.com/assets/images/3b31d7935b584604994b59563d2b3ef2md.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'LEGO Ninjago Movie 70609 Manta Ray Bomber';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function (err, result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '29.99',
                    url: 'https://www.entertainmentearth.com/product/lego-ninjago-movie-70609-manta-ray-bomber/lg70609',
                    image: 'https://media.entertainmentearth.com/assets/images/7b612af4337143779d39eae468e00155md.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});


