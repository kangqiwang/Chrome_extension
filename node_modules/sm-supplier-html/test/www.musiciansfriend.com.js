var should = require('should');
var Structure = require('../lib/structure.js')
const cache = require('../lib/cache')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.musiciansfriend.com/guitars/gl-limited-edition-tribute-legacy-hss-painted-headcap-electric-guitar",
            "html" : cache.load("http://www.musiciansfriend.com/guitars/gl-limited-edition-tribute-legacy-hss-painted-headcap-electric-guitar")
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(err, inStockPage) {
                var expected = JSON.stringify({
                    "name": "G&L Limited Edition Tribute Legacy HSS Painted Headcap Electric Guitar Transparent Red",
                    "price": "432.53",
                    "url": payload.url,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://media.musiciansfriend.com/is/image/MMGS7/Limited-Edition-Tribute-Legacy-HSS-Painted-Headcap-Electric-Guitar-Transparent-Red/J41355000001000-00-500x500.jpg',
                    "country": 'uk',
                    "description": 'The G&L Limited Edition Tribute Legacy HSS fattens things up with a G&L AW4368 alnico bridge humbucker to complement the vintage G&L Alnico V single-coils in the neck and middle positions. The Legacy HSS has that ideal balance that’ll let it play well in a variety of settings.This limited-edition model features a transparent red finish over a mahogany body and 9.5" fingerboard radius.The Legacy HSS brings all of the Legacy features, starting with Leo’s PTB (Passive Treble and Bass) system which functions on all three pickups for dramatically more variety than the vintage setup. What’s more, the Legacy HSS features a Leo Fender-designed Dual-Fulcrum vibrato, a work of engineering art that allows bending up or down with unsurpassed stability, while offering a silky feel through its beefy aluminum vibrato arm.If you’re looking for that extra power to properly rock the house but you don’t want your classic Elvis to leave the building, then you owe it to yourself to check out the Legacy HSS. Once you play a G&L Tribute Series, you’ll never look back. Case sold separately.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.musiciansfriend.com/electric-guitars?_requestid=3804801#pageName=category-page&N=500002&Nao=0&recsPerPage=60&v=g&profileCountryCode=GB&profileCurrencyCode=GBP",
            "html" : cache.load("http://www.musiciansfriend.com/electric-guitars?_requestid=3804801#pageName=category-page&N=500002&Nao=0&recsPerPage=60&v=g&profileCountryCode=GB&profileCurrencyCode=GBP")
            
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(err, pagination) {
                var expected = JSON.stringify({
                    "items": 60,
                    "pages": 2,
                    "url": "http://www.musiciansfriend.com/electric-guitars?_requestid=3804801#pageName=category-page&N=500002&Nao=0&recsPerPage=60&v=g&profileCountryCode=GB&profileCurrencyCode=GBP"
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.musiciansfriend.com/electric-guitars?_requestid=3804801#pageName=category-page&N=500002&Nao=0&recsPerPage=60&v=g&profileCountryCode=GB&profileCurrencyCode=GBP",
            "html" : cache.load("http://www.musiciansfriend.com/electric-guitars?_requestid=3804801#pageName=category-page&N=500002&Nao=0&recsPerPage=60&v=g&profileCountryCode=GB&profileCurrencyCode=GBP")
            
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(err, category) {
                var expected = JSON.stringify({
                    "name": "",
                    "url":"http://www.musiciansfriend.com/electric-guitars?_requestid=3804801#pageName=category-page&N=500002&Nao=0&recsPerPage=60&v=g&profileCountryCode=GB&profileCurrencyCode=GBP"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.musiciansfriend.com/electric-guitars?_requestid=3804801#pageName=category-page&N=500002&Nao=0&recsPerPage=60&v=g&profileCountryCode=GB&profileCurrencyCode=GBP",
            "html" : cache.load("http://www.musiciansfriend.com/electric-guitars?_requestid=3804801#pageName=category-page&N=500002&Nao=0&recsPerPage=60&v=g&profileCountryCode=GB&profileCurrencyCode=GBP")
        }

        // Change to be the number of products on the page
        var x = 60;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(err, result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Mitchell HD400 Hard Rock Double Cutaway Electric G...';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(err, result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '212.92',
                    url: 'http://www.musiciansfriend.com/guitars/mitchell-hd400-hard-rock-double-cutaway-electric-guitar',
                    image: 'http://media.musiciansfriend.com/is/image/MMGS7/HD400-Hard-Rock-Double-Cutaway-Electric-Guitar-Transparent-Blue/J37163000004000-00-220x220.jpg',
                    country: 'uk'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'The Loar LH-309 Hollowbody Electric Guitar';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(err, result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '494.28',
                    url: 'http://www.musiciansfriend.com/guitars/the-loar-lh-309-hollowbody-electric-guitar',
                    image: 'http://media.musiciansfriend.com/is/image/MMGS7/LH-309-Hollowbody-Electric-Guitar/H85995000000000-00-220x220.jpg',
                    country: 'uk'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
