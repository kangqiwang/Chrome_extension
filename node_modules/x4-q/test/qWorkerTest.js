const should = require('should')
const Q = require('../index').q;

const config = {
    host: '127.0.0.1',
    port: 6379,
    username: '',
    passwd:  ''
}

describe('Redis Message Q', function() {    

    this.timeout(10000)

    it('should create a message q', (done) => {
        config.options = {
            interval: 100,
            maxWait: 1000
        }
        const testQ = new Q(config, 'testqworker');

        testQ.worker((err, msg, finish) => {
            if(err) {
                done()
                return
            }
            finish()            
            msg.data.waitTest.should.be.equal('waitTestData')
            testQ.stats((err, stats) => {
                should(err).be.equal(null)
                stats.totalrecv.should.be.equal(1)
                stats.totalsent.should.be.equal(1)
                testQ.delete((err, resp) => {
                    should(err).be.equal(null)
                    resp.should.be.equal(1)
                    done()
                })   
            })
        })

        console.log('ADDING MESSAGE in 5 seconds')
        setTimeout(() => {            
            testQ.send('MESSAGE_TYPE', {
                waitTest: 'waitTestData'
            }, (err, res) => {
            })
        }, 5000)


    })

})
