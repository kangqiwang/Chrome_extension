var should = require('should');
var Structure = require('../lib/structure.js')

describe('www.iwantoneofthose.com', function() {

    before(function()  {
        this.timeout(5000);
    })

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.iwantoneofthose.com/gift-tech-stuff/plug-and-play-retro-tv-games/11164059.html?shippingcountry=GB&switchcurrency=GBP"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Plug and Play Retro TV Games",
                    "price": "9.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": "http://s4.thcdn.com/productimg/600/600/11164059-2054326666912621.jpg",
                    "country": "uk",
                    "description": "If you are a child of the ‘80s you may reminisce over the video games you used to play. Well reminisce no more! The Plug and Play Retro TV Games will transport you back to the heady days of Pong, Space Base, Racing Fighter and many, many more. The compact, portable controller that easily connects to your 21st century TV, will in moments immerse you  back to your childhood. Or give the kids a ‘living history’ lesson of how we used to live!With 200 games including action, puzzles, shooting and arcade games to choose from, you will while away many hours with the quirky joy stick and ‘A’ and ‘B’ buttons on the controller. Features:Plug and Play Retro TV Games ControllerWired retro gaming controller has a joystick and ‘A’ and ‘B’ buttons.200 retro gamesRequires 3 x AAA batteriesWorks with PAL Video System only"
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : "http://www.iwantoneofthose.com/toys-radio-control/arcade-pico-drone-2.4g-mini-pocket-quadcopter-blue/11229947.html"
    //     }

    //     it('should return false when product is out of stock', function(done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "Arcade PICO Drone 2.4G Mini Pocket Quadcopter - Blue",
    //                 "price": "19.99",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     })

    // })

    describe('Pre order Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.iwantoneofthose.com/merch-figures/marvel-deadpool-shower-cap-exclusive-pop-vinyl-figure/11247311.html?switchcurrency=GBP&shippingcountry=GB"
        }

        it('should return false when product is out of stock', function(done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Marvel Deadpool Shower Cap Exclusive Pop! Vinyl Figure",
                    "price": "13.99",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": "http://s1.thcdn.com/productimg/600/600/11247311-1334366671685761.jpg",
                    "country": "uk",
                    "description": "This POP! Vinyl figure has a rotating head and comes in a displayable window box! It stands approx. 9 cm tall."
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        })

    })


    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.iwantoneofthose.com/offers/mothers-day-gifts/all-gifts.list?shippingcountry=GB"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 81,
                    "pages": 3
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.iwantoneofthose.com/offers/mothers-day-gifts/all-gifts.list?shippingcountry=GB"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Mother's day gifts"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

     describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.iwantoneofthose.com/offers/mothers-day-gifts/all-gifts.list?shippingcountry=GB"
        }

        // Change to be the number of products on the page
        var x = 81;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'IWOOT Mystery Gift Box - For Her';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '24.99',
                    url: 'http://www.iwantoneofthose.com/gift-hampers/iwoot-mystery-gift-box-for-her/11215410.html',
                    image: 'https://s3.thcdn.com/productimg/180/180/11215410-1764421090938899.jpg',
                    country: 'uk'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Baylis & Harding Mosaic Sweet Mandarin and Grapefruit Hand Wash (500ml)';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '3.00',
                    url: 'http://www.iwantoneofthose.com/home-accessories/baylis-harding-mosaic-sweet-mandarin-and-grapefruit-hand-wash-500ml/11035701.html',
                    image: 'https://s3.thcdn.com/productimg/0/180/180/01/11035701-1416389759-874614.jpg',
                    country: 'uk'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });



});
