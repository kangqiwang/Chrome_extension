var should = require('should');
var Structure = require('../lib/structure.js')

describe('www.colehaan.com', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.colehaan.com/women%27s-lockridge-waterproof-double-collar-lace-boot-woodbury-waterproof/W05471.html?dwvar_W05471_color=Woodbury%20Waterproof&dwvar_W05471_width=B"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Women's Lockridge Waterproof Double Collar Lace Boot",
                    "price": "320.00",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://www.colehaan.com/dw/image/v2/AALO_PRD/on/demandware.static/-/Sites-itemmaster_colehaan/default/dw5ca113cd/images/large/W05471_A.jpg?sw=2000',
                    "country": 'us',
                    "description": 'Expertly crafted in oil-tanned waterproof leather, Lockridge features a lugged rubber outsole with our Grand.OS technology for greater flexibility, reduced weight, and increased cushioning. Leather laces provide the perfect rustic touch.Waterproof leather makes for a water-resistant shoe.Full-grain, seam-sealed leather creates an impenetrable barrier that keeps the foot dry in any condition.A lightweight heel pillow increases comfort and reduces stress on the foot.Lined in fleece.Leather laces.Grand.OS technology for all-day standing comfort.EVA midsole.Rubber lug outsole is designed for unsurpassed grip and durability in any terrain. Style #W05471'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.colehaan.com/smooth-lamb-shirt-collar-moto-jacket-black/013816371981.html"
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Smooth Lamb Shirt Collar Moto Jacket",
                    "price": "399.95",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": 'http://www.colehaan.com/dw/image/v2/AALO_PRD/on/demandware.static/-/Sites-itemmaster_colehaan/default/dw0cec62b3/images/large/G49775_A.jpg?sw=2000',
                    "country": 'us',
                    "description": "This smooth shirt-collar jacket in black is the definition of classic cool. Pair it with jeans and a pair of loafers or oxfords for a clean-cut look - and don't worry about the temperature, this moto jacket is fully lined.27\" Smooth Lamb Shirt Collar Jacket.Fully lined.Imported. Style #G49775"
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.colehaan.com/womens-shoes-boots"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Women's Boots & Booties : Shoes"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.colehaan.com/womens-shoes-boots"
        }

        // Change to be the number of products on the page
        var x = 97;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'ZERÃ˜GRAND Waterproof Hiker Boot';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '250.00',
                    url: 'http://www.colehaan.com/zerogrand-waterproof-hiker-boot-black-waterproof-leather-tweed/W04238.html?dwvar_W04238_color=Black%20Waterproof%20Leather-tweed&dwvar_W04238_width=B',
                    image: 'http://www.colehaan.com/dw/image/v2/AALO_PRD/on/demandware.static/-/Sites-itemmaster_colehaan/default/dw5afa473e/images/large/W04238_A.jpg?sw=350',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Evren Waterproof Tall Boot (30mm)';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '269.95',
                    url: 'http://www.colehaan.com/evren-waterproof-tall-boot-%2830mm%29-stormcloud-waterproof-leather/W03102.html?dwvar_W03102_color=Stormcloud%20Waterproof%20Leather&dwvar_W03102_width=B',
                    image: 'http://www.colehaan.com/dw/image/v2/AALO_PRD/on/demandware.static/-/Sites-itemmaster_colehaan/default/dwfbe5e6c5/images/large/W03102_A.jpg?sw=350',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
