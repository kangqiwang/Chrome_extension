var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.simplicity.com/ornament-cutters-bundle_879908/879908.html"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Ornament Cutters Bundle_879908",
                    "price": "18.17",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://demandware.edgesuite.net/sits_pod26/dw/image/v2/AAWA_PRD/on/demandware.static/-/Sites-simplicity-product-master/default/dwcfe0d44f/images/product/879908/EK-Tools-Ornament-Cutter-Bundle-879908.jpg?sw=502&sh=502&sm=fit',
                    "country": 'us',
                    "description": 'Add to your creative tool collection with this Ornament Cutters Bundle from EK Tools. Bundle features 4 different cutter sets to create a wide variety of shapes and sizes of ornaments, decorations, and other paper crafts. Included are the double circle, spiral, swirl, and ornament templates with blades. The shuttle blade easily attaches onto the inside or outside track to cut shapes in seconds. The cutters work best with regular and craft paper, and the non-slip feet hold the templates in place while cutting. Each cutter tool set includes a step-by-step instruction booklet to make 1-3 projects. Share your joy of paper crafting when you give these cutter tool sets as gifts, and enjoy a savings of 30% compared to items sold separately. Please note that bundles are not eligible for additional sale discounts.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.simplicity.com/search?q=decor&prefn1=contentType&sz=90&prefv1=simplicity-tools-supplies"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 90,
                    "pages": 14
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.simplicity.com/search?q=decor&prefn1=contentType&sz=90&prefv1=simplicity-tools-supplies"
        }

        // Change to be the number of products on the page
        var x = 90;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Ornament Cutters Bundle_879908';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '18.17',
                    url: 'http://www.simplicity.com/ornament-cutters-bundle_879908/879908.html',
                    image: 'http://demandware.edgesuite.net/sits_pod26/dw/image/v2/AAWA_PRD/on/demandware.static/-/Sites-simplicity-product-master/default/dwcfe0d44f/images/product/879908/EK-Tools-Ornament-Cutter-Bundle-879908.jpg?sw=286&sh=286',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Burda Style Pattern 9650 Coordinates';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '7.77',
                    url: 'http://www.simplicity.com/burda-style-pattern-9650-coordinates/B9650.html',
                    image: 'http://demandware.edgesuite.net/sits_pod26/dw/image/v2/AAWA_PRD/on/demandware.static/-/Sites-simplicity-product-master/default/dw1ad28548/images/product/B9650/B9650_env_front.jpg?sw=286&sh=286',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.simplicity.com/needle-arts/"
        }

        it('should be true when the category is correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Needle Arts"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

});
