var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.electricshop.com/pioneer-secl501r-fully-enclosed-dynamic-in-ear-headphones-in-red"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Pioneer SECL501R Fully Enclosed Dynamic In Ear Headphones in Red",
                    "price": "12.95",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://www.electricshop.com/sysimgdocs/rszsubimages/SE-CL501-R_pr24316_1.jpg',
                    "country": 'uk',
                    "description": 'Pioneer SECL501R Fully Enclosed Dynamic In Ear Headphones in RedThese affordably priced headphones come with a fully enclosed design that ensures excellent noise-isolation and powerful bass reproduction. Three types of ear tips are included for a secure and comfortable fit. These earphones are available in Black, White, Blue, Green, Red, Pink and Orange. Box Contains2 x Ear Tips (S / M / L)User Manual'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Discontinued Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.electricshop.com/samsung-ue19h4000-19-hd-ready-led-tv-free-5-year-warranty-"
        }

        it('should return false when product is only available in store', function(done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Discontinued - Samsung UE19H4000 19'' HD Ready LED TV",
                    "price": "", // discontinued item
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": "http://www.electricshop.com/sysimgdocs/rszsubimages/H4000_pr21919_1.jpg",
                    "country": "uk",
                    "description": "The UE19H4000 from Samsung features an HD Ready LED display, as well as various additional and useful functions. With the Wide Colour Enhancer, the UE19H4000 brings out every colour with exceptional vitality and detail. The 100Hz Clear Motion Rate stops movement from blurring, for seamless fluidity. The Football Mode setups the UE19H4000 for the match, changing numerous settings to bring out the best of the sport. ConnectShare Movie is an additional feature, where you can connect a USB device to playback content such as movies, music and photos on the UE19H4000. Also known as: UE19H4000, UE 19H4000, UE H4000, UEH4000, H4000, UE-H4000, UE-H4000, UE-19H4000 Picture Quality   HD READY  100Hz CMR  Wide Colour Enhancer  Design   Rectangular Stand  Narrow Bezel  Features   Freeview  Football Mode (Basic)  ConnectShare Movie  Std remote "
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        })

    });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.electricshop.com/headphones/in-ear-headphones/icat/in-ear-headphones#b"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 24,
                    "pages": 2
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.electricshop.com/headphones/in-ear-headphones/icat/in-ear-headphones#b"
        }

        it('should be true when correct category is returned', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "In-Ear Headphones"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.electricshop.com/headphones/in-ear-headphones/icat/in-ear-headphones#b"
        }

        // Change to be the number of products on the page
        var x = 24;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Pioneer SECL501R Fully Enclosed Dynamic In Ear Headphones in Red';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '12.95',
                    url: 'http://www.electricshop.com/pioneer-secl501r-fully-enclosed-dynamic-in-ear-headphones-in-red',
                    image: 'http://www.electricshop.com/sysimgdocs/rszlistimages/SE-CL501-R_pr24316_1.jpg',
                    country: 'uk'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Sennheiser MOMENTUM-M2 IEi for Apple devices - Black and Chrome';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '89.99',
                    url: 'http://www.electricshop.com/sennheiser-momentum-m2-iei-for-apple-devices-black-and-chrome',
                    image: 'http://www.electricshop.com/sysimgdocs/rszlistimages/product-detail-x1-desktop-momentum-in-ear-chrome-600x600001_pr24271_1.jpg',
                    country: 'uk'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
