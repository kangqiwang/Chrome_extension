var should = require('should');
var Structure = require('../lib/structure.js')

describe('www.puritan.com', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.puritan.com/vitamins-ad-081/vitamin-d3-1000-iu-015605"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Vitamin D3 1000 IU",
                    "price": "5.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://images.vitaminimages.com/pp/VF/Assets/Puritan_products/Detail_page/015605.jpg',
                    "country": 'us',
                    "description": "All Puritan’s Pride Vitamin D formulas are Sunvite® D3, a potent and active form of Vitamin D. Together with Calcium, Vitamin D helps develop strong bones and teeth, and also assists in immune system health.**Vitamin D3 is a more potent and bioavailable form compared to D2.Helps maintain healthy bones in adults. **Assists in maintaining a healthy immune system.**Supports neuromuscular function. ** No Artificial Color, Flavor or Sweetener, No Preservatives, No Sugar, No Milk, No Lactose, No Gluten, No Wheat, No Yeast, No Fish, Sodium Free."
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.puritan.com/performance-workout-732/ppoptml-carbsmart-stck1kit-017666"
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Optimal Carb Smart Workout Stack",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": 'http://images.vitaminimages.com/pp/VF/Assets/Puritan_products/Detail_page/017666.jpg',
                    "country": 'us',
                    "description": "Isopure Zero Carb Whey Protein Isolate Creamy Vanilla: Nature's Best Zero Carb Isopure contains 50 grams of 100% Ion Exchange Whey Protein Isolate. Any and all impurities typically found in most whey proteins have been removed to provide you with a great tasting, lactose free, fat free, glutamine enriched, state of the art carbohydrate free protein supplement.Nature's Best set out to create a product that didn't hide anything from its customers. We wanted you to know that you're purchasing the best product available on the market. Our protein source is clearly identified as 100% Pure Ion Exchange Whey Protein Isolate. We didn't try to confuse you by listing a protein blend that doesn't tell you how much of the product is superior whey protein isolate and how much is whey protein concentrate or sweet whey or some other inferior protein source.Creatine Extreme 1000 mg:Enhances the ability of muscles to produce higher muscular force, especially during short bouts of maximal exercise.**Helps promote athletic performance**Excellent supplemental choice for athletes and hardcore bodybuilders.Each capsule contains HPLC Pure Creatine Monohydrate 1000 mg.D-Ribose PowderRibose is an energizing nutrient for the heart, and supports healthy heart function**Although Ribose is naturally made by your body’s cells, not every cell is able to make it quickly – which is why D-Ribose powder is a great way to maintain sufficient levelsOur vegetarian powder formula mixes easily with water and other beveragesIt is a great supplemental choice before and after exercise, or with your meals"
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Search page pagination', function() {

    //     var payload = {
    //         "pageType" : "pagination",
    //         "url" : ""
    //     }

    //     it('should be true when number of items and pages correct', function (done) {

    //         Structure(payload, function(pagination) {
    //             var expected = JSON.stringify({
    //                 "items": "",
    //                 "pages": ""
    //             })
    //             JSON.stringify(pagination).should.equal(expected);
    //             done()
    //         })
    //     });

    // })

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.puritan.com/vitamins-ad-081?page=0"
        }

        // Change to be the number of products on the page
        var x = 33;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Vitamin D3 5000 IU';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '9.99',
                    url: 'http://www.puritan.com/vitamins-ad-081/vitamin-d3-5000-iu-019377',
                    image: 'http://images.vitaminimages.com/pp/VF/Assets/Puritan_products/019377.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Liquid Vitamin D-3 1,000 IU';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '7.99',
                    url: 'http://www.puritan.com/vitamins-ad-081/ppliquid-vitamin-d-31000iu-006103',
                    image: 'http://images.vitaminimages.com/pp/VF/Assets/Puritan_products/006103.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });
    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.puritan.com/vitamins-ad-081?page=0"
        }

        it('should be true when the category is correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Vitamins A&D"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

});
