var should = require('should');
var Structure = require('../lib/structure.js')

describe('OxfordUniversityPress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://global.oup.com/education/product/9780198413165/?region=uk"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Edexcel A Level Maths: Year 1 / AS Student Book",
                    "price": "28.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://fdslive.oup.com/covers/oxed/medium/9780198413165.jpg',
                    "country": 'uk',
                    "description": "This Student Book provides full support for Edexcel's new linear AS Level and for Year 1 of the full A Level. Written by a team of experienced teachers, this book supports the major changes in assessment style. Using clear and concise explanations, and abundant worked examples, it covers all the pure, mechanics and statistics content needed. Features Dedicated exercises in every chapter section provide practice for the new, exam-style problem-solving and modelling questions Revision exercises test synoptically across the curriculum Review pages allow students to test their understanding of each chapter and, depending on performance, provide differentiated suggestions for further study Short answers are provided in the back of the book for quick reference Full step-by-step solutions to every question are available FREE online and allow students to check their own workings in detail Colourful chapter opening pages give the maths context and purpose, while an Exploration page at the end provides historical notes and investigations Links to MyMaths.co.uk after every exercise provide a quick route to further practice and support where needed Also available in the series: Edexcel A Level Maths Year 2 Student Book, Edexcel A Level Maths Combined Student Book, plus student books to cover all Further Maths options. This page was last updated on 20 November 2016 at 04:30 GMT"
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /* No information about 'Out of Stock' */
    /*
    describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });
    */

    // describe('Search page pagination', function() {

    //     var payload = {
    //         "pageType" : "pagination",
    //         "url" : "https://global.oup.com/education/content/secondary/series/edexcel-alevel-maths/?sortfield=relevance&search_input=&region=uk&view=ProductList&prevNumResPerPage=10&start=0&numResultsPerPage=10"
    //     }

    //     it('should be true when number of items and pages correct', function (done) {

    //         Structure(payload, function(pagination) {
    //             var expected = JSON.stringify({
    //                 "items": 10,
    //                 "pages": 3
    //             })
    //             JSON.stringify(pagination).should.equal(expected);
    //             done()
    //         })
    //     });

    // })

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://global.oup.com/education/content/secondary/series/edexcel-alevel-maths/?sortfield=relevance&search_input=&region=uk&view=ProductList&prevNumResPerPage=10&start=0&numResultsPerPage=seeall"
        }

        // Change to be the number of products on the page
        var x = 24;
        it('should return ' + x + ' number of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Edexcel A Level Maths: Year 1 / AS Student Book';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '28.99',
                    url: 'https://global.oup.com/education/product/9780198413165?region=uk',
                    image: 'http://fdslive.oup.com/covers/oxed/medium/9780198413165.jpg',
                    country: 'uk'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Edexcel A Level Further Maths: Further Decision 2 Student Book';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '17.99',
                    url: 'https://global.oup.com/education/product/9780198415329?region=uk',
                    image: 'http://fdslive.oup.com/covers/oxed/medium/9780198415329.jpg',
                    country: 'uk'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
