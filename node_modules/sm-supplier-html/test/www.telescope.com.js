var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.telescope.com/Telescopes/Sale-Telescopes/Sale-Beginner-Telescopes/Orion-SkyScanner-100mm-Reflector-Telescope-and-Tripod-Bundle/pc/1/c/378/sc/436/p/100318.uts"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Orion SkyScanner 100mm Reflector Telescope and Tripod Bundle",
                    "price": "158.09",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://orion.scene7.com/is/image/Orion/27188_mm?$mm_placeholder$',
                    "country": 'us',
                    "description": 'Our popular Orion SkyScanner 100mm TableTop Reflector is now available in this value-packed bundle including a field tripod and high-power 6.3mm eyepiece!Whether used out in the field, or on the backyard table, the Orion SkyScanner 100mm Reflector and Tripod Bundle makes it easy to enjoy the wonders of the night skyAn ideal entry-level reflector telescope with 100mm parabolic primary mirror optics - no plastic lenses as found in some other telescopes made for beginnersSee hundreds of craters on the Moon, detail on Jupiter and other planets, even when viewing from relatively bright city locationBundle also includes three 1.25" telescope eyepieces: 20mm (for 20 power magnification), 10mm (for 40 power magnification), and a high-power 6.3mm (for 63.5 power magnification); an EZ Finder II aiming device, Starry Night astronomy software, and more! Learn more'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.telescope.com/Telescopes/Sale-Telescopes/Sale-Beginner-Telescopes/pc/1/c/378/436.uts"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 20,
                    "pages": 2
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.telescope.com/Telescopes/Sale-Telescopes/Sale-Beginner-Telescopes/pc/1/c/378/436.uts"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Sale Beginner Telescopes"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.telescope.com/Telescopes/Sale-Telescopes/Sale-Beginner-Telescopes/pc/1/c/378/436.uts"
        }

        // Change to be the number of products on the page
        var x = 20;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Orion SkyScanner 100mm Reflector Telescope and Tripod Bundle';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '158.09',
                    url: 'http://www.telescope.com/Telescopes/Sale-Telescopes/Sale-Beginner-Telescopes/Orion-SkyScanner-100mm-Reflector-Telescope-and-Tripod-Bundle/pc/1/c/378/sc/436/p/100318.uts',
                    image: 'http://orion.scene7.com/is/image/Orion/340x340_template?$160x160$&$icon=sale&$prod=is{Orion//27188?scl-=}',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'FunScope 76mm TableTop Reflector Telescope Moon Kit';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '79.99',
                    url: 'http://www.telescope.com/Telescopes/Sale-Telescopes/Sale-Beginner-Telescopes/FunScope-76mm-TableTop-Reflector-Telescope-Moon-Kit/pc/1/c/378/sc/436/p/116467.uts',
                    image: 'http://orion.scene7.com/is/image/Orion/340x340_template?$160x160$&$icon=sale&$prod=is{Orion//20613?scl-=}',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
