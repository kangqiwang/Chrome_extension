var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.the-house.com/9852t1iden14zz-2117-of-sweden-snowboards.html"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "2117 of Sweden Identity Snowboard",
                    "price": "149.95",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://images.the-house.com/2117-identity-snwbrd-all-14-zoom.jpg',
                    "country": 'us',
                    "description": 'Description: 2117 of Sweden Identity Snowboard Key Features of the 2117 Of Sweden Identity Snowboard: Construction Cap construction Base UHMW extruded base - the very best extruded base material available for crisp clear graphics and a low maintenance ride Carbon Steel Edges Full wrap Rockwell 48ยบ carbon steel edges Rubber Foil Dampeners We use rubber foil along the edges for a smooth ride and a strong bond Non woven tip and tail inserts We use a non woven fabric inserts in the tip and tail for increased durability Bii Axial Stitched fiberglass 2 separate layers of 0ยบ and 90ยบ bias fiberglass stitched together to foam and strong durable board and to maintain the original ride characteristics longer Full wood core Our core feature 1" stringers of poplar which have a great strength to weight ratio. We reinforce this with with bamboo stringers along the inserts for increased strength and durability ICP2112 topsheet material A strong durable topsheet material that provides for vibrant graphics UV lacquer coating We apply a UV lacquer coating to prevent graphics from fading 12 pack of stainless steel inserts we use 2 12 packs 2x2 of stainless steel inserts to provide the maximum number of stance options Zero Camber with late kick Dimensions Length (cm) 148 150 152 153 154 157 161 Effective Edge (cm) 115.7 117 117 121 121 123 126 Tip Width (cm) 28.6 28.8 28.8 29.4 29.4 29.8 30.1 Tail Width (cm) 28.6 28.8 28.8 29.4 29.4 29.8 30.1 Waist Width (cm) 24.6 24.7 24.7 25 25 25.3 25.5 Sidecut (m) 9.5/7.5 9.5/7.5 9.5/7.5 9.5/7.5 9.5/7.5 10/7.8 10/7.8 Identity'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.the-house.com/camping-accessories.html"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 40,
                    "pages": 3
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.the-house.com/snbd-all-mountain-snowboards.html?refine.itemsperpage=120"
        }

        it('should return the category', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "All Mountain Snowboards"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.the-house.com/snhat-kids-beanies.html"
        }

        // Change to be the number of products on the page
        var x = 40;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Burton All Day Long Beanie - Kids, Youth';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '8.95',
                    url: 'http://www.the-house.com/bt8adlkbo16zz-burton-beanies.html',
                    image: 'http://images.the-house.com/burton-all-day-long--kids-beanie-burner-16-prod.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Burton Mini Trapper Beanie - Kids, Youth';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '26.95',
                    url: 'http://www.the-house.com/bt8mtrpkglb17zz-burton-beanies.html',
                    image: 'http://images.the-house.com/burton-mini-trapper-kids-beanie-glacier-blue-17-prod.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
