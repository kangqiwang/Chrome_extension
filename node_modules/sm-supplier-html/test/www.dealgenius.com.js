var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.dealgenius.com/5pk-disney-hardcover-books-classic-films-brought-to-the-page.html"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "5pk Disney Hardcover Books – Classic Films Brought To The Page!",
                    "price": "14.00",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://dealgenius.ecomitizellc.netdna-cdn.com/media/catalog/product/cache/1/image/800x/9df78eab33525d08d6e5fb8d27136e95/a/4/a469__1.jpg',
                    "country": 'us',
                    "description": '    tell it to me straightFor generations, Disney movies have been essential childhood entertainment, great for both teaching moral lessons and developing the imagination. Now your child can experience the same magic they see on the screen in a more educational format: on the page! Each short hardcover book tells the tale of a different classic Disney film (5 in all!) with true-to-the-film details and vivid full color illustrations.-Colby B., Professor of Dealologynuts & bolts5 Disney films brought from the screen to the pageFull color illustrations; true-to-the-film detailsGreat gift for kids, holidays, children educationWalt Disney Classic Movies Series Collection setPublished by Parragon, printed in ChinaEach book: 11”H x 8”W x 0.5” thick, 69 pageswhat’s in the box(5)pk Disney Hardcover Books Includes: (1) The Lion King, (1) Bambi, (1) 101 Dalmatians, (1) Peter Pan , (1) Pinocchio, Published by Parragon, New    '
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.dealgenius.com/catalogsearch/result/?q=men&dir=asc"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 48,
                    "pages": 20
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.dealgenius.com/menu/electronics.html"
        }

        it('should be true when correct category is returned', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Electronics"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.dealgenius.com/catalogsearch/result/?q=men&dir=asc"
        }

        // Change to be the number of products on the page
        var x = 48;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = '5pk Disney Hardcover Books – Classic Films Brought To The Page!';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '14.00',
                    url: 'http://www.dealgenius.com/5pk-disney-hardcover-books-classic-films-brought-to-the-page.html',
                    image: 'http://dealgenius.ecomitizellc.netdna-cdn.com/media/catalog/product/cache/1/small_image/224x/9df78eab33525d08d6e5fb8d27136e95/a/4/a469__1.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Lucien Picard Men’s Silver-Tone Quartz Watch – Button Clasp';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '49.00',
                    url: 'http://www.dealgenius.com/lucien-picard-men-s-silver-tone-quartz-watch-button-clasp.html',
                    image: 'http://dealgenius.ecomitizellc.netdna-cdn.com/media/catalog/product/cache/1/small_image/224x/9df78eab33525d08d6e5fb8d27136e95/h/w/hws008_1.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
