var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.findmeagift.co.uk/gifts/retro-wooden-foosball-table.html"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Retro Wooden Foosball Table",
                    "price": "10.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://resources.findmeagift.com/site_media/images/products/p_main/pal548 - retro wooden foosball table-wb-1001.jpg',
                    "country": 'uk',
                    "description": "Retro Wooden Foosball TableOnly Foos Rush InIf you're always up for some friendly competition that might get a bit rowdy and shouty, we've got just the game for you! Perfect for parties and get togethers with friends, Foosball is the classic game we all know and love- who doesn't prefer their men entirely devoid of autonomy and impaled on sticks?This mini football table is made from wood and features high quality design details, such as soft grip handles and a score panel on both sides, so you can both easily keep track of the goal count, leaving you free to argue about more important things like whether or not spinning is an illegal move.Our wooden foodball table is great for bringing out whenever you have friends over, and makes a fab gift for footie fans of all ages. Just like Jose Mourinho, use all your skill and nounse to guide your team to victory (by twirling some sticks about a bit).About The Product    The spinnacle of table top gaming!    A great way to play football indoors without annoying your mum    Comes in a cool retro style box    Made from wood    Features score panels, soft grip handles and ball return holes    Includes 2 x balls    Adult assembly required    Designed in the UK    Base measures approx. 50 x 31.5 x 11 cm    Warning: contains small parts, which may present a choking hazard to young children and infantsWhat Do You Get?    1 x Retro Wooden Foosball Table (not pre-assembled)    2 x BallsIrresistible Reasons To Buy    A generous 30 day money back guarantee.    Collect loyalty points and use them for discounts on future purchases.    Unique gifts for all tastes, budgets and occasions.    Award winning UK based customer service, with online chat support, telephone and email all available.    Next day delivery to ensure you get your gifts fast.Product code: pal548"
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.findmeagift.co.uk/gifts-for-men/all.html"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 30,
                    "pages": 10
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.findmeagift.co.uk/gifts-for-men/all.html"
        }

        it('should be true when correct category is returned', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Mens Gift Ideas"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.findmeagift.co.uk/home-accessories/"
        }

        // Change to be the number of products on the page
        var x = 30;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Glass Bottle Light';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '4.99',
                    url: 'http://www.findmeagift.co.uk/gifts/glass-bottle-light.html',
                    image: 'http://resources.findmeagift.com/site_media/images/products/380/oob360-glass-bottle-light-lifestyle1-FC-1800x1800.jpg',
                    country: 'uk'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'I Love You To The Moon And Back Mum Photo Frame';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '14.99',
                    url: 'http://www.findmeagift.co.uk/gifts/i-love-you-to-the-moon-and-back-mum-photo-frame.html',
                    image: 'http://resources.findmeagift.com/site_media/images/products/380/pmc1815%20-%20I%20Love%20You%20To%20The%20Moon%20And%20Back%20Mum%20Photo%20Frame-Lifestyle-1800x1800.jpg',
                    country: 'uk'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
