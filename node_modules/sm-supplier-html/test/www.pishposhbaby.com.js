var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.pishposhbaby.com/uppababy-vista-2015.html"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Uppababy Vista 2016 Stroller",
                    "price": "839.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://ep.yimg.com/ay/yhst-14016457918231/uppababy-vista-2015-88.gif',
                    "country": 'us',
                    "description": "Uppababy has upgraded the Uppababy Vista 2015/2016 significantly and it's now a real convertible stroller that will truly grow with your family. The 2016 Uppababy Vista stroller can now hold two toddler seats in either direction, two car seats, and even two bassinets - all the while strolling like a single stroller!NEW FEATURES ON THE 2015/2016 VISTAUPDATED DOUBLE OPTIONSONE STEP FOLDONE-PIECE BUMPER BARALUMINUM + MAGNESIUM FRAMEBASSINET ZIP-OUT LINER & BOOT COVERNEVER-FLAT AIRGO WHEELSA CLOSER LOOK AT THE VISTAREVERSIBLE SEAT5 POSITION, FLAT RECLINEHEIGHT-ADJUSTABLE CANOPY & HANDLEBARONE-PIECE COMPACT FOLDPOP-OUT SPF 50+ SUNSHADEXL UNDERSEAT BASKETINCLUDED BASSINETINCLUDED ACCESSORIESClassic Vista features:Fully upright seat positionEasy to activate brake systemBassinet pop-out ventilated SPF 50+ sun-shadeExtended seat height to accommodate taller childrenSmooth no-flat wheelsAdjustable handle heightSingle push-button wheel removalPlush seat cushion with extra paddingFold and stand with one motion with seat attachedReversible and reclinable seatFull size, easy access underseat basket4-wheel suspension and sealed wheel bearingsColor-coded attachment indicatorsReversible, organic pram mattress - microsuede on one side and cool mesh on the otherRemovable, washable fabricsAdjustable Canopy HeightMagnetic Peek-a-boo flap closureVentilation window under the mattress for extra breathabilityRead more about the new Uppababy Vista on our blog!year: 2016convertible: yesdimensions: 26.5”W x 37”L x 39.5”Hfolded dimensions: 26.5”W x 14”L x 33”Hweight: 27.5 lbsweight capacity: 50 lbswheel size: 8\"/11.5\"wheel type: AIRGo, Never-flatrecline: 5 Position, Flatbassinet available: yescarseat compatible: yeshead height: 24\"reversible seat: yesadjustable handlebar: yesharness: 5-pointbox dimensions: 23.9\" x 16.5\" x 33.3\"BaseToddler SeatBassinetBumper BarRain CoverBug CoverBassinet Bug Cover"
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.pishposhbaby.com/strollers-single-strollers.html#"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 16,
                    "pages": 7
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.pishposhbaby.com/strollers-single-strollers.html#"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Single Strollers"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.pishposhbaby.com/strollers-single-strollers.html#"
        }

        // Change to be the number of products on the page
        var x = 16;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Uppababy Vista 2016 Stroller';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '839.99',
                    url: 'http://www.pishposhbaby.com/uppababy-vista-2015.html',
                    image: 'http://ep.yimg.com/ay/yhst-14016457918231/uppababy-vista-2015-85.gif',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Mountain Buggy Nano 2016';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '249.99',
                    url: 'http://www.pishposhbaby.com/mountain-buggy-nano-2016.html',
                    image: 'http://ep.yimg.com/ay/yhst-14016457918231/mountain-buggy-nano-2016-28.gif',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
