var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://uk.puma.com/uk/en/pd/ignite-evoknit-men%E2%80%99s-trainers/189697.html?dwvar_189697_color=Puma%20White-Quarry-Vaporous%20Gray"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "IGNITE evoKNIT Men’s Trainers",
                    "price": "90.00",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://pumaecom.scene7.com/is/image/PUMAECOM/189697_03_01_EEA',
                    "country": 'uk',
                    "description": 'IGNITE evoKNIT Men’s Trainers: Unsurpassed wearing comfort is a given with the all-new IGNITE evoKNIT and its form-fitting, mid-height knitted upper. A TPU piece and support strap stabilize the heel by locking it onto the platform, while seamlessly bonded overlays increase comfort and fit. Mounted on the classical IGNITE tooling for maximum energy return. Sock-like knitted textile upper with bold collar height. Moulded EVA sockliner hugs the arch. IGNITE Foam midsole for high-rebound cushioning. Chevron flex grooves for increased energy return. ForEverFoam at heel for optimal durability. Flexibility through forefoot flex grooves. Transition Line mimics the natural gait pattern. Smoother toe-off for a fluid ride. EverTrack for durability in high-wear areas. This product has a larger fit. Please consider purchasing one size smaller than your usual size.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : ""
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": "",
                    "pages": ""
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })*/

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://uk.puma.com/uk/en/men/shoes"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Men Shoes"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://uk.puma.com/uk/en/men/shoes"
        }

        // Change to be the number of products on the page
        var x = 644;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'evoSPEED 17 SL-S FG Men’s Football Boots';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '160.00',
                    url: 'http://uk.puma.com/uk/en/pd/evospeed-17-sl-s-fg-men%E2%80%99s-football-boots/104010.html?dwvar_104010_color=Safety%20Yellow-Puma%20Black-Green%20Gecko',
                    image: 'http://cdn-eu-cf.yottaa.net/57027531312e5851fe00162d/6533b50020fb013494b70a3ba3fac80a.yottaa.net/v~13.1c.0.0/is/image/PUMAECOM/104010_01_01_EEA?$PUMA_GRID$&yocs=_&yoloc=eu',
                    country: 'uk'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'ST Runner Nylon Trainers';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '35.00',
                    url: 'http://uk.puma.com/uk/en/pd/st-runner-nylon-trainers/356738.html?dwvar_356738_color=Tempest-Puma%20White',
                    image: 'http://pumaecom.scene7.com/is/image/PUMAECOM/356738_32_01_EEA?$PUMA_GRID$',
                    country: 'uk'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
