var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.alza.co.uk/toys/wiky-territory-laser-game-double-set-d4529264.htm?catid=18857282"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Wiky Territory Laser Game - Double set",
                    "price": "64.43",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'https://i.alza.cz/ImgW.ashx?fd=f3&cd=HRAa10168',
                    "country": 'uk',
                    "description": ' New safe fun with a double set of Wiki Therritory Laser Game is for all those who love the real shooter with friends. This game will enchant and immersive.For all fans of shooting games, paintball games and the like there is a new opportunity to stimulate adrenaline. The new double'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.alza.co.uk/toys/boom-co-stealth-ambush-d2170986.htm?catid=18857282"
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Boom Co Stealth Ambush",
                    "price": "36.29",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": 'https://i.alza.cz/ImgW.ashx?fd=f3&cd=HRAa1385',
                    "country": 'uk',
                    "description": " Vymakan√© gun Stealth Ambush should definitely not miss any gun lover Boom Co. Only this gun with folding handle I guarantee that you'll always be one step ahead of other players! It offers a range of up to 21 meters and comes with 17 original arrows with patented Smart Stick and training target."
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "https://www.alza.co.uk/toys/lego-ninjago/18852398.htm"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 28,
                    "pages": 2
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.alza.co.uk/toys/toy-guns/18857282.htm"
        }

        // Change to be the number of products on the page
        var x = 16;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Wiky Territory Laser Game - Double set';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '64.43',
                    url: 'www.alza.co.uk/toys/wiky-territory-laser-game-double-set-d4529264.htm?catid=18857282',
                    image: 'https://i.alza.cz/Foto/f8/HR/HRAa10168.jpg',
                    country: 'uk'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Star Wars - Green Seal Communicator Blaster';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '29.40',
                    url: 'www.alza.co.uk/toys/star-wars-green-seal-communicator-blaster-d4321524.htm?catid=18857282',
                    image: '',
                    country: 'uk'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});

    describe('Search Page Category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "https://www.alza.co.uk/toys/remote-control-models/18857188.htm"
        }

        it('should return 8 products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(8);
                done()
            })
        });

        it('last category should be drones', function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
               var expected = JSON.stringify({
                    category: '"Remote Control Models - Drones": "www.alza.co.uk/toys/drones/18857288-p{{pageNo}}.htm",'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

        it('first category should be cars', function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                 var expected = JSON.stringify({
                    category: '"Remote Control Models - Cars": "www.alza.co.uk/toys/remote-control-cars/18857280-p{{pageNo}}.htm",'
                })

                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

    });
