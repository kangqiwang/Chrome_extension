const should = require('should')
const Q = require('../index').q;

const config = {
    host: '127.0.0.1',
    port: 6379,
    username: '',
    passwd:  ''
}

describe('qGetNTest', function() {    

    this.timeout(10000)

    it('should create a message q', (done) => {
        config.options = {
            interval: 100,
            maxWait: 1000
        }
        const testQ = new Q(config, 'testGetN');
        testQ.send('MESSAGE_TYPE', {
            waitTest1: 'one'
        }, (err, res) => {
        })
        testQ.send('MESSAGE_TYPE', {
            waitTest2: 'two'
        }, (err, res) => {
        })
        testQ.send('MESSAGE_TYPE', {
            waitTest3: 'three'
        }, (err, res) => {
        })
        testQ.send('MESSAGE_TYPE', {
            waitTest4: 'four'
        }, (err, res) => {
        })
        testQ.send('MESSAGE_TYPE', {
            waitTest5: 'five'
        }, (err, res) => {
        })

        setTimeout(() => {            
            testQ.worker((err, msg, finish) => {
                if(err) {
                    done()
                    return
                }
                finish()            
                testQ.getN(4, (err, messages) => {
                    should(err).be.equal(null)
                    messages.length.should.be.equal(4)
                    done()
                })
    
            })
        }, 500)


    })

})
