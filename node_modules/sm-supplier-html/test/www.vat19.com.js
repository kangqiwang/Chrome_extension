var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.vat19.com/item/diy-wooden-ballista-kit"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Build Your Own Wooden Ballista Kit",
                    "price": "21.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'https://images.vat19.com/covers/large/diy-ballista-kit.jpg',
                    "country": 'us',
                    "description": 'Create a realistic and working replica of an ancient roman missile launcher with the DIY Ballista Kit.The torsion spring technology invented thousands of years ago still works flawlessly in creating highly accurate shots over long distances. Fire the included ammunition (known as bolts) over 30 feet.This high quality kit features laser-cut parts and full-color illustrated instructions to ensure a fun building experience. Ages 10+.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.vat19.com/item/ghostbusters-heat-change-mug"
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Ghostbusters Heat Change Mug",
                    "price": "14.99",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": 'https://images.vat19.com/covers/large/ghostbusters-heat-change-mug.jpg',
                    "country": 'us',
                    "description": 'Brewin’ makes me feel good! Pour a generous cup of piping hot joe or tea into the Ghostbusters Heat Change Mug and get ready to fight the day as well as any spectres that come your way. A few seconds after adding your steaming beverage, green ectoplasmic slime will appear behind the classic “no ghosts” logo placed on both the front and back of the giant mug. With a 22 ounce capacity, there’s even room to add Stay Puft marshmallows to your hot chocolate.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "https://www.vat19.com/category/Fun-and-Strange-Stuff/page/0"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 69,
                    "pages": 1
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })
     describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "https://www.vat19.com/category/Toys/page/0"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Toys"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.vat19.com/category/Toys/page/0"
        }

        // Change to be the number of products on the page
        var x = 67; // WE DONT COUNT THE ONES WITH "TO" OR "-" IN //
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Feisty Pets';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '19.99',
                    url: 'https://www.vat19.com/item/feisty-pets',
                    image: 'https://images.vat19.com/covers/medium/feisty-pets.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Jumbie Jam Steel Drum';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '199.99',
                    url: 'https://www.vat19.com/item/jumbie-jam-deluxe-steel-drum-kit',
                    image: 'https://images.vat19.com/covers/medium/jumbie-jam-steel-drum.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
