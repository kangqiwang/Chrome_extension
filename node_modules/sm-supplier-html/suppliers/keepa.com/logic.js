var ProductPageInfo = require('../../lib/productPageInfo.js');
var SearchPageInfo = require('../../lib/searchPageInfo.js');
var cleanName = require('../../lib/cleanName.js');
var getPrice = require('../../lib/getPrice.js');
var PaginationNumberInfo = require('../../lib/paginationNumberInfo.js');
var CategoryInfo = require('../../lib/CategoryInfo.js');

module.exports = replace = {
    "useJavascript": true,

    'search': function ($, next) {
        // search -  Returns an array of products from the suppliers search page
        var result = []

        Category.container($).map(function (index, product) {
            var info = new SearchPageInfo()
            info.category = Category.category($, product)
            info.childCount = Category.childCount($, product)
            info.categoryCount = Category.categoryCount($, product);
            info.url = Category.url($, product);
            info.country = 'us';

            if (info.category && info.categoryCount) {
                result.push(info)
            }
        });
        return result

    },
}

var Category = {
    container: function ($) {
        let container = $('.ag-row');
        return container;
    },
    category: function ($, product) {
        var category = $(product).find('.ag-group-value').text();
        category = cleanName(category);
        return category;
    },
    childCount: function ($, product) {
        let childCount = $(product).find('.ag-group-child-count').text();
        //         childCount = childCount.split('(')[1].split(')')[0]
        return childCount

    },
    categoryCount: function ($, product) {
        let categoryCount = $(product).html()
        var noOfProducts = categoryCount.substring(categoryCount.lastIndexOf('"') + 2, categoryCount.lastIndexOf("<"));
        return noOfProducts.replace(/,/g, '')
    },
    url: function ($, product) {
        var url = null;
        var anchor = $(product).find('a');
        if (anchor) {
            url = $(anchor).attr('href');
        }
        console.log(url)
        return url;

    }
}