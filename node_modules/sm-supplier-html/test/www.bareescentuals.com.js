var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.bareescentuals.com/Lash-Domination-Volumizing-Mascara-Petite-Precision-Brush/US77189,en_US,pd.html"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Lash Domination® Volumizing Mascara Petite Precision™ Brush",
                    "price": "19.00",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://s7d3.scene7.com/is/image/BareEscentuals/77189-0?$large$',
                    "country": 'us',
                    "description": 'Empower your shorter lashes with Lash Domination Volumizing Mascara Petite Precision Brush. Featuring the same amazing 10-in-1 volumizing benefits as our bestselling mascara, the smaller ProTwist360 TM Wand is fanned out to 360 like a propeller to capture and amplify short, bottom, and corner lashes with precise volume and intense black color. In tight, hard to reach areas, hold the brush vertically to detail, separate and define lashes with the tapered, bristled tip. Powered by nourishing minerals and quinoa protein complex for full, lush lashes.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.bareescentuals.com/Mini-Marvelous-Moxie-Lipstick-in-Live-Large/US72680,en_US,pd.html"
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Mini Marvelous Moxie Lipstick in Live Large",
                    "price": "7.00",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": 'http://s7d3.scene7.com/is/image/BareEscentuals/72680-0?$large$',
                    "country": 'us',
                    "description": "Make an impact with Marvelous MoxieTM Lipstick. Creamy, super-saturated, ultra-pigmented color glides on like butter for full coverage in a rich satin finish. Lips look fuller and more voluptuous. An infusion of minerals revitalizes lips for a healthy-looking pout, while a moisture-loaded hydrating complex helps to nourish and condition with Abyssinian Oil and Omega Fatty Acids for supple, baby-soft smoothness. All the while, an encapsulated vitamin A, C and E complex helps to deliver antioxidant defense, so you're ready for anything—and everything."
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Search page pagination', function() {

    //     var payload = {
    //         "pageType" : "pagination",
    //         "url" : ""
    //     }

    //     it('should be true when number of items and pages correct', function (done) {

    //         Structure(payload, function(pagination) {
    //             var expected = JSON.stringify({
    //                 "items": "",
    //                 "pages": ""
    //             })
    //             JSON.stringify(pagination).should.equal(expected);
    //             done()
    //         })
    //     });

    // })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.bareescentuals.com/Eyes/BM_EYES,en_US,sc.html"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Eye Makeup"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.bareescentuals.com/Eyes/BM_EYES,en_US,sc.html"
        }

        // Change to be the number of products on the page
        var x = 49;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Lasting Line™ Long-Wearing Eyeliner';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '17.00',
                    url: 'http://www.bareescentuals.com/Lasting-Line-Long-Wearing-Eyeliner/US68039,en_US,pd.html',
                    image: 'http://s7d3.scene7.com/is/image/BareEscentuals//68039?$sharpen1$&wid=200&hei=200',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Make Mine a Double';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '19.00',
                    url: 'http://www.bareescentuals.com/Make-Mine-a-Double/US81916,en_US,pd.html',
                    image: 'http://s7d3.scene7.com/is/image/BareEscentuals//81916?$sharpen1$&wid=200&hei=200',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
