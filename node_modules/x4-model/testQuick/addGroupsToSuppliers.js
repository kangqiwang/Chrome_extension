const fs = require('fs')
const Mongo = require('../index').mongo
const ObjectId = require('../mongo/objectId')

let MDB = new Mongo({
    db: 'sm-backend',
    host: "127.0.0.1",
    port: 9988
})


let country = process.argv[2]

const data = JSON.parse(fs.readFileSync('./' + country + 'grouping.json', 'utf8'))
const cData = data.country[country]

MDB.conn(country + "suppliers", (err, collection) => {

    if (err) {
        console.error(err)
    } else {
        Object.keys(cData).map((id) => {

            Object.keys(cData[id]).map((grouping) => {
                let ids = []
                cData[id][grouping].map((id) => {
                    ids.push(ObjectId(id.id))
                }) 
                console.log(grouping, ids)
                collection.updateMany({ _id : { $in: ids } }, { $set: { grouping: grouping } }, (err, data) => {
                    if (err) {
                        console.error(err)
                    } else {
                        console.log(data.result)
      
                    }
                })  
            })
      
             
        })
        
    }

})
