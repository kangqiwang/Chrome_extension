var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.elfcosmetics.com/p/8986?Dept=all-eyes"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "e.l.f. Rose Gold Eyeshadow Palette",
                    "price": "10.00",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://az835686.vo.msecnd.net/images/gallery_large/85133.jpg',
                    "country": 'us',
                    "description": 'Achieve beautiful subtle to bold eye looks with these 10 perfectly curated nude rose gold eyeshadow shades. The collection of hues is ideal for shading, highlighting, and defining the eyes. Silky smooth texture can be used as a liner, on the lid, and in the crease of the eye for an expertly contoured and blending effect.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.elfcosmetics.com/makeup/all-eyes"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 12,
                    "pages": 10
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

     describe('Not a search page', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.elfcosmetics.com/p/mad-for-matte-eyeshadow-palette?dept=all-eyes"
        }

        it('should return null items and pages', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": null,
                    "pages": null
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    });


    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.elfcosmetics.com/makeup/all-eyes"
        }

        it('should be true when correct category is returned', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "All Eyes"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.elfcosmetics.com/makeup/all-tools"
        }

        // Change to be the number of products on the page
        var x = 22;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'e.l.f. Blending Sponge';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '5.00',
                    url: 'http://www.elfcosmetics.com/p/blending-sponge?dept=all-tools',
                    image: 'http://az835686.vo.msecnd.net/images/gallery_medium/Sponge_Pink.png',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'e.l.f. Makeup Brush Case';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '4.00',
                    url: 'http://www.elfcosmetics.com/p/makeup-brush-case?dept=all-tools',
                    image: 'http://az835686.vo.msecnd.net/images/gallery_medium/75403_900x900.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
