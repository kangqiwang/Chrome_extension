var should = require('should');
var Structure = require('../lib/structure.js')
const cache = require('../lib/cache')


describe('www.mothercare.com', function() {

    before(function()  {
        this.timeout(5000); 
    })


    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.mothercare.com/toys/baby-and-toddler-toys/light-sound-and-music-toys/",
            "html": cache.load("https://www.mothercare.com/toys/baby-and-toddler-toys/light-sound-and-music-toys/")
        }

        it('should return 24 products', function (done) {
            Structure(payload, function(err, result) {
                result.length.should.equal(12);
                done()
            })
        });

        it('last product should be a Spiderman Puzzle', function (err, done) {
            Structure(payload, function(err, result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: 'Fisher Price Kick and Play Piano Gym',
                    price: '54.99',
                    url: 'https://www.mothercare.com/music-puzzles-and-games/fisher-price-kick-and-play-piano-gym/140723.html?cgid=toys_music',
                    image: 'https://s7ondemand6.scene7.com//is/image/MothercareASE/140723_1?&$dw_large_mc$',
                    country: 'uk'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

        it('first product should be a ELC Fairy 42 Piece Puzzle', function(done) {
            Structure(payload, function(err, result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: 'Zoo 36 Piece Puzzle',
                    price: '10.00',
                    url: 'www.mothercare.com/music-puzzles-and-games/zoo-36-piece-puzzle/141177.html?cgid=toys_music',
                    image: 'http://s7ondemand6.scene7.com//is/image/MothercareASE/141177_1?&$dw_large_mc$',
                    country: 'uk'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

    });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.mothercare.com/toys/music-puzzles-and-games/?view=grid",
            "html": cache.load("http://www.mothercare.com/toys/music-puzzles-and-games/?view=grid")
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 12,
                    "pages": 12
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.mothercare.com/toys/music-puzzles-and-games/?view=grid",
            "html": cache.load("http://www.mothercare.com/toys/music-puzzles-and-games/?view=grid")
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Music, Puzzles & Games"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });


    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.mothercare.com/baby-playmats-and-gyms/baby-sensory-say-hello-4-in-1-discovery-world-gym/144073.html?cgid=toys_baby_playmats#sz=12&start=25",
            "html": cache.load("http://www.mothercare.com/baby-playmats-and-gyms/baby-sensory-say-hello-4-in-1-discovery-world-gym/144073.html?cgid=toys_baby_playmats#sz=12&start=25")
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Baby Sensory Say Hello 4 in 1 Discovery World Gym",
                    "price": "54.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": "http://s7ondemand6.scene7.com//is/image/MothercareASE/144073_1?&$dw_large_mc$",
                    "country": "uk",
                    "description": "At a GlanceA bright and colourful 4 in 1 play gym with lights and fun sounds.Features and benefits for Baby Sensory Say Hello 4 in 1 Discovery World Gym4 in 1 play gym with lights and soundsConverts from play gym to a tummy time matRemovable arches5 removable hanging toysIncludes comforter and teetherIncludes baby safe mirror for self discoveryAdjustable side panels with peek-a-boo windowPlays two tunesBright colours and enchanting lightsTummy time cushionRequires 3 x AAA batteries (not included)Requires 3 x AAA batteries (Not included)Want To Know More?Suitable from birth, your baby will love playing with this bright and colourful multi-sensory gym reaching out for the five removable hanging toys. As your little one grows, remove the arches and convert to a soft tummy time mat with tummy time cushion to encourage them to lift their head and learn to roll over. When they've mastered crawling, lift the sides of the mat and create a crawl through tunnel. This lovely play gym plays the original Baby Sensory tunes 'Say Hello to the Sun' and 'To and Fro' to stimulate your baby's hearing while the bright colours, enchanting lights and baby-safe mirrors are ideal for visual stimulation.Suitable from birth.Don't Forget......we have a great range of toys for every stage of your child's development.Product SpecificationsBrandEast CoastWeight1.2 kgHeight78 cmWidth46.5 cmDepth161 cmColourMultiBatteries requiredRequires 3 x AAA batteries (Not included)Batteries includedfalse ReturnsWe will be happy to refund or exchange most products. Click here for information on our hassle free returns policy.   International returns  if you are unhappy with an item that you have ordered, you are able to return it to us at your own cost. If the product is faulty, we can re-order this for you. If you do not wish to be re-sent the faulty product, you can send it back to us at your own cost – once we have received the goods, we will reimburse any postal charges you may incur. Click here for more information on our international returns policy."
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });


    describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.mothercare.com/childrens-puzzles/6-wild-animal-puzzles/132700.html",
            "html": cache.load("http://www.mothercare.com/childrens-puzzles/6-wild-animal-puzzles/132700.html")
        }

        it('should return false when product is out of stock', function(done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "6 Wild Animal Puzzles",
                    "price": "3.00",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": "http://s7ondemand6.scene7.com//is/image/MothercareASE/132700_1?&$dw_large_mc$",
                    "country": "uk",
                    "description": "At a GlanceThese Wild Animal Puzzles let you piece together six different animals with 3-piece and 4-piece puzzles.Features and benefits for ELC 6 Wild Animal Puzzles3 x 3-piece puzzles3 x 4-piece puzzlesWant To Know More?Sort through the pieces of these six animal puzzles to make a rhino, elephant, monkey, parrot, tiger and crocodile. Create your own bright and colourful zoo by putting these six animals together. Find the right pieces for each animal and slot them together to make a whole animal!Suitable from 24 months.Don't Forget...We have a great selection of books to introduce reading to your child.Product SpecificationsBrandELCWeight0.21 kgHeight13 cmWidth18 cmDepth4 cmColourMultiBatteries includedfalse ReturnsWe will be happy to refund or exchange most products. Click here for information on our hassle free returns policy.   International returns  if you are unhappy with an item that you have ordered, you are able to return it to us at your own cost. If the product is faulty, we can re-order this for you. If you do not wish to be re-sent the faulty product, you can send it back to us at your own cost – once we have received the goods, we will reimburse any postal charges you may incur. Click here for more information on our international returns policy."
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        })

    })

});
