var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.toofaced.com/p/travel-size-make-up/deluxe-better-than-sex-ornament/"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Better Than Sex Mascara Ornament",
                    "price": "10.00",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": '//d210vlyat54t3c.cloudfront.net/media/filter/product/img/web_bts_ornament_front_4.jpg',
                    "country": 'uk',
                    "description": 'Trim your tree with a deluxe size of the bestselling Better Than Sex Mascara, all wrapped up in this festive little ornament. It also makes the perfect gift tag so you can give the gift of mind-blowing lashes!*Please note this item is not eligible for discounts or promotions.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "https://www.toofaced.com/c/eyes/"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Eyes"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    // describe('Search page pagination', function() {

    //     var payload = {
    //         "pageType" : "pagination",
    //         "url" : "https://www.toofaced.com/c/eyes/"
    //     }

    //     it('should be true when number of items and pages correct', function (done) {

    //         Structure(payload, function(pagination) {
    //             var expected = JSON.stringify({
    //                 "items": 200,
    //                 "pages": 1
    //             })
    //             JSON.stringify(pagination).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.toofaced.com/c/eyes/"
        }

        // Change to be the number of products on the page
        var x = 33;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Better Than Sex Mascara Ornament';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '10.00',
                    url: 'https://www.toofaced.com/p/travel-size-make-up/deluxe-better-than-sex-ornament/',
                    image: '//d210vlyat54t3c.cloudfront.net/media/filter/product_wall/img/web_bts_ornament_front_3.jpg',
                    country: 'uk'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Matte Chocolate Chip';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '22.00',
                    url: 'https://www.toofaced.com/p/eye-shadow-palettes/chocolate-chip-matte/',
                    image: '//d210vlyat54t3c.cloudfront.net/media/filter/product_wall/img/web_mattechocoaltechip_half_3.jpg',
                    country: 'uk'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
