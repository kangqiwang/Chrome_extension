module.exports = (source, delta) => {
    
    let asin = Object.keys(delta)[0]
    let newDelta = null;
    let now = new Date().toISOString()
    if(delta[asin]['COMPETITIVE_PRICE']) {
        newDelta = {}
        newDelta.timestamp = now
        newDelta = delta[asin]['COMPETITIVE_PRICE']
        newDelta.salesRank = parseInt(newDelta.salesRank)
        newDelta.competitivePricing = parseFloat(newDelta.competitivePricing)
    }

    if(delta[asin]['LOWEST_SELLERS'] && newDelta !== null) {
        newDelta.lowestSellers = delta[asin]['LOWEST_SELLERS']
    }

    // Only update if we have newDelta
    if(newDelta !== null) {
        source.latestDelta = newDelta
        if(source.delta) {
           source.delta.push(newDelta)
        } else { 
          source.delta = [newDelta] 
        }
        source.updated = now
    } else {
        console.log('[' + asin + '] WE HAVE NO NEW DELTA')
    }
    
    return source
}