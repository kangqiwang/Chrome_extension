var should = require('should');
var Structure = require('../lib/structure.js')
const cache = require('../lib/cache')

describe('www.hdosport.com', function () {


    describe('In stock Page', function () {

        var payload = {
            "pageType": "product",
            "url": "https://www.hdosport.com/apparel/apparel-womens/the-north-face-women-s-furry-fleece-full-zip.html",
            "html": cache.load("https://www.hdosport.com/apparel/apparel-womens/the-north-face-women-s-furry-fleece-full-zip.html")
        }

        it('should be true when product is in stock', function () {
            
            const inStockPage =  Structure(payload)   
            console.log(inStockPage)         
            inStockPage.name.should.be.equal("The North Face Women\'s Furry Fleece Full Zip");
            inStockPage.price.should.be.equal("98.95");
            inStockPage.url.should.be.equal("https://www.hdosport.com/apparel/apparel-womens/the-north-face-women-s-furry-fleece-full-zip.html");
            inStockPage.inStock.should.be.equal(true);
            should(inStockPage.stockLevel).be.equal(null);
            inStockPage.inStock.should.be.equal(true);
            inStockPage.image.should.be.equal('https://www.hdosport.com/media/catalog/product/cache/1/image/265x265/9df78eab33525d08d6e5fb8d27136e95/i/m/image_41O8qD-9QuL_6.jpg');
            inStockPage.country.should.be.equal('us');            
         });
 
     });
 
    // describe('Out of Stock Page', function () {

    //     var payload = {
    //         "pageType": "product",
    //         "url": "",
    //         "html": cache.load("")
    //     }

    //     it('should be true when product is in stock', function (done) {

    //         Structure(payload, function (err, inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": payload.url,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": "",
    //                 "country": "us"
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

});

describe('Search Page', function () {

    var payload = {
        "pageType": "search",
        "url": "https://www.hdosport.com/apparel/apparel-womens.html?cat=33",
        "html": cache.load("https://www.hdosport.com/apparel/apparel-womens.html?cat=33")
    }

    // Change to be the number of products on the page
    var x = 12;
    it('should return ' + x + ' numer of products', function () {
        let result = Structure(payload)
        result.length.should.equal(x);
    });

    var firstProductName = 'The North Face Women\'s Dryzzle Jacket';
    it('first product should be ' + firstProductName, function() {

        var expected = JSON.stringify({
            barcode: null,
            name: firstProductName,
            price: '198.95',
            url: 'https://www.hdosport.com/apparel/apparel-womens/the-north-face-women-s-dryzzle-jacket.html',
            image: 'https://www.hdosport.com/media/catalog/product/cache/1/small_image/290x290/9df78eab33525d08d6e5fb8d27136e95/i/m/image_41xqHTz3RRL_5.jpg',
            country: 'us'
        })
        
        let result = Structure(payload)

        var first = result.shift()
        
        JSON.stringify(first).should.equal(expected)

    })

    var lastProductName = 'The North Face Women\'s Lisie Raschel Jacket';
    it('last product should be ' + lastProductName, function () {
        var expected = JSON.stringify({
            barcode: null,
            name: lastProductName,
            price: '129.95',
            url: 'https://www.hdosport.com/apparel/apparel-womens/the-north-face-women-s-lisie-raschel-jacket.html',
            image: 'https://www.hdosport.com/media/catalog/product/cache/1/small_image/290x290/9df78eab33525d08d6e5fb8d27136e95/i/m/image_NF0A33PO_7GS_hero__6.jpg',
            country: 'us'
        })

        const result = Structure(payload);

        var last = result.pop()
        JSON.stringify(last).should.equal(expected)
    })

})

    describe('Search page category', function () {

        var payload = {
            "pageType": "category",
            "url": "https://www.hdosport.com/apparel/apparel-womens.html?cat=33",
            "html": cache.load("https://www.hdosport.com/apparel/apparel-womens.html?cat=33")
        }

        it('should be true when number of items and pages correct', function () {

            var expected = JSON.stringify({
                "name": "Women's",
                "url":"https://www.hdosport.com/apparel/apparel-womens.html?cat=33"
            })

            const category = Structure(payload)

            JSON.stringify(category).should.equal(expected);
        });

    });

