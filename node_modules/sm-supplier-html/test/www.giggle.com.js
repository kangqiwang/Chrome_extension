var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.giggle.com/skip-hop-playspot-geo-foam-floor-tiles/23927.html?cgid=new-shop-by-category-toys&start=1"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Skip Hop Playspot Geo Foam Floor Tiles",
                    "price": "79.00",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://demandware.edgesuite.net/sits_pod26/dw/image/v2/AAGU_PRD/on/demandware.static/-/Sites-giggle-master/default/dw74938d11/images/large/LG_MS19830~GBCA.jpg?sw=542&sh=542',
                    "country": 'us',
                    "description": 'Every budding interior designer will dig this baby-safe playmat. Each piece of the Skip Hop Playspot Geo Foam Floor Tiles has a contemporary grey and white triangle design that will complement any modern home. Piece the oversized foam tiles together to create different trendy patterns and customize your play space, while keeping your child safe, thanks to its softness.Every budding interior designer will dig this baby-safe playmat. Each piece of the Skip Hop Playspot Geo Foam Floor Tiles has a contemporary grey and white triangle design that will complement any modern home. Piece the oversized foam tiles together to create different trendy patterns and customize your play space, while keeping your child safe, thanks to its softness.why it\'s a giggle pick: Three things we love – fun, functionality, and travel-friendly – come together in this foam mat, perfect for playtime.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.giggle.com/new-baby-toys/"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 90,
                    "pages": 2
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.giggle.com/new-baby-toys/"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Toys"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.giggle.com/new-baby-toys/"
        }

        // Change to be the number of products on the page
        var x = 90;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Skip Hop Playspot Geo Foam Floor Tiles';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '79.00',
                    url: 'http://www.giggle.com/skip-hop-playspot-geo-foam-floor-tiles/23927.html?cgid=new-shop-by-category-toys&start=1',
                    image: 'http://demandware.edgesuite.net/sits_pod26/dw/image/v2/AAGU_PRD/on/demandware.static/-/Sites-giggle-master/default/dw74938d11/images/large/LG_MS19830~GBCA.jpg?sw=200&sh=200',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'giggle Hippo Striped Plush';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '10.98',
                    url: 'http://www.giggle.com/giggle-hippo-striped-plush/MS21018.html?cgid=new-shop-by-category-toys&start=90',
                    image: 'http://demandware.edgesuite.net/sits_pod26/dw/image/v2/AAGU_PRD/on/demandware.static/-/Sites-giggle-master/default/dw2b1bd970/images/large/LG_MS21018~PA.jpg?sw=200&sh=200',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
