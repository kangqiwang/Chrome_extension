var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.everythingkitchens.com/design-imports-22823-round-baking-dish-basket.html"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Design Imports Round Baking Dish With Basket",
                    "price": "29.95",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'https://smhttp-ssl-21049.nexcesscdn.net/media/catalog/product/cache/1/image/279x/9df78eab33525d08d6e5fb8d27136e95/r/o/round_20baker_20with_20basket-1_grande.jpeg',
                    "country": 'us',
                    "description": 'Round Stoneware Dish With Basket by Design Imports The warm, welcoming scent of a freshly baked fruit cobbler or creamy casserole makes a great homecoming thanks to the Design Imports round baking dish with basket. The round, stoneware baking dish is great for pastas, casseroles and desserts. The Design Imports round baking dish includes a wicker basket for insulation while transporting or at the dinner table. Welcome a Design Imports round baking dish with wicker basket to your home and have it return the favor with baked deliciousness every evening. Design Imports Baking Dish Features: Wonderful serving ready baking dish with wicker basket carrier Stoneware baking dish to bake your favorite dessert or casserole Includes wicker basket for serving Dishwasher and microwave safe Stoneware baking dish is oven safe up to 400F Measures 11in x 11in x 3in (LxWxH) Looking For Other Design Import Products? Click Here!'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "https://www.everythingkitchens.com/baking-dishes.html?limit=96"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 96,
                    "pages": 3
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

     describe('Not a search page', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "https://www.everythingkitchens.com/mason-cash-2001-149-enamour-oval-dish-9-5-in.html"
        }

        it('should return null items and pages', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": null,
                    "pages": null
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    });

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "https://www.everythingkitchens.com/baking-dishes.html?limit=96"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Baking Dishes for Casseroles, Quiches, and More"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.everythingkitchens.com/baking-dishes.html?limit=96"
        }

        // Change to be the number of products on the page
        var x = 96;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'All-Clad Stainless Steel Lasagna Pan & Oven Mitts Gift Set';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: null,
                    url: 'https://www.everythingkitchens.com/allclad-cookware-lasagne-pan-with-cookbook-oven-mitts-set-00830.html',
                    image: 'https://smhttp-ssl-21049.nexcesscdn.net/media/catalog/product/cache/1/small_image/224x224/9df78eab33525d08d6e5fb8d27136e95/a/l/all-clad-000830.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Design Imports Round Baking Dish With Basket';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '29.95',
                    url: 'https://www.everythingkitchens.com/design-imports-22823-round-baking-dish-basket.html',
                    image: 'https://smhttp-ssl-21049.nexcesscdn.net/media/catalog/product/cache/1/small_image/224x224/9df78eab33525d08d6e5fb8d27136e95/r/o/round_20baker_20with_20basket-1_grande.jpeg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
