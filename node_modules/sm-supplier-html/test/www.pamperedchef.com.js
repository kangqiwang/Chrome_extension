var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.pamperedchef.com/shop/Bakeware/Stoneware/Rectangular+Baker+Set/1424"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Rectangular Baker Set",
                    "price": "125.00",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": '/iceberg/com/product/1424-lg.jpg',
                    "country": 'us',
                    "description": 'Our stoneware Rectangular Baker Set will help you get an entire meal on the table quickly, deliciously and with style. Make your favorite main dishes, side dishes, desserts or appetizers, and then take them right from the oven to the table. The neutral, graystone-glazed exterior will make meals look beautiful, and it coordinates with just about any table and serving pieces. This convenient set is a must-have for all types of cooks. Details'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "https://www.pamperedchef.com/shop/Bakeware?q=%3Aprice-desc%3Acategory%3A59832&itemType=TPCProduct&searchText=&browseCategories=true&categoryBanner=%2Fmedias%2Fsys_master%2Fhf6%2Fhc2%2F9117703536670%2Fr-bakeware.jpg&Nr=&recordsPerPage=60&Ns=price-desc"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 60,
                    "pages": 2
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.pamperedchef.com/shop/Bakeware?q=%3Aprice-desc%3Acategory%3A59832&itemType=TPCProduct&searchText=&browseCategories=true&categoryBanner=%2Fmedias%2Fsys_master%2Fhf6%2Fhc2%2F9117703536670%2Fr-bakeware.jpg&Nr=&recordsPerPage=60&Ns=price-desc"
        }

        // Change to be the number of products on the page
        var x = 60;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Rectangular Baker Set';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '125.00',
                    url: '/shop/Bakeware/Stoneware/Rectangular+Baker+Set/1424',
                    image: '/iceberg/com/product/1424-lg.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Medium Cover & Store Lid';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '16.00',
                    url: '/shop/Bakeware/Metal/Medium+Cover+%26+Store+Lid/1736',
                    image: '/iceberg/com/product/1736-lg.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });
     describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "https://www.pamperedchef.com/shop/Bakeware?q=%3Aprice-desc%3Acategory%3A59832&itemType=TPCProduct&searchText=&browseCategories=true&categoryBanner=%2Fmedias%2Fsys_master%2Fhf6%2Fhc2%2F9117703536670%2Fr-bakeware.jpg&Nr=&recordsPerPage=60&Ns=price-desc"
        }

        it('should be true when the category is correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Bakeware"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

});
