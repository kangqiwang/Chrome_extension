var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://comlax.purehockey.com/product/Lazer_Backpack_Bag/itm/11333-2/?mtx_id=0"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Nike Lazer Backpack Bag",
                    "price": "59.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'https://images.purehockey.com/img.aspx?pic_id=100254&pic_type=4',
                    "country": 'us',
                    "description": '18\\"L X 14\\"W X 9\\"H\\nDurable, 600D polyester\\nLarge, central compartment for cleats and clothes \nZippered front pocket for additional storage\nHelmet strap\\nSide stick storage slots\\nInsulated water bottle storageThis bag is not intended for gear, it is more of a coach\'s bag or would be good to use for school books. It will not fit a full set of gear.Chat with us! Thanks for stopping by! Can I help you with anything?'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

     describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "https://comlax.purehockey.com/c/lacrosse-accessories-bags-backpacks"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Lacrosse Accessories - Backpacks"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "https://comlax.purehockey.com/c/lacrosse-accessories-bags-backpacks"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": "11",
                    "pages": "1"
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://comlax.purehockey.com/c/lacrosse-accessories-bags-backpacks"
        }

        // Change to be the number of products on the page
        var x = 11;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Nike Lazer Backpack Bag';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '59.99',
                    url: 'https://comlax.purehockey.com/product/Lazer_Backpack_Bag/itm/11333-2/?mtx_id=0',
                    image: 'https://images.purehockey.com/img.aspx?itm_id=11333&div_id=2&pic_type=3&mtx_id=0',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Maverik Prez Bag';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '49.99',
                    url: 'https://comlax.purehockey.com/product/Prez_Bag/itm/14073-2/?mtx_id=0',
                    image: 'https://images.purehockey.com/img.aspx?itm_id=14073&div_id=2&pic_type=3&mtx_id=0',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
