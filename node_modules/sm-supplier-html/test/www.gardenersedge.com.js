var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.gardenersedge.com/leonard-deluxe-soil-knife-and-sheath-combo/p/4752COM/"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Leonard Deluxe Soil Knife and Sheath Combo",
                    "price": "29.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://cdnll.gardenersedge.com/images/500/4752com.jpg',
                    "country": 'us',
                    "description": "So many usesâ€”you'll be amazed by its versatility!Based upon many customer suggestions and professional feedback, we created our deluxe soil knife, the next evolution. This deluxe stainless steel soil knife is also made in Maniago, Italy and also backed by our \"no questions asked\" lifetime warranty, but it's even better!Use it to: divide plants, plant bulbs, flowers and herbs, dig out weeds, remove rocks, cut through roots, plant in pots, clean out cracks, cut twine and ties, and for so much more! New features include: Larger Diameter Hook Opening: Hangs neatly on your peg rack for a tidy shed or work bench. Thumb-Rest Handle: A thumb rest at the base, a wider safety guard, and a more comfortable grip for all-day digging, and so you can push into the soil with more control. Twine Cutting Notch: Cut twine and plant ties as you go, without having to switch tools. Depth Markings on Blade: Inch markings on the stainless steel blade will ensure your plants and bulbs are planted at just the right depth. Extended Dual Cut Serrated Edge: Now an even sharper and longer cutting stroke and sharper serrations for easier cutting of roots and swift division of perennials and grasses. Don't think that these improvements mean we've skimped anywhere else: this deluxe soil knife is still manufactured from the highest quality, rust-resistant stainless steel as the classic. The blade is engineered to withstand over 300 lbs of pressure, for a lifetime of use. The 6-inch stainless steel blade has a tapered slicing edge, plus a sharp, deeply serrated side made for fast root cutting.Comfortable one-piece molded composite handle offers a more rounded grip and molded thumb rest. Blade is 1.75 inches wide, 11.75 inches overall length. Ship wt .5 lbs."
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.gardenersedge.com/garden-tool-sets/c/R06T/"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 16,
                    "pages": 2
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.gardenersedge.com/garden-tool-sets/c/R06T/"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Garden Tool Sets"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.gardenersedge.com/garden-tool-sets/c/R06T/"
        }

        // Change to be the number of products on the page
        var x = 16;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Leonard Deluxe Soil Knife and Sheath Combo';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '29.99',
                    url: 'http://www.gardenersedge.com/leonard-deluxe-soil-knife-and-sheath-combo/p/4752COM/',
                    image: 'http://cdnll.gardenersedge.com/images/200/4752com.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Leonard Deluxe Soil Knife Gift Set';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '39.95',
                    url: 'http://www.gardenersedge.com/leonard-deluxe-soil-knife-gift-set/p/GBK4752/',
                    image: 'http://cdnll.gardenersedge.com/images/200/GBK4752.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
