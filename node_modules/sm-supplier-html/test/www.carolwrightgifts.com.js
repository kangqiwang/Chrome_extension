var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.carolwrightgifts.com/color-changing-christmas-tree/32327.cfm?clicksource=fi_0400__view_all"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Color-Changing Christmas Tree",
                    "price": "4.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://www.carolwrightgifts.com/color-changing-christmas-tree_32327_xl0.jpg',
                    "country": 'us',
                    "description": 'This perfect accent to any holiday decor or centerpiece features blinking and color changing LED lights that transition from red to blue to green. The clear acrylic tree with red, green and yellow painted highlights creates the effect of a decorated tree. On/off switch at the base. Uses 3  button-cell batteries (included). 8"H x 2 1/2"W.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.carolwrightgifts.com/home-decor/0400/products_page.cfm?curr_page=1&sortby=sales&start_row=1&view_all=y&view_all2=n"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 45,
                    "pages": 9
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.carolwrightgifts.com/home-decor/0400/products_page.cfm?curr_page=1&sortby=sales&start_row=1&view_all=y&view_all2=n"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Home Decor"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.carolwrightgifts.com/home-decor/0400/products_page.cfm?curr_page=1&sortby=sales&start_row=1&view_all=y&view_all2=n"
        }

        // Change to be the number of products on the page
        var x = 30;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Metal-Finish Candle Lanterns';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '14.99',
                    url: 'http://www.carolwrightgifts.com/metal-finish-candle-lanterns/83148.cfm?clicksource=fi_0400__view_all',
                    image: 'http://www.carolwrightgifts.com/metal-finish-candle-lanterns_83148_xl0.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Coir Welcome Mat';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '4.99',
                    url: 'http://www.carolwrightgifts.com/coir-welcome-mat/80466.cfm?clicksource=fi_0400__view_all',
                    image: 'http://www.carolwrightgifts.com/coir-welcome-mat_80466_xl0.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
