var should = require('should');
var Structure = require('../lib/structure.js')

describe('www.officeplayground.com', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.officeplayground.com/basketball-game-mini-p1229.html"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Basketball Game - Mini",
                    "price": "0.89",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://pull01.officeplayground.netdna-cdn.com/media/catalog/product/cache/1/image/9df78eab33525d08d6e5fb8d27136e95/1/6/1630_MiniBasketballGame_1B_1.jpg',
                    "country": 'us',
                    "description": "Instead of tossing your donut crumbs into your coffee mug at work, play a real game of basketball, right at your desk! The Basketball Game - Mini is a complete 5-piece set that includes a miniature basketball hoop and backboard, two perfectly sized basketballs, and the very cool basketball launcher. It's easy and fun to play this desk top game. Place a basketball on the spring-loaded launcher, aim your shot, and send the ball flying into the hoop! This mini basketball game is great for those days when you can't get out of the office to play a life-sized game. It's time to make a slam dunk!"
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.officeplayground.com/atm-machine-desktop-bank-p6969.html"
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "ATM Machine Desktop Bank",
                    "price": "25.99",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": 'http://pull01.officeplayground.netdna-cdn.com/media/catalog/product/cache/1/image/9df78eab33525d08d6e5fb8d27136e95/6/4/6450-ATM-Machine-Desktop-Bank-1.jpg',
                    "country": 'us',
                    "description": "The ATM Machine Desktop Bank is a convenient ATM. The perfect tools to instill savings habit in our children. Let them learn the importance of money saving, let them be responsible for their own savings. This is the steps of right direction towards better financial management, which is important at any age! Has LCD screen, can automatically identify coin value, has time /date setting and alarm clock function, a calculator function to help with the calculation of your expenses, you can set saving target, easy Can withdrawals and check savings balance, you can set/change/reset password, you use the bank card to operate the ATM (otherwise an alarm will soundâ€”so you catch anyone trying to loot!) The ATM Machine Desktop Bank requires 3 \"AA\" batteries (Not included). Comes with instruction manual."
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });
    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.officeplayground.com/desk-toys-c13.html?limit=96"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 96,
                    "pages": 8
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.officeplayground.com/office-toys-c890.html?limit=all"
        }

        // Change to be the number of products on the page
        var x = 353;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Foam Finger Flyer';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '0.39',
                    url: 'http://www.officeplayground.com/foam-finger-flyer-p1935.html',
                    image: 'http://pull01.officeplayground.netdna-cdn.com/media/catalog/product/cache/1/small_image/190x/9df78eab33525d08d6e5fb8d27136e95/3/4/3451_FoamFingerFlyer_1_1.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Magic Spring - 1.25 inch, Soccer, 12 Pack';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '2.99',
                    url: 'http://www.officeplayground.com/magic-spring-125-inch-soccer-12-pack-p7183.html',
                    image: 'http://pull01.officeplayground.netdna-cdn.com/media/catalog/product/cache/1/small_image/190x/9df78eab33525d08d6e5fb8d27136e95/6/9/6969-Magic-Spring---1-inch-Soccer-12-Pack-1.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });
     describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.officeplayground.com/office-toys-c890.html?limit=all"
        }

        it('should be true when the category is correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Office Toys"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

});
