var should = require('should');
var Structure = require('../lib/structure.js')

describe('www.udans.com', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.udans.com/Women-s-Outbound-Long-Vest-T1081609"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Women's Outbound Long Vest",
                    "price": "129.00",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://www.udans.com/assets/images/products/Women-s-Outbound-Long-Vest-T1081609_Falcon Brown.jpg?resizeid=5&resizeh=1000&resizew=1000',
                    "country": 'us',
                    "description": "Details Sophisticated on the outside and luscious on the inside, the Toad&Co. Women's Outbound Long Vest is elegant enough for first class but still makes a great pillow in coach. Elegant on the outside, downright cozy on the inside, the Outbound Long Vest is made from a bluesign approved polyester and fleece blend that’s known for it’s excellent warmth–to–weight ratio. Warm pockets and a drop–tail hem keep you covered and comfortable, from dinner to the departure gate. Wear this vest with boots and leggings to pair style with spontaneity wherever your journey takes you. Features:Center–front zipper Welted zippered hand pockets Drop–tail hem Certified non–mulesed bluesign certified fabric 32\" front, 34\" back Machine wash coldFabric: 75% Polyester, 25% Wool"
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });
     describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.udans.com/Womens/Womens-Outerwear?show=48"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Outerwear"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });
    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.udans.com/Womens/Womens-Outerwear?show=48"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 48,
                    "pages": 7
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.udans.com/Womens/Womens-Outerwear?show=48"
        }

        // Change to be the number of products on the page
        var x = 48;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Adult Poncho';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '3.00',
                    url: 'http://www.udans.com/Adult-Poncho-28011',
                    image: 'http://www.udans.com/assets/images/products/Adult-Poncho-28011_Royal.jpg?resizeid=3&resizeh=275&resizew=275',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = "Women's Outbound Long Vest";
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '129.00',
                    url: 'http://www.udans.com/Women-s-Outbound-Long-Vest-T1081609',
                    image: 'http://www.udans.com/assets/images/products/Women-s-Outbound-Long-Vest-T1081609_Falcon Brown.jpg?resizeid=3&resizeh=275&resizew=275',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
