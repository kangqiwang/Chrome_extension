const should = require('should');
const ProductModel = require('../index.js').model.product
const Bulk = require('../model/bulk')

const config = require('../config').es;

describe('Product Bulk Test', function() {

        it('should return bulk save record for elastic search', function(done) {

             var payload = {
                "name" : "Name",
                "url" : "http://www.barnesandknoble.com/",
                "price" : "4.99",
                "country" : "us"
            }

            var record = {
                "name" : "Name",
                "url" : "http://www.barnesandknoble.com/",
                "country" : "us",
                "delta" : []
            }

            var Product = new ProductModel(config, 'us')

            Product.bulkEnumerateSupplier(payload, record, (err, result) => {
                should(err).be.equal(null)
                result.should.have.lengthOf(2)
                result[0].index._index.should.be.equal('us-products')
                result[0].index._type.should.be.equal('www-barnesandknoble-com')
                result[0].index._id.should.be.equal('49ee3087348e8d44e1feda1917443987')
                result[1].delta.length.should.be.equal(1)
                result[1].delta[0].should.have.property('timestamp')
                result[1].delta[0].price.should.be.equal(4.99)
                console.log(Bulk.get())
                done();
            })

        })

})

// client.bulk({
//   body: [
//     // action description
//     { index:  { _index: 'myindex', _type: 'mytype', _id: 1 } },
//      // the document to index
//     { title: 'foo' },
//     // action description
//     { update: { _index: 'myindex', _type: 'mytype', _id: 2 } },
//     // the document to update
//     { doc: { title: 'foo' } },
//     // action description
//     { delete: { _index: 'myindex', _type: 'mytype', _id: 3 } },
//     // no document needed for this delete
//   ]
// }, function (err, resp) {
//   // ...
// });
