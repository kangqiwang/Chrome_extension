const should = require('should');
const updateDelta = require('../lib/updateDelta');

describe('Update Delta', function() {

        it('should update the product delta when empty', function(done) {
          
            var payload = {
                "name" : "Name",
                "url" : "http://www.barnesandknoble.com/",
                "price" : "4.99",
                "country" : "us"
            }

            var record = {
                "name" : "Name",
                "url" : "http://www.barnesandknoble.com/",
                "country" : "us",
                "delta" : []
            }

            updateDelta(payload, record, (err, result) => {
                should(err).be.equal(null)
                result.delta.length.should.be.equal(1)
                result.delta[0].should.have.property('timestamp')
                result.delta[0].price.should.be.equal(4.99)
                done()
            })
           

        })

          it('should return error if price is incorrect', function(done) {
          
            var payload = {
                "name" : "Name",
                "url" : "http://www.barnesandknoble.com/",
                "price" : "PRICE",
                "country" : "us"
            }

            var record = {
                "name" : "Name",
                "url" : "http://www.barnesandknoble.com/",
                "country" : "us",
                "delta" : []
            }

            updateDelta(payload, record, (err, result) => {
                should(err).be.equal('PRICE_ERROR')
                done()
            })
           

        })



})
