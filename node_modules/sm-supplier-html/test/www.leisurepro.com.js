var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.leisurepro.com/p-247tchm/24-7-traffic-collection-medium-holster"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "24/7 Traffic Collection - Medium Holster",
                    "price": "49.95",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://www.leisurepro.com/Image/Product/Large/247TCHM.jpg',
                    "country": 'us',
                    "description": 'About 24/7 Traffic Collection - Medium Holster From the peaceful bliss of rolling hilltops to the incessant hustle of Broadway. Strikingly stylish. Glamorous, yet understated. Edgy and hip. 24/7 . The 24/7 Traffic Collection of custom designed, ready-for-action camera bags provides secure and easy access to gear while keeping organized with flexible partitions that protect equipment. Lightweight and perfectly balanced, these bags combine all the elements of downtown style: modern silhouettes, sleek details, and plenty of black for that urban-chic touch. Fashioned with patent trim and made of water-resistant materials, decked in black and tangerine, the trendy dual tone 24/7 series is tailor made to hold everything an appearance-conscience photographer might dream up: a mirrorless camera and lens, a DSLR with two lenses, a snappy superzoom travel camera and essential belongings. 24/7 has got you covered - discreetly - with style and impeccable taste, from caf√© to boardroom to boardwalk. Specially designed for the fast paced city, the 24/7 Medium Holster offers a discreet and stylish camera bag option. Roomy main compartment provides space for a standard DSLR body, a zoom lens, flash and personal items inside its front organizer and rear pocket - a place for everything and for everything, a place. The adjustable and removable shoulder strap lets you wear it two ways: across body or on shoulder. And since meteoric conditions can change in a moment\'s notice, there is a built-in all weather cover protection with every 24/7 bag to protect your camera from the elements. Even your SD card has a special place in this bag! Whether your commute across town is in a cab or on the train, all of your photography equipment is safe and secure. Each bag is made from durable nylon and waterproof materials. The bag has zipper closures for external pockets with easy grab pull tabs. The built-in all weather cover comes equipped with a squeeze-style" side-release buckle for easy access and fastening. Bag measures (L x W x H) 11.63" x 4.88" x 10.25" (29.5 cm x 12.5 cm x 26 cm), has an internal volume of 193 cubic inches (3.16 liters), and weighs 15.5 oz. (439 g) when empty. Bag also comes equipped with webbing loop lash tabs for attachment of items or securing bag. Compartments: DSLR, 2 lenses or flash, memory card and space for personal items. 24/7 Traffic Collection - Medium Holster Features 24/7 Traffic Collection - Medium Holster Padded Camera Compartment Adjustable, Removable Shoulder Strap Front Organizer Pocket Memory Card Pocket and Holder Light Reflecting Logo Rear Pocket with Zipper Closure Main Compartment Zipper Closure Built-in All Weather Cover with "Squeeze-Style" Side Release Buckle Construction: Durable Nylon and Waterproof Material Dimensions: (L x W x H) 11.63" x 4.88" x 10.25" (29.5 cm x 12.5 cm x 26 cm) Volume: 193 cubic inches (3.16 liters) Weight (empty): 15.5 oz. (439 g)'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.leisurepro.com/c-1051/gear-bags?perpage=90"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 90,
                    "pages": 4
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.leisurepro.com/c-1051/gear-bags?perpage=90"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Scuba Gear Bags, Diving Gear Bags & Snorkeling Gear Bags"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.leisurepro.com/c-1051/gear-bags?perpage=90"
        }

        // Change to be the number of products on the page
        var x = 90;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = '24/7 Traffic Collection - Medium Holster';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '49.95',
                    url: 'http://www.leisurepro.com/p-247tchm/24-7-traffic-collection-medium-holster',
                    image: 'http://www.leisurepro.com/Image/Product/Full/247TCHM.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'TYR Big Mesh Mummy Backpack';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '15.99',
                    url: 'http://www.leisurepro.com/p-tyrbmmbp/tyr-big-mesh-mummy-backpack',
                    image: 'http://www.leisurepro.com/Image/Product/Full/TYRBMMBPYL.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
