var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.omcgear.com/mens/dynotherm-down-jacket-men-s.html"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Mountain Hardwear Dynotherm Down Jacket - Men's",
                    "price": "199.95",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://www.omcgear.com/media/catalog/product/cache/1/image/375x/9df78eab33525d08d6e5fb8d27136e95/F/1/F16_1616701_967_f.jpg',
                    "country": 'us',
                    "description": 'Product Features            The Mountain Hardwear Dynotherm Down Jacket is versitale, lightweight and packable. This jacket is ideal for active outdoor adventures but still stylish enough to hangout with friends on cold evenings. Dynotherm Down Jacket is made with Q.Shield® DOWN 650-fill insulation, which means the down stays dry and lofty keeping you warm even when the going gets wet. Q Shield® DOWN 650-fill insulation repels water, 30D nylon face fabric  Two hand warmer pockets are pack-compatibleSingle chest pocket is pack-compatibleElastane cuffs seal in warmth, block out weatherDual hem drawcords for easy adjustments on the fly'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.omcgear.com/mens.html"
        }

        // Change to be the number of products on the page
        var x = 40;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = "Mountain Hardwear Dynotherm Down Jacket - Men's";
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '199.95',
                    url: 'http://www.omcgear.com/mens/dynotherm-down-jacket-men-s.html',
                    image: 'http://www.omcgear.com/media/catalog/product/cache/1/small_image/210x/9df78eab33525d08d6e5fb8d27136e95/f/1/f15_1616701_614_f.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = "Canada Goose Chateau Parka - Men's";
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '899.95',
                    url: 'http://www.omcgear.com/mens/canada-goose-chateau-parka-men-s.html',
                    image: 'http://www.omcgear.com/media/catalog/product/cache/1/small_image/210x/9df78eab33525d08d6e5fb8d27136e95/3/4/3426M_315.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });


     describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.omcgear.com/climbing.html"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 40,
                    "pages": 5
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    });

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.omcgear.com/climbing.html"
        }

        it('should be true when the category is correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Climbing"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

});
