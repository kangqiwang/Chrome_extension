var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://shop.mercola.com/product/1836/1/liposomal-vitamin-d-1000-iu-30-per-bottle-30-day-supply"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Liposomal Vitamin D 1000 IU (30 per Bottle): 30 Day Supply",
                    "price": "9.97",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://media.mercola.com/assets/shopimages/18-1836-Product_Primary_Image.jpg',
                    "country": 'us',
                    "description": "With estimates of 9 out of 10 Americans – and likely countless others living in the Northern hemisphere – possibly being deficient in vitamin D, a reliable option for supplementation is needed. Doctor-prescribed vitamin D is often the inferior vitamin D2 form. Other traditional vitamin D can be challenging to absorb, especially for certain groups of people. My exclusive Liposomal Vitamin D contains phospholipids from sunflower lecithin to help aid absorption. There is evidence to suggest that, when mixed with water in your gastrointestinal tract, these phospholipids create liposomes that can help the nutrient gain entry across your gut membrane to its target organs and cells.* With this advanced liposomal technology, you don’t need to rely on your digestive system to break the vitamin D down into absorbable fragments as it must with regular vitamin D. Packed in protective Licaps capsules instead of oxygen-permeable soft gels, my Liposomal Vitamin D:  Incorporates phospholipids from sunflower lecithin to help protect your cell membranes and aid in the formation of liposomes in the stomach.* Liposomes form in the body, surrounding many of the vitamin D molecules, for higher-bioavailability potential.* Delivers vitamin D3 in a high-quality, tightly-sealed Licaps capsule that may be superior to other oral delivery systems in terms of leakage protection.* Comes from a world-leading quality manufacturer with over a century of experience and innovative delivery technologies. Provides a practical and effective way to help you get the vitamin D3 your body needs.* Contains no soy or bioengineered ingredients.  Note that my Liposomal Vitamin D is available in two doses: 5,000 IU or 1,000 IU per capsule (per day), based on individual needs. For most healthy adults, I recommend a daily dose of 5,000 IU of vitamin D3, however, based on your current vitamin D levels and current vitamin D intake from multivitamins and other sources, you may need more vitamin D3, or less.  If your vitamin D levels are already very high, Liposomal Vitamin D (1,000 IU) can serve as an effective daily maintenance dose. In addition, my Liposomal Vitamin D (1,000 IU) is recommended for most healthy children age 4 and older. With both of my Liposomal Vitamin D products (5,000 IU and 1,000 IU), there are no football-sized capsules or pills. Just one tiny, easy-to-swallow Licaps capsule per day is all you need. Place your order today! Discover More About Dr. Mercola's Liposomal Vitamin D Live outside Canada and looking for a higher dose Vitamin D product? Check out our Vitamin D 5,000 IU product."
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://shop.mercola.com/category/443/1/bone-joint-muscle"
        }

        // Change to be the number of products on the page
        var x = 59;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Liposomal Vitamin D 1000 IU (30 per Bottle): 30 Day Supply';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '9.97',
                    url: 'shop.mercola.com/product/1836/1/liposomal-vitamin-d-1000-iu-30-per-bottle-30-day-supply',
                    image: 'http://media.mercola.com/assets/shopimages/18-1836-Catalog_Image-thumb.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Whole-Food Multivitamin PLUS tablets (240 per bottle): 30 Day Supply';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '47.97',
                    url: 'shop.mercola.com/product/1008/1/whole-food-multivitamin-plus-tablets-240-per-bottle-30-day-supply',
                    image: 'http://media.mercola.com/assets/shopimages/18-1008-Catalog_Image-thumb.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

    //  describe('Search page pagination', function() {

    //     var payload = {
    //         "pageType" : "pagination",
    //         "url" : "http://shop.mercola.com/category/443/1/bone-joint-muscle"
    //     }

    //     it('should be true when number of items and pages correct', function (done) {

    //         Structure(payload, function(pagination) {
    //             var expected = JSON.stringify({
    //                 "items": 200,
    //                 "pages": 1
    //             })
    //             JSON.stringify(pagination).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://shop.mercola.com/category/443/1/bone-joint-muscle"
        }

        it('should be true when the category is correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Bone, Joint & Muscle"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });


});
