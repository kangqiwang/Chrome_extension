const should = require('should')
const Q = require('../index').q;

const config = {
    host: '127.0.0.1',
    port: 6379,
    username: '',
    passwd:  ''
}

describe('Redis Message Q', () => {    

    it('should create a message q', (done) => {
        
        const testQ = new Q(config, 'testq');

        testQ.send('MESSAGE_TYPE', {
            my: 'data'
        }, (err, res) => {
            testQ.worker((err, msg, finish) => {
                if(err) {
                    console.error(err)
                    done()
                    return
                }
                finish()
                msg.data.my.should.be.equal('data')
                testQ.stats((err, stats) => {
                    should(err).be.equal(null)
                    stats.totalrecv.should.be.equal(1)
                    stats.totalsent.should.be.equal(1)
                    testQ.delete((err, resp) => {
                        should(err).be.equal(null)
                        resp.should.be.equal(1)
                        done()
                    })   
                })
            })
            
        })

    })

})
