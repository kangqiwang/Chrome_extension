var should = require('should');
var Structure = require('../lib/structure.js')
const cache = require('../lib/cache')


describe('us.sportsdirect.com', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://us.sportsdirect.com/adidas-ace-fingersave-goalkeeper-gloves-junior-837102?colcode=83710213",
            "html": cache.load("http://us.sportsdirect.com/adidas-ace-fingersave-goalkeeper-gloves-junior-837102?colcode=83710213")
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(err, inStockPage) {
                var expected = JSON.stringify({
                    "name": "adidas Ace Fingersave Goalkeeper Gloves Junior",
                    "price": "36.78",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://images.sportsdirect.com/images/products/83710213_l.jpg',
                    "country": 'us',
                    "description": "adidas Ace Fingersave Goalkeeper Gloves Junior  The adidas Ace Fingersave Goalkeeper Gloves are constructed with a smooth latex palm to offer durability, cushioning and grip in all weather conditions. Its special engineered cut provides a more maximised contact area in all catching motions. Its close fitting wrist wrap offers a secure fit that is customised to fit you. These goalkeeper gloves benefit from having Fingersave spines which amazingly stiffen and resist pressure when pushed backwards by when deflecting the ball from the goal.  Fluorescent colouring is teamed with a block patterning on the back of the hands as well as adidas branding. > Goalkeeper gloves> Palm grip> Fingersave spines > Positive cut> Elastic bandage > Full wrap wrist strap > Fluorescent colouring > Block pattern> adidas branding For our full range of View All adidas visit SportsDirectUSA                            Product code: 837102"
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://us.sportsdirect.com/adidas-ace-fingersave-goalkeeper-gloves-junior-837102?colcode=83710213",
            "html": cache.load("http://us.sportsdirect.com/adidas-ace-fingersave-goalkeeper-gloves-junior-837102?colcode=83710213")
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(err, inStockPage) {
                var expected = JSON.stringify({
                    "name": "Firetrap Canvas Belt Mens",
                    "price": "6.38",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": "http://images.sportsdirect.com/images/products/94678501_l.jpg",
                    "country": 'us',
                    "description": 'Firetrap Canvas Belt Mens  This Firetrap Canvas Belt Mens, features a clasp fastening for a secure fit as well as Firetrap branding for a great look.> Belt> Clasp fastening> Firetrap branding > 80% polyester 20% cottonFor our full range of Mens Accessories Sale visit SportsDirectUSA                            Product code: 946785                                                     Firetrap Canvas Belt Mens  This Firetrap Canvas Belt Mens, features a clasp fastening for a secure fit as well as Firetrap branding for a great look.> Belt> Clasp fastening> Firetrap branding > 80% polyester 20% cottonFor our full range of Mens Accessories Sale visit SportsDirectUSA                            Product code: 946785'

                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://us.sportsdirect.com/mens/mens-football-boots/adidas-football-boots#dcp=1&dppp=100&OrderBy=rank",
            "html": cache.load("http://us.sportsdirect.com/mens/mens-football-boots/adidas-football-boots#dcp=1&dppp=100&OrderBy=rank")
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(err, pagination) {
                var expected = JSON.stringify({
                    "items": 100,
                    "pages": 4,
                    "url":"http://us.sportsdirect.com/mens/mens-football-boots/adidas-football-boots#dcp=1&dppp=100&OrderBy=rank"
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    });

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://us.sportsdirect.com/accessories/all-bags",
            "html": cache.load("http://us.sportsdirect.com/accessories/all-bags")
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(err, category) {
                var expected = JSON.stringify({
                    "name": "All Bags",
                    "url":"http://us.sportsdirect.com/accessories/all-bags"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://us.sportsdirect.com/accessories/tennis",
            "html": cache.load("https://us.sportsdirect.com/accessories/tennis")
        }

        // Change to be the number of products on the page
        var x = 100;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(err, result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Wilson US Open 6 Pack Tennis Balls';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(err, result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '35.99',
                    url: 'http://us.sportsdirect.com/wilson-us-open-6-pack-tennis-balls-745023?colcode=74502313',
                    image: 'https://images.sportsdirect.com/images/products/74502313_4pl.jpg',
                    country: 'us',
                    sku:"745023"
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Wilson 72 Training Tennis Balls Bucket';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(err, result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '104.99',
                    url: 'http://us.sportsdirect.com/wilson-72-training-tennis-balls-bucket-745154?colcode=74515413',
                    image: 'https://images.sportsdirect.com/images/products/74515413_4pl.jpg',
                    country: 'us',
                    sku:"745154"
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
