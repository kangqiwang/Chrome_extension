var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://shop.lenovo.com/SEUILibrary/controller/e/gbweb/LenovoPortal/en_GB/catalog.workflow:item.detail?hide_menu_area=true&GroupID=460&Code=GX30K69567"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Lenovo YOGA Mouse (Golden)",
                    "price": "49.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://shop.lenovo.com/ISS_Static/options/US/images/19065227862_YOGA Mouse_Gold_20160425054509.jpg',
                    "country": 'uk',
                    "description": 'The YOGA Mouse is your ultimate travel mouse for both work and play. It features a slim and elegant design without compromising comfort and grip.  A rechargeable battery is integrated and sealed inside, eliminating the need to buy spares. For connectivity, the mouse supports either Bluetooth 4.0 or 2.4 GHz wireless connection to provide maximum flexibility. Most impressively, the YOGA Mouse boasts an adaptive touch display when in flat mode that provides additional control for presentations and entertainment.2.4G or Bluetooth 4.0 wireless connection\nMultilayer adaptive touchpad\n1 month of battery life from 2-hour charge\nUltra-slim, 13.5 mm design\n180-degree rotatable hinge\n4 colour options'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    // describe('Search page pagination', function() {

    //     var payload = {
    //         "pageType" : "pagination",
    //         "url" : "http://shop.lenovo.com/gb/en/deals-and-coupons/accessories-deals/"
    //     }

    //     it('should be true when number of items and pages correct', function (done) {

    //         Structure(payload, function(pagination) {
    //             var expected = JSON.stringify({
    //                 "items": "8",
    //                 "pages": "1"
    //             })
    //             JSON.stringify(pagination).should.equal(expected);
    //             done()
    //         })
    //     });

    // })
    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://shop.lenovo.com/gb/en/deals-and-coupons/accessories-deals/"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Deals on Accessories"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });


    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://shop.lenovo.com/gb/en/deals-and-coupons/accessories-deals/"
        }

        // Change to be the number of products on the page
        var x = 8;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Lenovo YOGA Mouse (Golden)';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '49.99',
                    url: '//shop.lenovo.com/SEUILibrary/controller/e/gbweb/LenovoPortal/en_GB/catalog.workflow:item.detail?hide_menu_area=true&GroupID=460&Code=GX30K69567',
                    image: 'http://www.lenovo.com/images/subseries/lenovo-yoga-mouse-accessory-hero.png?image1=image',
                    country: 'uk'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'ThinkPad X1 In-ear Headphones';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '72.00',
                    url: '//shop.lenovo.com/SEUILibrary/controller/e/gbweb/LenovoPortal/en_GB/catalog.workflow:item.detail?hide_menu_area=true&GroupID=460&Code=4XD0K74703',
                    image: 'http://shop.lenovo.com/ISS_Static/ww/ag/merchandising/options/images/large/_460_0_4XD0K74703_V6.jpg',
                    country: 'uk'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
