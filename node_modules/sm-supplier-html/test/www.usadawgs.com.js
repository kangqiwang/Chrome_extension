var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.usadawgs.com/products/womens-kaymann-boat-shoes-pdpk"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Women's Kaymann Boat Shoes",
                    "price": "23.99",
                    "url": payload.url,
                    "inStock": 'UNCHECKED',
                    "stockLevel": null,
                    "image": 'https://cdn.shopify.com/s/files/1/1000/1700/products/KBSS.W.A.PD-Pk-outside_compact.jpeg?v=1445563496',
                    "country": 'us',
                    "description": "For a look that can go from preppy to playtime with ease, check out the DAWGS Kaymann Boat Shoes. This women's shoe features durable canvas upper, with shoe laces that go all around the back top side of the shoe and stitching along the front edge. The padded leather insole provides cushioning and rubber sole add to the overall comfort. They come in various plaid colors, perfect for any occasion and outfit. These are sure to become your favorite go to shoes.",
                    "sku": 'womens-kaymann-boat-shoes-pdpk'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });
     describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "https://www.usadawgs.com/pages/search-results-page?q=shoes"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "shoes"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "https://www.usadawgs.com/pages/search-results-page?q=shoes"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 16,
                    "pages": 72
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.usadawgs.com/collections/women/Dawgs+Boots+Singles"
        }

        // Change to be the number of products on the page
        var x = 30;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = "Women\'s 9-inch Microfiber Boots - Black";
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '79.99',
                    url: 'https://www.usadawgs.com/collections/women/products/womens-9-inch-microfiber-boots-bk?lshst=collection',
                    image: 'https://cdn.shopify.com/s/files/1/1000/1700/products/BMF9.W.A.Bk-outside_195x.jpeg?v=1445561624',
                    country: 'us',
                    sku: 'womens-9-inch-microfiber-boots-bk'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = "Women\'s 9-inch Side Tie Microfiber Boots - Chocolate";
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '79.99',
                    url: 'https://www.usadawgs.com/collections/women/products/womens-9-inch-side-tie-microfiber-boots-ch?lshst=collection',
                    image: 'https://cdn.shopify.com/s/files/1/1000/1700/products/BST9.W.A.Ch-outside_87139c84-7b6a-4b2b-9fc8-eace18beaf7d_195x.jpeg?v=1445561948',
                    country: 'us',
                    sku: 'womens-9-inch-side-tie-microfiber-boots-ch'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
