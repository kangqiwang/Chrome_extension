var RedisSMQ = require("x4-rsmq");
let mq = {};

const redis = {

    mq(config, qname) {
        let key =  generateKey(config, qname)
        if (mq[key] === undefined) {            
            mq[key] = new RedisSMQ({
                host: config.host,
                port: config.port,
                ns: 'rsmq',
                keepAlive: true,
                keepAliveInterval: 1000,
                maxRetries: 9000
            });
        } 

        return mq[key];
    },

    clear(config, qname, next) {
        let key = generateKey(config, qname)
        mq[key] = undefined
        next();
    }

}

const generateKey = (config, qname) => {
    return config.host + '-' + config.port + '-' + qname
}

module.exports = redis