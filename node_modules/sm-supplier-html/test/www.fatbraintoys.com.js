var should = require('should');
var Structure = require('../lib/structure.js')
const cache = require('../lib/cache')

describe('www.fatbraintoys.com', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.fatbraintoys.com/toy_companies/elenco_electronics_inc/deluxe_eco_robotics.cfm",
            "html" : cache.load("https://www.fatbraintoys.com/toy_companies/elenco_electronics_inc/deluxe_eco_robotics.cfm")
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(err, inStockPage) {
                var expected = JSON.stringify({
                    "name": "Deluxe Eco Robotics",
                    "price": "39.54",
                    "url": payload.url,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'https://d1jqecz1iy566e.cloudfront.net/extralarge/ee081.jpg',
                    "country": 'us',
                    "description": "Learn about pivotal solar powered technology while making 14 robo-friends!Engineer moving, rolling, and swimming robots. The process and the creations educate and fascinate the mind!Start with the first level of basic robot building and create silly creatures that move around your table. Make a companion dog-bot, a crawling turtle-bot, a scurrying beetle-bot, a wheel bot, boat bot, and more.Move to the second level of bot-building to challenge your engineering skills with the roly poly bot, auto bot, surf bot, zombie bot, and more!Extremely detailed instructions with 190 easy-to-piece-together parts make building and learning easy for all.Alternative energy is the future of engineering. What better time to get kids learning the basics of solar technologies than now, with the 14-in-1 Solar Robot builder set!Deluxe Eco RobotsAn engineering kit for making 14 solar powered robotsEncourages scientific learning, logic, creativityA wonderfully designed toy to explore solar energy Basic building skills level - turtle bot, beetle bot, quadru bot, boat bot, walker bot, dog bot, wheel botAdvanced building skills level - roly poly bot, auto bot, slither bot, surf bot, zombie bot, crab bot, row botFeatures decal stickers for cool decorationRobots move on land and waterIncludes 4 sheets punch-out parts, boat parts, solar panels, 4 tires, 2 wires, 2 gears, decal sticker sheetHighly detailed instruction manual includedAssemble, dismantle and reassemble again and againCompletely solar powered - no batteries requiredRequires direct sunlight to be able to moveMade of strong, durable plastic pieces"
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.fatbraintoys.com/toy_companies/workman_publishing/pictomazes.cfm",
            "html": cache.load('https://www.fatbraintoys.com/toy_companies/workman_publishing/pictomazes.cfm')
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(err, inStockPage) {
                var expected = JSON.stringify({
                    "name": "PictoMazes",
                    "price": "",
                    "url": payload.url,
                    "inStock": false,
                    "stockLevel": null,
                    "image": 'https://d1jqecz1iy566e.cloudfront.net/extralarge/wo184.jpg',
                    "country": 'us',
                    "description": ""
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Search page pagination', function() {

    //     var payload = {
    //         "pageType" : "pagination",
    //         "url" : "https://www.fatbraintoys.com/toys/toy_categories/rc_electronics/index.cfm",
    //         "html" : cache.load("https://www.fatbraintoys.com/toys/toy_categories/rc_electronics/index.cfm")
    //     }

    //     it('should be true when number of items and pages correct', function (done) {

    //         Structure(payload, function(err, pagination) {
    //             var expected = JSON.stringify({
    //                 "items": 100, //this is the number of items on one page, not all in the category//
    //                 "pages": 4,
    //                 "url" : "https://www.fatbraintoys.com/toys/toy_categories/rc_electronics/index.cfm"
    //             })
    //             JSON.stringify(pagination).should.equal(expected);
    //             done()
    //         })
    //     });

    // })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "https://www.fatbraintoys.com/toys/toy_categories/building_construction/index.cfm",
            "html" : cache.load("https://www.fatbraintoys.com/toys/toy_categories/building_construction/index.cfm")
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(err, category) {
                var expected = JSON.stringify({
                    "name": "Building & Construction",
                    "url" : payload.url 
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    // describe('Checking to see if no pgination works', function() {

    //     var payload = {
    //         "pageType" : "pagination",
    //         "url" : "https://www.fatbraintoys.com/toys/toy_categories/teaching_toys_tools/index.cfm?q=&d1=&d2=&d3=&d4=&d5=&d6=&d7=&d8=1&d9=&d10=&d11=&sf=y"
    //     }

    //     it('should return 0/null items and null pages', function (done) {

    //         Structure(payload, function(pagination) {
    //             var expected = JSON.stringify({
    //                 "items": null,
    //                 "pages": null
    //             })
    //             JSON.stringify(pagination).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.fatbraintoys.com/toys/toy_categories/building_construction/index.cfm",
            "html" : cache.load("https://www.fatbraintoys.com/toys/toy_categories/building_construction/index.cfm")
        }

        // Change to be the number of products on the page
        var x = 101;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(err, result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Roll & Bounce Tower';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(err, result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '29.95',
                    url: 'https://www.fatbraintoys.com/toy_companies/fat_brain_toys/roll_bounce_tower.cfm',
                    image: '',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'UGEARS Safe';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(err, result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '46.95',
                    url: 'https://www.fatbraintoys.com/toy_companies/hq_kites_designs_usa/ugears_safe.cfm',
                    image: 'https://d1jqecz1iy566e.cloudfront.net/large/nd095.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
