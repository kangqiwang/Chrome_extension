var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.rockymountaintrail.com/Patagonia/Ascensionist_Pack_45L/48000/detail"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Patagonia Ascensionist Pack 45L",
                    "price": "179.00",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'www.rockymountaintrail.com/images/pictures/1600/48000_DFTG.jpg',
                    "country": 'us',
                    "description": "Patagonia Ascensionist Pack 45LOur ambassadors' request: a super-clean climbing backpack stripped of everything but the features that matter most when you're pushing the limits on big alpine ascents. For moving fast in Alaska or the Karakoram, this function-driven pack carries the loads of a multiday kit without interfering with your ability to move efficiently. It features an integrated, asymmetrical spindrift collar that opens wide and closes in a single motion for fast packing. A secondary collar protects your gear from ugly weather, allows serious overstuffing and holds gear securely when the pack is hanging at belays. The removable frame sheet, made from a lightweight aluminum rod and covered with mesh, provides support for weighted loads and moves with you as you bend and flex. Ergonomic shoulder straps (with load lifters) match your torso's contours for 24-hour comfort, and the pads on the hip belt are removable when you prefer a simple webbing belt. Four rows of exterior daisy chains provide lashing options for a rope, helmet and pad; ice tools attach via an integrated buckle and tool pocket. Other details include compression straps to carry skis and cinch down loads, an asymmetric profile for elbow clearance and a zippered pocket on the lid for quick access to small essentials."
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.rockymountaintrail.com/productlist.aspx?rwvars=Mens_Clothing/Mens_Jackets/"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 160,
                    "pages": 2
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.rockymountaintrail.com/outdoor/Backpacks/Backpacking_Packs/"
        }

        // Change to be the number of products on the page
        var x = 55;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Kelty Redwing 50 Backpack';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '103.90',
                    url: 'http://www.rockymountaintrail.com/Kelty/Redwing_50_Backpack/22615216/detail',
                    image: 'http://www.rockymountaintrail.com/images/pictures/140/22615216_BK.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Patagonia Ascensionist Pack 45L';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '179.00',
                    url: 'http://www.rockymountaintrail.com/Patagonia/Ascensionist_Pack_45L/48000/detail',
                    image: 'http://www.rockymountaintrail.com/images/pictures/140/48000_UWTB.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });
    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.rockymountaintrail.com/outdoor/Backpacks/Backpacking_Packs/"
        }

        it('should be true when the category is correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Backpacking Packs"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

});
