var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.rcwilley.com/Electronics/TVs/LED/OLED55B6P/110152689/LG-B6-Series-OLED-55-4K-Smart-TV-View.jsp"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "LG B6 Series OLED 55\" 4K Smart TV",
                    "price": "1799.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://static.rcwilley.com/products/110152689/LG-B6-Series-OLED-55-4K-Smart-TV-rcwilley-image1~200.jpg?r=3',
                    "country": 'us',
                    "description": "Get ready to be amazed! Now at RC Willey, LG\'s B6 OLED 4K Smart TV offers pixels that can be individually controlled to achieve perfect black and infinite contrast. It also support HDR, including Dolby Visionâ„¢. So get ready for a whole new (and better) viewing experience for you and your family!"
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.rcwilley.com/Electronics/Audio/Search.jsp"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 60,
                    "pages": 5
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.rcwilley.com/Electronics/TVs/Search.jsp"
        }

        // Change to be the number of products on the page
        var x = 108;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Proscan 40" 1080p LED TV';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '179.95',
                    url: 'http://www.rcwilley.com/Electronics/TVs/LED/PLDED4016A/110213815/Proscan-40-1080p-LED-TV-View.jsp',
                    image: 'http://static.rcwilley.com/products/110213815/Proscan-40-1080p-LED-TV-rcwilley-image1~300.jpg?r=12',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Quasar 55" 4K LED TV';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '699.95',
                    url: 'http://www.rcwilley.com/110286472',
                    image: 'http://static.rcwilley.com/products/110286472/image1~300.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });
    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.rcwilley.com/Electronics/TVs/Search.jsp"
        }

        it('should be true when the category is correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "TVs"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

});
