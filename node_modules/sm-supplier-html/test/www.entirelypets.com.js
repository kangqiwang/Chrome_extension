var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.entirelypets.com/rcaiguana10oz.html"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Adult Iguana Food (10oz)",
                    "price": "4.09",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://ep.yimg.com/ay/entirelypets/adult-iguana-food-10oz-12.jpg',
                    "country": 'us',
                    "description": 'Rep-Cal Adult Iguana Food is formulated to ensure proper growth and health by providing complete and balanced nutrition. It is a veterinarian recommended food containing natural plant and fruit ingredients iguanas love and provides the 100% complete daily nutrition they need. Rep-Cal Adult Iguana Food has been tested successfully for adult iguanas (more than 12in long from nose to base of tail) by reptile veterinarians. It is fortified with optimal levels of vitamins and minerals like calcium and vitamin D3 so no other food or supplements are required.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://search.entirelypets.com/search#?lbc=entirelypets&method=and&p=Q&ts=ajax&uid=417498&w=adult&cnt=192"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 192,
                    "pages": 6
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.entirelypets.com/otis-and-claude-critterz.html"
        }

        it('should be true when correct category is returned', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Otis & Claude CritterZ Stuffing Free Dog Toys"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://search.entirelypets.com/search#?lbc=entirelypets&method=and&p=Q&ts=ajax&uid=417498&w=adult&cnt=192"
        }

        // Change to be the number of products on the page
        var x = 192;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Adult Iguana Food (10oz)';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '4.09',
                    url: 'http://search.entirelypets.com/search?p=R&srid=S1-1IADP&lbc=entirelypets&w=adult&url=http%3a%2f%2fwww.entirelypets.com%2frcaiguana10oz.html&rk=1&uid=417498&sid=2&ts=ajax&SLIPid=1481200052275&rsc=EEEW4yb2uW93CX80&cnt=192&method=and&isort=score&view=grid',
                    image: 'http://search.entirelypets.com/thumb.php?s=150&aspect=true&f=http%3a%2f%2fep.yimg.com%2fay%2fentirelypets%2fadult-iguana-food-10oz-11.gif',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Nutro Natural Choice Limited Ingredient Diet Lamb & Whole Brown Rice - Adult Dog (15 lb)';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '38.39',
                    url: 'http://search.entirelypets.com/search?p=R&srid=S1-1IADP&lbc=entirelypets&w=adult&url=http%3a%2f%2fwww.entirelypets.com%2fnutro-natural-choice-lamb-whole-rice-15-lb.html&rk=192&uid=417498&sid=2&ts=ajax&SLIPid=1481200052275&rsc=gibhoP3aq7PdG5S2&cnt=192&method=and&isort=score&view=grid',
                    image: 'http://search.entirelypets.com/thumb.php?s=150&aspect=true&f=http%3a%2f%2fep.yimg.com%2fay%2fentirelypets%2fnutro-natural-choice-limited-ingredient-diet-lamb-whole-brown-rice-adult-dog-15-lb-19.gif',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
