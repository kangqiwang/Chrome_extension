var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.champssports.com/product/model:251720/sku:06809002/nike-air-max-95-sneakerboots-mens/all-black/black/"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Nike Air Max 95 Sneakerboots - Men's",
                    "price": "169.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://images.champssports.com/is/image/EBFL2/06809002_fr_sc7?hei=1500&wid=1500',
                    "country": 'us',
                    "description": "Gear up for winter with the Nike Air Max 95 Sneakerboot. Whether you're playing ball or running to class, the neoprene bootie is lined for extra warmth, waterproof to keep you dry, and the rubber outsole will grant you the traction you need to combat the elements. Coated textile and waterproof leather upper to keep the elements out. Heat-reflective sock liner provides max warmth. Reflective panels on the heels for increased visibility, and rubber outsoles give you max traction on various surfaces."
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.champssports.com/Mens/Shoes/_-_/N-24Zrj?Rpp=180&cm_PAGE=180&Nr=AND%28P_RecordType%3AProduct%29"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 180,
                    "pages": 31
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.champssports.com/Mens/Shoes/_-_/N-24Zrj?Rpp=180&cm_PAGE=180&Nr=AND%28P_RecordType%3AProduct%29"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Men's Shoes"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.champssports.com/Mens/Shoes/_-_/N-24Zrj?Rpp=180&cm_PAGE=180&Nr=AND%28P_RecordType%3AProduct%29"
        }

        // Change to be the number of products on the page
        var x = 180;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Nike Air Max 95 Sneakerboots - Men\'s';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '169.99',
                    url: 'http://www.champssports.com/product/model:251720/sku:06809002/nike-air-max-95-sneakerboots-mens/all-black/black/',
                    image: 'http://images.champssports.com/pi/06809002/large/nike-air-max-95-sneakerboots-mens',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Nike Kobe 11 Low - Men\'s';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '144.99',
                    url: 'http://www.champssports.com/product/model:258858/sku:36183805/nike-kobe-11-low-mens/kobe-bryant/orange/black/',
                    image: 'http://images.champssports.com/pi/36183805/large/nike-kobe-11-low-mens',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
