var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.katvondbeauty.com/shop-all-products/sets/the-bow-n-arrow-look/28865V1.html"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "The Bow N Arrow Look",
                    "price": "20.00",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://demandware.edgesuite.net/sits_pod29/dw/image/v2/AAXW_PRD/on/demandware.static/-/Sites-itemmaster_KVD/default/dwfd9c1ce3/hi-res/28865V1.jpg?sw=550 550w',
                    "country": 'us',
                    "description": 'If we had to choose one look to rock every day, this would be it! The Bow N Arrow Look is the ultimate power pair for an unstoppable bold eye and matte nude lip—and it couldn’t be easier to wear! First, wing out the perfect Kat Eye with Ink Liner in “Trooper,” the most saturated black felt-tip liquid liner ever created. Finish the look with a swipe of Everlasting Liquid Lipstick in bestseller “Bow N Arrow,” a matte fawn nude.Both minis in this travel-friendly duo were made for each other, with true long wear and waterproof, high-pigment formulas that deliver super-intense payoff with every swipe!100% Cruelty Free Forever!#VeganAlert'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.katvondbeauty.com/shop-all-products/lip"
        }

        it('should be true when correct category is returned', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Lip"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.katvondbeauty.com/shop-all-products/lip"
        }

        // Change to be the number of products on the page
        var x = 12;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'The Bow N Arrow Look';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '20.00',
                    url: 'http://www.katvondbeauty.com/shop-all-products/sets/the-bow-n-arrow-look/28865V1.html',
                    image: 'http://demandware.edgesuite.net/sits_pod29/dw/image/v2/AAXW_PRD/on/demandware.static/-/Sites-itemmaster_KVD/default/dwfd9c1ce3/hi-res/28865V1.jpg?sw=290 290w',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'The Purrfect Pair Studded Kiss Set';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '35.00',
                    url: 'http://www.katvondbeauty.com/lip/lipstick/the-purrfect-pair-studded-kiss-set/26106.html',
                    image: 'http://demandware.edgesuite.net/sits_pod29/dw/image/v2/AAXW_PRD/on/demandware.static/-/Sites-itemmaster_KVD/default/dw7a4ebf3b/hi-res/26106.jpg?sw=290 290w',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
