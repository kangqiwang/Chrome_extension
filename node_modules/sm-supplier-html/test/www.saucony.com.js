var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.saucony.com/UK/en_GB/paris-triumph-iso-2/24866M.html?dwvar_24866M_color=S20290-17"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Paris Triumph ISO 2",
                    "price": "81.00",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://img.wolverineworldwide.com/is/image/WolverineWorldWide/S20290-17_1?wid=790&hei=657&fmt=jpeg&qlt=80,0&op_sharpen=0&resMode=bilin&op_usm=0.5,1.0,8,0&iccEmbed=0&printRes=72',
                    "country": 'uk',
                    "description": 'Inspired by a French fashion staple, the Marinière shirt, this limited edition Triumph features the iconic Breton Stripe design on the heel and insole. OVERVIEW Design inspired by a French classic, the Marinière shirt, first worn by naval sailors over a century ago and later adopted by the global fashion community. Featuring the Breton Stripe design (horizontal navy and white) on the heel and sockliner Featuring EVERUN Topsole and an EVERUN Landing Zone in the heel A new TRI-FLEX outsole configuration for better ground contact and a smoother ride Improved ISOFIT upper for an even closer and more accommodating fit Welded bottom eyelet for added comfort over the foot SPECS Shoe Category: Neutral Pronation: Neutral Cushion: Plush Construction Type: Neutral Surface: Road, Track Arch: High, Normal (Mid) Water Resistant: No Waterproof: No Offset: 8mm Heel Stack Height: 30mm Forefoot Stack Height: 22mm Weight: 10.2 oz. | 289 g.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : ""
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": "",
                    "pages": ""
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })*/

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.saucony.com/UK/en_GB/mens-running/"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Running"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.saucony.com/UK/en_GB/mens-running/"
        }

        // Change to be the number of products on the page
        var x = 71;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Paris Triumph ISO 2';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '81.00',
                    url: 'http://www.saucony.com/UK/en_GB/paris-triumph-iso-2/24866M.html?dwvar_24866M_color=S20290-17',
                    image: 'http://img.wolverineworldwide.com/is/image/WolverineWorldWide/S20290-17_1?wid=186&hei=160&fmt=jpeg&qlt=80,0&op_sharpen=0&resMode=bilin&op_usm=0.5,1.0,8,0&iccEmbed=0&printRes=72&align=0,1',
                    country: 'uk'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Peregrine 6';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '105.00',
                    url: 'http://www.saucony.com/UK/en_GB/peregrine-6/21925M.html?dwvar_21925M_color=S20302-2',
                    image: 'http://img.wolverineworldwide.com/is/image/WolverineWorldWide/S20302-2_1?wid=186&hei=160&fmt=jpeg&qlt=80,0&op_sharpen=0&resMode=bilin&op_usm=0.5,1.0,8,0&iccEmbed=0&printRes=72&align=0,1',
                    country: 'uk'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
