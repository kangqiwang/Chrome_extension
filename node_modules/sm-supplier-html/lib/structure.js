const cheerio = require('cheerio')
const url = require('url')
const loadSupplier = require('./loadSupplier')

module.exports = Structure = function (payload, next) {

    if(!payload.html && !payload.url) {
        console.error('NO_HTML')
        return false
    }

    if(!payload.url) {
        console.error('NO_URL')
        return false
    }

    let parseUrl = url.parse(payload.url)
    let supplierLogic = loadSupplier(parseUrl.host)

    if(supplierLogic === false) {
        return false
    }

    let $ = cheerio.load(payload.html)

    let pageInfo = supplierLogic[payload.pageType]($)

    pageInfo.url = payload.url

    if (payload.pageType === 'product') {
        if (typeof supplierLogic['sku'] == 'function') {
            pageInfo.sku = supplierLogic['sku'](payload.url)
        }
    }
    return pageInfo
}
