var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.fragrancedirect.co.uk/paco-rabanne/paco-rabanne-invictus-gift-set-100ml/invt/0052960"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Paco Rabanne Invictus Gift Set 100ml",
                    "price": "39.95",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://www.fragrancedirect.co.uk/content/ebiz/fragrancedirect/invt/0052960/0052960_l.jpg',
                    "country": 'uk',
                    "description": 'New for 2014, the Paco Rabanne Invictus Gift Set features the sporty and fresh Invictus fragrance which is a strong, energetic and masculine scent. Invictus is the Latin for invincible and is designed to make the wearer feel capable of anything. The Invictus fragrance features Mandarin Orange, Grapefruit and Sea notes at the top, heart notes of Jasmine and Bay Leaf and base notes of Ambergris, Patchouli, Oakmoss and Guaiac Wood.  The Paco Rabanne Invictus Gift Set features a 100ml Eau de Toilette spray and a 100ml shower gel featuring the Invictus fragrance. Featuring a sleek, silver box with the iconic trophy bottle, Paco Rabanne Invictus is a fantastic gift for any man.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.fragrancedirect.co.uk/the-real-shaving-co-shave-cream-sensitive-150ml/invt/0052836"
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "The Real Shaving Co. Shave Cream Sensitive 150ml",
                    "price": "1.50",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": 'http://www.fragrancedirect.co.uk/content/ebiz/fragrancedirect/invt/0052836/0052836_l.jpg',
                    "country": 'uk',
                    "description": 'The Real Shaving Company has been providing professional shaving products to barbers throughout the UK since the 1950s.Inspired by furnishing barbers with a range of products combining style with quality, Real Shaving Company products give the smoothest possible shave leaving the skin feeling smooth and well nourished.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Unavailable Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.fragrancedirect.co.uk/justin-bieber-singing-toothbrush-feat-baby+u-smile/invt/0045290"
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "9.99",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "country": 'uk',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.fragrancedirect.co.uk/gifts/mens-gift-sets/icat/mensfragrancegifts"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 60,
                    "pages": 4
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

     describe('Not a search page', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.fragrancedirect.co.uk/paco-rabanne/paco-rabanne-invictus-gift-set-100ml/invt/0052960"
        }

        it('should return null items and pages', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": null,
                    "pages": null
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    });

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.fragrancedirect.co.uk/gifts/mens-gift-sets/icat/mensfragrancegifts"
        }

        it('should be true when correct category is returned', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Mens Gift Sets"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.fragrancedirect.co.uk/sale/fragrance-sale/"
        }

        // Change to be the number of products on the page
        var x = 20;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Calvin Klein CK One Eau de Toilette Spray 200ml';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '23.95',
                    url: 'http://www.fragrancedirect.co.uk/calvin-klein-ck-one-eau-de-toilette-spray-200ml-0000421.html?cgid=fragrance-sale',
                    image: 'http://demandware.edgesuite.net/sits_pod48/dw/image/v2/BBNB_PRD/on/demandware.static/-/Sites-fragrance-master-catalog/default/dw636d9e24/images/large/Calvin-Klein-CK-One-Eau-de-Toilette-Spray-50ml-0001444-1.jpg?sw=210&sh=255&sm=fit',
                    country: 'uk'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Laurelle Parfums 2 Les Couleurs Homme EDP Spray 100ml';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '3.99',
                    url: 'http://www.fragrancedirect.co.uk/laurelle-parfums-2-les-couleurs-homme-edp-spray-100ml-0056727.html?cgid=fragrance-sale',
                    image: 'http://demandware.edgesuite.net/sits_pod48/dw/image/v2/BBNB_PRD/on/demandware.static/-/Sites-fragrance-master-catalog/default/dw8611fa68/images/large/Laurelle-Parfums-2-Les-Couleurs-Homme-EDP-Spray-100ml-0056727-1.jpg?sw=210&sh=255&sm=fit',
                    country: 'uk'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
