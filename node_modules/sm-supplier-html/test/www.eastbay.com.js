var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.eastbay.com/product/model:247405/sku:81006010/jordan-aj-xxx-mens/black/grey/"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Jordan AJ XXX - Men's",
                    "price": "139.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://images.eastbay.com/pi/81006010/zoom/jordan-aj-xxx-mens',
                    "country": 'us',
                    "description": 'Three decades of innovation have led to this shoe. Live up to the Jordan legacy with the latest in a long line of greatness. The upper is a mix of woven, knit, and printed materials. Knit cradle keeps your heel in place from the first step to the last. The Jumpman logo on the toe box can be seen at some angles and not at others due to reflective technology never used by Jordan before. Michael Jordan\'s one demand was to “Make it Look Fast,” which is done by the “XXX” graphic that wraps the heel and extends through the forefoot. FlightSpeed system works with Nike Zoom Air technology to provide a more explosive first step. A new traction system inspired by the Jordan quote “Excellence is never second place,” has been rendered in 3D to serve the needs of athletes like Russell Westbrook.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.eastbay.com/Mens/Shoes/_-_/N-1pZne?Rpp=180&cm_PAGE=180&Nr=AND%28P_RecordType%3AProduct%29"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 180,
                    "pages": 32
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.eastbay.com/Mens/Shoes/_-_/N-1pZne?Rpp=180&cm_PAGE=180&Nr=AND%28P_RecordType%3AProduct%29"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Men's Shoes"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.eastbay.com/Mens/Shoes/_-_/N-1pZne?Rpp=180&cm_PAGE=180&Nr=AND%28P_RecordType%3AProduct%29"
        }

        // Change to be the number of products on the page
        var x = 180;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Jordan AJ XXX - Men\'s';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '139.99',
                    url: 'http://www.eastbay.com/product/model:247405/sku:81006010/jordan-aj-xxx-mens/black/grey/',
                    image: 'http://images.eastbay.com/pi/81006010/large/jordan-aj-xxx-mens',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Nike Free RN Flyknit - Men\'s';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '129.99',
                    url: 'http://www.eastbay.com/product/model:260702/sku:1069001/nike-free-rn-flyknit-mens/black/white/',
                    image: 'http://images.eastbay.com/pi/1069001/large/nike-free-rn-flyknit-mens',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
