var PageInfo = require ('../../lib/pageInfo.js')

module.exports = {
    "useJavascript" : true,
    'product' : function($, next) {
        var info  = new PageInfo()
        info.inStock = isStock($)
        info.name = getName($)
        info.price = getPrice($)
        info.image = image($)
        info.country = "uk"
        return info
    }
}


var isStock = function inStock($) {
    var isInStock = true;
    var producttop = $('.product-info').html()

    if(producttop !== null) {
        if((producttop.indexOf('Not in Stock') > -1)
        || (producttop.indexOf('Not in stock') > -1)
        || (producttop.indexOf('Unavailable') > -1)) {
            isInStock = false
        }
    }
    return isInStock
}

var getPrice = function thePrice($) {
    return $('.pricing').find('h2').text().replace('Â£','').replace(',','').trim()
}

var getName = function theName($) {
    return $('h1').text().trim()
}

var image = function image($) {
    return $('.productImage img').attr('src');
}
