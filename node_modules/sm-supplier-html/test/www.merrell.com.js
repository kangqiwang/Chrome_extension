var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

    var payload = {
                 "pageType" : "product",
                 "url" : "http://www.merrell.com/US/en/moab-fst-ice-thermo/26966M.html?dwvar_26966M_color=J35789"
             }
     
             it('should be true when product is in stock', function (done) {
     
                 Structure(payload, function(inStockPage) {
                     var expected = JSON.stringify({
                        "name": "Men's Moab FST Ice+ Thermo",
                        "price": "150.00",
                         "url": null,
                         "inStock": true,
                         "stockLevel": null,
                        "image": 'http://img.wolverineworldwide.com/is/image/WolverineWorldWide/MRLM-J35789-032116-F16-HERO?wid=388&hei=320&qlt=70&fmt=jpg&extend=0,0,0,0&resMode=sharp&op_usm=0.5,1',
                        "country": 'us',
                        "description": "FEATURES• Vibram® Arctic Grip™ outsole provides unparalleled traction on wet ice even in the most extreme winter conditions• M Select™ DRY seals out water and lets moisture escape so you stay dry when you're on the move• Leather/mesh and TPU cage with 3D print upper• Traditional lace closure• Bellows tongue keeps debris out• Conductor™ fleece lining for added warmth• M Select™ WARM lightweight, low bulk 100 grams insulation keeps you comfortable• Merrell M Select™ FIT.ECO blended EVA contoured footbed with organic odor control• Molded nylon arch shank• Merrell air cushion in the heel absorbs shock and adds stability• 5 mm lug depth• Weight: 3lbs 15oz"
                     })
                     JSON.stringify(inStockPage).should.equal(expected);
                     done()
                             });

            });
     
         });
 
    describe('Search page category', function() {
 
         var payload = {
            "pageType" : "category",
            "url" : "http://www.merrell.com/US/en/mens-hiking-boots-shoes/"
         }
 
        it('should be true when correct category is returned', function (done) {
 
            Structure(payload, function(category) {
                 var expected = JSON.stringify({
                    "name": "Men’s Hiking Boots"
                 })
                JSON.stringify(category).should.equal(expected);
                 done()
             })
         });
 
    });
 
    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.merrell.com/US/en/mens-hiking-boots-shoes/"
        }

        // Change to be the number of products on the page
        var x = 48;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Moab FST Ice+ Thermo';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '150.00',
                    url: 'http://www.merrell.com/US/en/moab-fst-ice-thermo/26966M.html?dwvar_26966M_color=J35789',
                    image: 'http://img.wolverineworldwide.com/is/image/WolverineWorldWide/MRLM-J35789-032116-F16-HERO?wid=186&hei=160&qlt=70&fmt=png-alpha&resMode=sharp&op_usm=0.5,1',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Solo Luxe';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '109.99',
                    url: 'http://www.merrell.com/US/en/solo-luxe/25458M.html?dwvar_25458M_color=J49659',
                    image: 'http://img.wolverineworldwide.com/is/image/WolverineWorldWide/MRLM-J49659-102715-F16-HERO?wid=186&hei=160&qlt=70&fmt=png-alpha&resMode=sharp&op_usm=0.5,1',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
