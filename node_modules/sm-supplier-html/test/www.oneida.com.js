var should = require('should');
var Structure = require('../lib/structure.js')

describe('www.oneida.com', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.oneida.com/food-preparation/cookware/cookware-sets/oneida-10pc-stainless-steel-cookware-set.html"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Oneida 10pc Stainless Steel Cookware Set",
                    "price": "169.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://www.oneida.com/media/catalog/product/cache/1/image/364x364/9df78eab33525d08d6e5fb8d27136e95/3/5/35017_3.jpg',
                    "country": 'us',
                    "description": 'Details Oneida 10pc Stainless Steel Cookware with aluminum encapsulated base heats quickly and evenly for better cooking. Oven Safe up to 450 degrees without the lid. Use in oven up to 350 degrees with the lid. We have added capacity engraving (Measurement Marks) on saucepans, saut√© and stockpots for quick measurements while cooking. Tempered glass colander lids allow for easily straining water from vegetables. Also Stainless Steel cast riveted handles for extra strength. Set Includes: 2 Qt. and 3 Qt. Saucepans, 3 Qt. Saute pan, 8\" and 10\" Fry Pans, 5 Qt. Dutch Oven with Cover. Polished stainless steel exterior and a satin finish, non-reactive interior. Uses: Gas, Electric, Induction, Halogen, Ceramic Lifetime Warranty - Dishwasher Safe'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.oneida.com/flatware/casual-flatware.html/"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 30,
                    "pages": 2
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.oneida.com/dinnerware/serveware/serving-and-individual-bowls.html"
        }

        // Change to be the number of products on the page
        var x = 30;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Anchor Hocking Banana Split Dish, Set of 12';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '27.57',
                    url: 'http://www.oneida.com/dinnerware/serveware/serving-and-individual-bowls/anchor-hocking-banana-split-dish-set-of-12.html',
                    image: 'http://www.oneida.com/media/catalog/product/cache/1/small_image/295x295/9df78eab33525d08d6e5fb8d27136e95/5/6/561g_8-25oz_banana_split_1.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Anchor Hocking Isabella White Oval Serving Bowl, 48 oz';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '17.46',
                    url: 'http://www.oneida.com/dinnerware/serveware/serving-and-individual-bowls/anchor-hocking-isabella-white-oval-serving-bowl-48-oz.html',
                    image: 'http://www.oneida.com/media/catalog/product/cache/1/small_image/295x295/9df78eab33525d08d6e5fb8d27136e95/1/0/10358com.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });
     describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.oneida.com/food-preparation/cookware/cookware-sets.html/"
        }

        it('should be true when the category is correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Cookware Sets"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

});
