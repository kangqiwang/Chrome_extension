var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.nbcstore.com/shop-by-show/the-office/the-office-dunder-stainless-steel-travel-mug.html"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "The Office Dunder Stainless Steel Travel Mug",
                    "price": "26.95",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'https://www.nbcstore.com/media/catalog/product/cache/1/image/9df78eab33525d08d6e5fb8d27136e95/t/h/the_office_dunder_travel_mug.jpg_height1000width1000.jpg',
                    "country": 'us',
                    "description": 'Your favorite paper company from The Office can become part of your routine with this Dunder Mifflin travel mug. Fill your Dunder Mifflin cup with warm and tasty coffee or tea, secure the lid, and take it wherever you go. Showcasing the famous logo of the Dunder Mifflin, Inc. paper company, this piece of The Office merchandise is just what you need to start your day.'
                    
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "https://www.nbcstore.com/shop-by-show/the-office.html"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 12,
                    "pages": 2
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "https://www.nbcstore.com/shop-by-show/the-office.html"
        }

        it('should be true when correct category is returned', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "The Office"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.nbcstore.com/shop-by-show/the-office.html"
        }

        // Change to be the number of products on the page
        var x = 12;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'The Office Worlds Best Boss 15 oz Mug';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '18.95',
                    url: 'https://www.nbcstore.com/shop-by-show/the-office/the-office-worlds-best-boss-mug.html',
                    image: 'https://www.nbcstore.com/media/catalog/product/cache/1/small_image/500x/9df78eab33525d08d6e5fb8d27136e95/t/h/the_office_world39s_best_boss_mug_mugs.jpg_height1000width1000.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'The Office - Season 2 DVD';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '39.98',
                    url: 'https://www.nbcstore.com/shop-by-show/the-office/office-season-2-dvd.html',
                    image: 'https://www.nbcstore.com/media/catalog/product/cache/1/small_image/500x/9df78eab33525d08d6e5fb8d27136e95/t/h/the_office_season_2_dvd.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
