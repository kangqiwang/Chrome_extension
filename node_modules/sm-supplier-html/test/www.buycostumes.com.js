var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.buycostumes.com/p/33020/batman-dark-knight-batman-grand-heritage-collection-adult-costume"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Batman Dark Knight - Batman Grand Heritage Collection Adult Costume",
                    "price": "329.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://images.buycostumes.com/mgen/merchandiser/batman-dark-knight-batman-grand-heritage-collection-adult-costume-bc-33020.jpg;ibrdf10a5e306b169bc?is=375,375,0xffffff',
                    "country": 'us',
                    "description": 'Gear up to fight crime and save the citizens of Gotham City in the Batman Dark Knight - Batman Grand Heritage Collection Adult Costume! Become the guardian who silently serves and protects from the darkness, ready to face any danger for the sake of others. Not even the Joker is a match for this knight!'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.buycostumes.com/c/themes/superheroes?SortBy=Popularity&ItemsPerPage=96"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 96,
                    "pages": 5
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })


    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.buycostumes.com/c/themes/superheroes?SortBy=Popularity&ItemsPerPage=96"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Superhero Costumes"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.buycostumes.com/c/themes/superheroes?SortBy=Popularity&ItemsPerPage=96"
        }

        // Change to be the number of products on the page
        var x = 96;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Batman Dark Knight - Batman Grand Heritage Collection Adult Costume';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '329.99',
                    url: 'http://www.buycostumes.com/p/33020/batman-dark-knight-batman-grand-heritage-collection-adult-costume',
                    image: 'http://images.buycostumes.com/mgen/merchandiser/batman-dark-knight-batman-grand-heritage-collection-adult-costume-bc-33020.jpg?zm=172,172,1,0,0',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Guardians of the Galaxy - Deluxe Rocket Raccoon Kids Costume';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '30.99',
                    url: 'http://www.buycostumes.com/p/806783/guardians-of-the-galaxy-deluxe-rocket-raccoon-kids-costume',
                    image: 'http://images.buycostumes.com/mgen/merchandiser/guardians-of-the-galaxy-deluxe-rocket-raccoon-kids-costume-bc-806783.jpg?zm=172,172,1,0,0',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
