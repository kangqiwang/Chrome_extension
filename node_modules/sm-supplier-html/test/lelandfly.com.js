var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://lelandfly.com/product/leland-sun-gaiter/"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Leland Neck/Face Sun Protector",
                    "price": "19.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://lelandfly.com/wp-content/uploads/2016/11/LELAND-BUFF-1-1-of-1-600x600.jpg',
                    "country": 'us',
                    "description": 'Product DescriptionProtection from the sun in style.  The Leland Sun Gaiter not only protects you from the elements, but it helps keep you cool and comfortable all day.The material used allows for both thermal and humidity transfer.  Meaning it’s perfect for both warm and cold environments.  It can be also worn multiple ways to fit your style and comfort.  We are a fan of pulling it up slightly over the back of your baseball hat when running in a flats boat.  Not only does it keep your hat in place and prevent it from flying off, but also protects the back of your neck.The pattern is based off a classic paisley with a fly fishing twist to it.  This warm red color really adds a pop to your photos as well!'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://lelandfly.com/product-category/packs-bags/packs-and-bags/"
        }

        it('should be true when correct category is returned', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Packs and Bags"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://lelandfly.com/?s=fish&post_type=product"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 12,
                    "pages": 42
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://lelandfly.com/?s=fish&post_type=product"
        }

        // Change to be the number of products on the page
        var x = 12;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Leland Neck/Face Sun Protector';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '19.99',
                    url: 'http://lelandfly.com/product/leland-sun-gaiter/',
                    image: 'http://lelandfly.com/wp-content/uploads/2016/11/LELAND-BUFF-1-1-of-1-300x300.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'The World-Famous Leland Trucker Hat';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '24.95',
                    url: 'http://lelandfly.com/product/the-world-famous-leland-trucker-hat/',
                    image: 'http://lelandfly.com/wp-content/uploads/2016/06/thumb2003-300x300.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
