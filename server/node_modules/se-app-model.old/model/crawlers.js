const Base = require('../lib/mongo/base');
const mongodb = require('mongodb');

class Crawlers extends Base {
    constructor(config) {
        super(config, 'crawler')
    }

    getCrawlers(payload, next) {
        var message = {
            status: payload.status,
            country: payload.country,
            sort: { lastRun: -1 }
        }

        this.find(message, next)
    }

    markComplete(payload, next) {
        var status = payload.status
        var updateStatus = {
            status: status
        }
        var updatePayload = {
            query: {
                _id: new mongodb.ObjectID( payload.id ),
            },
            update: {

                $set: updateStatus
            }
        }

        this.update(updatePayload, (err) => {
			next(err)
		})
    }
}

module.exports = Crawlers