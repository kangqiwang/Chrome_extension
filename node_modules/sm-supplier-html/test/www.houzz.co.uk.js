var should = require('should');
var Structure = require('../lib/structure.js')
let cache = require('../lib/cache')

describe('www.houzz.com', function () {

    this.timeout(10000);

    describe('In Stock Page', function () {

        var payload = {
            "pageType": "product",
            "url": "https://www.houzz.co.uk/product/104260555-umbra-gridart-photo-display-natural-43x43x3-cm-transitional-picture-frames",
            "html": cache.load("https://www.houzz.co.uk/product/104260555-umbra-gridart-photo-display-natural-43x43x3-cm-transitional-picture-frames")
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function (err, inStockPage) {
                var expected = JSON.stringify({
                    "name": "Umbra Gridart Photo Display, Natural, 43x43x3 cm",
                    "price": "27.95",
                    "url": "https://www.houzz.co.uk/product/104260555-umbra-gridart-photo-display-natural-43x43x3-cm-transitional-picture-frames",
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'https://st.hzcdn.com/simgs/f58192f00a26c947_9-1336/home-design.jpg',
                    "country": 'uk',
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    //    describe('Out of Stock Page', function() {

    //        var payload = {
    //            "pageType" : "product",
    //            "url" : "http://www.houzz.com/photos/695852/Byron-Armchair-Currently-out-of-stock-contemporary-armchairs-and-accent-chairs-other",
    //            "html": cache.load("http://www.houzz.com/photos/695852/Byron-Armchair-Currently-out-of-stock-contemporary-armchairs-and-accent-chairs-other")
    //        }

    //        it('should be false when product is in store only', function (done) {

    //            Structure(payload, function(err, inStockPage) {
    //                var expected = JSON.stringify({
    //                    "name": "Byron Armchair - Currently out of stock.",
    //                    "price": "999",
    //                    "url": null,
    //                    "inStock": false,
    //                    "stockLevel": null,
    //                    "image": 'https://st.hzcdn.com/simgs/8ee1fe7e0f686c5a_4-0318/contemporary-armchairs-and-accent-chairs.jpg',
    //                    "country": 'us',
    //                    "description": 'The Byron Armchair features a modern, yet traditional look and feel. We love that it keeps those old-fashioned little touches, but updates it with curved detail stitching and glossy leather. Quick growing pine is used for the frame and mature rubberwood for the legs. Rubberwood is sourced from old plantation trees that are usually burnt when their supply of rubber is exhausted, but this way they can be reused - itâ€™s one of the most environmentally friendly woods available. The cover is made from 100% genuine high-grade leather. All Armchairs: http://www.fashionforhome.com/armchairs-lounge-chairs'
    //                })
    //                JSON.stringify(inStockPage).should.equal(expected);
    //                done()
    //            })
    //        });

    //    });

  //  describe('Search page pagination', function () {

  //      var payload = {
  //          "pageType": "pagination",
  //          "url": "http://www.houzz.com/photos/kitchen-and-dining-furniture",
  //          "html": cache.load("http://www.houzz.com/photos/kitchen-and-dining-furniture")
  //      }

  //      it('should be true when number of items and pages correct', function (done) {

  //          Structure(payload, function (err, pagination) {
  //              var expected = JSON.stringify({
  //                  "items": 36,
  //                  "pages": 1445,
  //                  "url": "http://www.houzz.com/photos/kitchen-and-dining-furniture"
  //              })
  //              JSON.stringify(pagination).should.equal(expected);
  //              done()
  //          })
  //      });

  //  })

 //   describe('Search page category', function () {

 //       var payload = {
 //           "pageType": "category",
 //           "url": "http://www.houzz.com/photos/kitchen-and-dining-furniture",
 //           "html": cache.load("http://www.houzz.com/photos/kitchen-and-dining-furniture")
 //       }

 //       it('should be true when number of items and pages correct', function (done) {

 //           Structure(payload, function (err, category) {
 //               var expected = JSON.stringify({
 //                   "name": "Kitchen & Dining Furniture",
 //                   "url": "http://www.houzz.com/photos/kitchen-and-dining-furniture"
 //               })
 //               JSON.stringify(category).should.equal(expected);
 //               done()
 //           })
 //       });

  //  });


    describe('Search Page', function () {

        var payload = {
            "pageType": "search",
            "url": "https://www.houzz.co.uk/products/home-office-accessories",
            "html": cache.load("https://www.houzz.co.uk/products/home-office-accessories")
        }

        // Change to be the number of products on the page
        var x = 36;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function (err, result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Kram Telecom Charge Pit Mobile Device Charger, Arctic WhiteMore Colours';
        it('first product should be ' + firstProductName, function (done) {
            Structure(payload, function (err, result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '65.00',
                    url: 'https://www.houzz.co.uk/product/82792221-kram-telecom-charge-pit-mobile-device-charger-arctic-white-contemporary-charging-stations',
                    image: 'https://st.hzcdn.com/fimgs/40b1f404087ca628_1438-w233-h233-b1-p10--contemporary-charging-stations.jpg',
                    country: 'uk'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Vintage Red Double Memo Board';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function (err, result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '75.59',
                    url: 'https://www.houzz.co.uk/product/110493191-vintage-red-double-memo-board-industrial-noticeboards-and-blackboards',
                    image: 'https://st.hzcdn.com/fimgs/1d91d7fd0a5f265d_1627-w233-h233-b1-p10--industrial-noticeboards-blackboards.jpg',
                    country: 'uk'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
