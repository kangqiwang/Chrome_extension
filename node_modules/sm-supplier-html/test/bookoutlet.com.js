var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://bookoutlet.com/Store/Details/9781445401447B/1001-montres-des-modeles-de-1925-a-nos-jours"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "1001 Montres: Des Modeles De 1925 A Nos Jours (French Edition)",
                    "price": "6.99",
                    "url": "http://bookoutlet.com/Store/Details/9781445401447B/1001-montres-des-modeles-de-1925-a-nos-jours",
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://bookdepot.lmwv1z0x2r9fdffrc7q.netdna-cdn.com/covers/large/isbn978144/9781445401447-l.jpg',
                    "country": 'us',
                    "description": "Depuis l'apparition des montres-bracelets il y a pres d'un siecle, de nombreux modeles de montres fascinants ont ete crees et sont entres dans la legende. Cet ouvrage tres documente presente plus de mille montres avec leurs caracteristiques techniques, dont bien sur les grands classiques, mais egalement des creations originales et les dernieres collecitons des maitres horlogers. En plus de rappels historiques et techniques, l'amateur de montres trouvera ici de nombreux modeles speciaux qui ne manqueront pas de faire battre son coeur.",
                    "sku": "9781445401447B"
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://bookoutlet.com/Store/Browse?Nc=1&size=96&sort=title_0"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": "96",
                    "pages": "1"
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://bookoutlet.com/Store/Browse?Nc=1&size=96&sort=title_0"
        }

        it('should be true when the category is correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Antiques & Collectibles"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://bookoutlet.com/Store/Browse?Nc=1&size=96&sort=title_0"
        }

        // Change to be the number of products on the page
        var x = 48;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = '1001 Montres: Des Modeles De 1925 A Nos Jours (French Edition)';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '6.99',
                    url: 'http://bookoutlet.com/Store/Details/9781445401447B/1001-montres-des-modeles-de-1925-a-nos-jours',
                    image: 'http://bookdepot.lmwv1z0x2r9fdffrc7q.netdna-cdn.com/covers/large/isbn978144/9781445401447-l.jpg',
                    country: 'us',
                    sku: "9781445401447B"
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Wrist Watches';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '24.99',
                    url: 'http://bookoutlet.com/Store/Details/9788854408111B/wrist-watches',
                    image: 'http://bookdepot.lmwv1z0x2r9fdffrc7q.netdna-cdn.com/covers/large/isbn978885/9788854408111-l.jpg',
                    country: 'us',
                    sku: "9788854408111B"
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
