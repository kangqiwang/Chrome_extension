var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.williams-sonoma.com/products/peppermint-bark/?pkey=cview-all-sale&&cview-all-sale"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "The Original Peppermint Bark",
                    "price": "19.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://ab.wsimgs.com/wsimgs/ab/images/dp/wcm/201640/0007/the-original-peppermint-bark-c.jpg',
                    "country": 'us',
                    "description": 'Our nostalgic peppermint bark is often copied but never matched in quality or flavor. The once-a-year favorite is handcrafted using the finest ingredients, including custom-blended Guittard chocolate and triple-distilled oil of peppermint. Master candy makers pour a layer of melted dark chocolate on a marble table and then top it with a layer of creamy white chocolate. This “bark” is finished with a snowfall of handmade peppermint candy pieces. The result is an unforgettable holiday confection with a perfect harmony of flavors and textures in every bite. 1 lb. Made in USA. This item cannot be shipped to Hawaii but is available for purchase at our Honolulu retail store. Dark chocolate: sugar, chocolate liquor processed with potassium carbonate, cocoa butter, butter oil, lecithin (an emulsifier), pure vanilla, natural oil of peppermint. White chocolate: sugar, cocoa butter, milk, soya lecithin (an emulsifier), pure vanilla. Peppermint bits: sugar, corn syrup, oil of peppermint, FD&C Red #40. Contains milk, soy. This product is prepared and packaged using machines that may come in contact with wheat/gluten, peanuts, tree nuts. Shipping Information UPS can deliver most in-stock items within 4-5 business days. Shipping Rates The shipping rate varies depending on your order total and shipping destination. View Shipping Options and Charges. Next Day Delivery For an additional charge of $17.50 per address, we can expedite delivery to most destinations. This service is not available for some oversize items, items shipped directly from the supplier (including perishable and custom-manufactured items), out-of-stock items and items to be shipped outside the contiguous 48 states. Orders received by 9:00 p.m., Eastern time, Monday through Thursday will arrive the next business day; orders placed Friday through Sunday will arrive on the following Tuesday. Return Policy At Williams-Sonoma, we take great pride in the quality and craftsmanship of our products. Attention to design, materials, safety and construction are our priority. Upon receipt, please inspect your purchase and notify us of any damage; we will arrange for a prompt replacement. If within 30 days, you are dissatisfied for any reason, you may return your purchase for a refund of the merchandise value. An original receipt or gift receipt is required for all returns and exchanges. Returns with a gift receipt will be refunded in the form of a Merchandise Credit for the amount indicated on the gift receipt. Returns with original receipt will be refunded in the original form of payment, cash and check refunds over $100 will be issued as a company check (may take 14 business days from time of request). For all cutlery returns (knife sets, single knives, cutting boards, knife sharpeners, and knife storage) please contact us at 888.922.4108 to initiate the return. We cannot accept returns on monogrammed, personalized, special-order items, custom upholstery, food, items shipped direct from the vendor, or on items damaged through normal wear and tear. Final sale items ending in .97 or .99 cannot be returned. Made to Order and Final Sale Furniture items are non-returnable, and cannot be cancelled once the order is placed. For returns of items purchased from your Williams-Sonoma Gift Registry, we will gladly provide a refund or exchange for the merchandise within 90 days of your event or within 90 days of purchase, whichever date is later. View Full Return Policy.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    /*describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : ""
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "",
                    "price": "",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": '',
                    "country": '',
                    "description": ''
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });*/

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.williams-sonoma.com/shop/sale-special-offer/view-all-sale/?cm_type=gnav"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 120,
                    "pages": 4
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.williams-sonoma.com/shop/sale-special-offer/view-all-sale/?cm_type=gnav"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Sale & Offers"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.williams-sonoma.com/shop/sale-special-offer/view-all-sale/?cm_type=gnav"
        }

        // Change to be the number of products on the page
        var x = 120;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'The Original Peppermint Bark';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '19.99',
                    url: 'http://www.williams-sonoma.com/products/peppermint-bark/?pkey=cview-all-sale&&cview-all-sale',
                    image: 'http://ab.wsimgs.com/wsimgs/ab/images/dp/wcm/201648/0001/the-original-peppermint-bark-j.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Craft A Brew Gluten-Free Beer Making Kit';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '39.99',
                    url: 'http://www.williams-sonoma.com/products/craft-a-brew-gluten-free-beer-making-kit/?pkey=cview-all-sale&&cview-all-sale',
                    image: 'http://ab.wsimgs.com/wsimgs/ab/images/dp/wcm/201632/0038/img62j.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
