var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.horse.com/item/absorbine-flex-max-pellets/SLT901785/"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Absorbine Flex Max Pellets",
                    "price": "41.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://s7d5.scene7.com/is/image/PetsUnited/TSLT901785?wid=500&hei=500',
                    "country": 'us',
                    "description": "Product Summary:                                                                        \t\t\t                    Flex+Max™ by Absorbine®The pelleted Absorbine Flex Max formula has been optimized with higher levels of joint-sustaining ingredients to help preserve joint and connective tissue and help sustain strong bones. Flex+Max™ by Absorbine® contains high levels of Glucosamine, MSM, Chondroitin and Hyaluronic Acid (which help in the support of joint lubrication) as well as Boswellia, Flaxseed and Rice Bran (rich sources of Omega 3s). Features:    Highly concentrated with no fillers     No load-in dose requirement    Fenugreek flavor is tested as highly palatable     Can also be used for dogs     Approved by the NASC (National Animal Supplement Council)    Made in the USA Item Specifications:Active Ingredients per 75g serving:Flaxseed: 11gRice Bran: 5.6gGlucosamine HCl (Shellfish Source): 10,000mgMethylsulfonylmethane (MSM): 5,000mgChondroitin Sulfate (Porcine Source): 1,200mgHyaluronic Acid: 150mgBoswellia Serrata: 130:mgInactive Ingredients:Alfalfa Meal Dehydrated, Calcium Propionate (preservative), Fenugreek Seed, Yeast CultureDirections for use:Horses: Administer 75g (1 scoop) once daily.Animals: Administer 3.7g (¼ tsp) once daily for every 100 lb. up to 1,200 lb.Enclosed scoop holds approximately 75g when filled to top line.Sizes: 5 lb. (30-day supply)10 lb. (60-day supply)Warnings:For animal use only. Keep out of reach of children and other animals. In case of accidental overdose, contact a health professional immediately. This product should not be given to animals intended for human consumption.Safe use in pregnant animals or animals intended for breeding has not been proven. Consult with your veterinarian before using this product in animals: with clotting disorders; being treated with anticoagulant medications; diabetes, or any metabolic disorder causing hyperglycemia; history of urinary tract stones; known allergies to shellfish. If lameness worsens, discontinue use and contact your veterinarian. Administer during or after the animal has eaten to reduce incidence of gastrointestinal upset.For Label Information and MSDS Sheet, please click on Manufacturers Information to the right.                \t\t                                                \t\t\t                    Downloadable Resources                    Product Label - 30 DayManufacturer InformationProduct Label - 60 DayManufacturer InformationMSDS SheetManufacturer Information"
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.horse.com/supplements/see-all-supplements/596/"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 24,
                    "pages": 17
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.horse.com/supplements/see-all-supplements/596/"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Horse Supplements"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.horse.com/supplements/see-all-supplements/596/"
        }

        // Change to be the number of products on the page
        var x = 24;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Absorbine Flex Max Pellets';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '41.99',
                    url: 'www.horse.com/item/absorbine-flex-max-pellets/SLT901785/',
                    image: 'http://s7d5.scene7.com/is/image/PetsUnited/TSLT901785?wid=160&hei=160&fmt=jpeg&qlt=75,0&op_sharpen=0&resMode=sharp2&op_usm=0.9,1.0,6,0&iccEmbed=0&',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = "Majesty's Bio Plus Hoof Wafers";
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '21.69',
                    url: 'www.horse.com/item/majestys-bio-plus-hoof-wafers/SLT700334/',
                    image: 'http://s7d5.scene7.com/is/image/PetsUnited/TSLT700334?wid=160&hei=160&fmt=jpeg&qlt=75,0&op_sharpen=0&resMode=sharp2&op_usm=0.9,1.0,6,0&iccEmbed=0&',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
