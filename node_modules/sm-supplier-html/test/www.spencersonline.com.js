var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "https://www.spencersonline.com/product/fun-games/toys-figures/shop-all-toys-figures/nagisa-shiota-assassination-classroom-plush-toy/pc/1509/c/1586/sc/1587/143071.uts?thumbnailIndex=1"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Nagisa Shiota Assassination Classroom Plush Toy",
                    "price": "19.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'https://spencers.scene7.com/is/image/Spencers/07445604-a?$Detail$',
                    "country": 'us',
                    "description": 'Calm and collected, this Nagisa Shiota plush is just like the real thing! From his signature blue hair to his Kunugigaoka Junior High School uniform, this plush Nagisa might be ready to take down Korosensei.Officially licensedDimensions: 8"H x 4"WMaterial: PolyesterCare: Spot cleanImportedRead More Read Less'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "https://www.spencersonline.com/thumbnail/fun-games/toys-figures/shop-all-toys-figures/pc/1509/c/1586/1587.uts"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 72,
                    "pages": 10
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })
     describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "https://www.spencersonline.com/thumbnail/fun-games/toys-figures/shop-all-toys-figures/pc/1509/c/1586/1587.uts"
        }

        it('should be true when the category is correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Shop All Toys & Figures"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "https://www.spencersonline.com/thumbnail/fun-games/toys-figures/shop-all-toys-figures/pc/1509/c/1586/1587.uts"
        }

        // Change to be the number of products on the page
        var x = 24;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Nagisa Shiota Assassination Classroom Plush Toy';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '19.99',
                    url: 'www.spencersonline.com/product/fun-games/toys-figures/shop-all-toys-figures/nagisa-shiota-assassination-classroom-plush-toy/pc/1509/c/1586/sc/1587/143071.uts?thumbnailIndex=1',
                    image: 'https://spencers.scene7.com/is/image/Spencers/07445604-a?$Thumbnail$',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Harry Home Alone Figurine - 8 Inch';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '39.99',
                    url: 'www.spencersonline.com/product/fun-games/toys-figures/shop-all-toys-figures/harry-home-alone-figurine-8-inch/pc/1509/c/1586/sc/1587/141186.uts?thumbnailIndex=24',
                    image: 'https://spencers.scene7.com/is/image/Spencers/07434491-a?$Thumbnail$',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
