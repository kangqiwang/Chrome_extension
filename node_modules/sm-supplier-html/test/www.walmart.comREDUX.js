var should = require('should');
var Structure = require('../lib/structure.js')
const cache = require('../lib/cache.js')

describe('www.walmart.com', function () {

    before(function () {
            this.timeout(5000);
        }),

        describe('Search Page', function () {

            var payload = {
                "pageType": "search",
                "url": "https://www.walmart.com/browse/action-figures/all-action-figures/4171_4172_133130?page=1&povid=216950+%7C+2018-04-30+%7C+Action+Figures+-+feat+cat+tile#searchProductResult",
                "html": cache.load("https://www.walmart.com/browse/action-figures/all-action-figures/4171_4172_133130?page=1&povid=216950+%7C+2018-04-30+%7C+Action+Figures+-+feat+cat+tile#searchProductResult")
            }

            it('should return 40 products', function (done) {
                Structure(payload, function (err, result) {
                    result.length.should.equal(40);
                    done()
                })
            });

            it('LAST product should be', function (done) {
                Structure(payload, function (err, result) {
                    var last = result.pop()
                    var expected = JSON.stringify({
                        barcode: '0639725141646',
                        name: 'TekNmotion Nibru TM-NIBCK1 Backlit Gaming Keyboard, Black',
                        price: '39.99',
                        url: 'https://www.walmart.com/ip/TekNmotion-Nibru-TM-NIBCK1-Backlit-Gaming-Keyboard-Black/47770529',
                        image: 'https://i5.walmartimages.com/asr/b6566982-4ca0-4305-b627-25958c5ac72d_1.a0a16ffbea5d52da6120b84cb7021946.jpeg?odnHeight=180&odnWidth=180&odnBg=ffffff',
                        country: 'us',
                        sku: '47770529',
                        "productId": "2MR1FVIHP0SV",
                        "usItemId": "47770529",
                        "description": "<li>3 backlight colors</li><li>10 additional media keys</li><li>Braided cable</li>",
                        "customerRating": 4.75,
                        "numReviews": 4,
                        "sellerId": "D162AC788E5E427D92C82D3AEC1966D4",
                        "sellerName": "DeepDiscount",
                        "enableAddToCart": false,
                        "canAddToCart": false,
                        "showPriceAsAvailable": true,
                        "seeAllName": "Wireless Keyboards",
                        "seeAllLink": "cat_id=3944_3951_132959_1008621_7450208_4442",
                        "itemClassId": "19",
                        "primaryOffer": {
                            "offerId": "646AEAFD49134373AEBEB3BAFE0924D0",
                            "offerPrice": 39.99,
                            "listPrice": 44.99,
                            "currencyCode": "USD",
                            "savingsAmount": 5,
                            "showWasPrice": false
                        },
                        "fulfillment": {
                            "isS2H": true,
                            "isS2S": false,
                            "isSOI": false,
                            "isPUT": false,
                            "s2HDisplayFlags": ["MARKETPLACE", "FREE_SHIPPING"]
                        },
                        "inventory": {
                            "availableOnline": true
                        },
                        "quantity": 9,
                        "blitzItem": false,
                        "marketPlaceItem": true,
                        "twoDayShippingEligible": false,
                        "pickupDiscountEligible": false,
                        "shippingPassEligible": false,
                        "preOrderAvailable": false,
                        "categories": {
                            level1: 'Electronics',
                            level2: 'Computers',
                            level3: 'PC Gaming',
                            level4: 'PC Gaming Peripherals & Accessories',
                            level5: 'PC Gaming Keyboards'
                        }
                    })

                    JSON.stringify(last).should.equal(expected)
                    done()
                });
            })

            it('FIRST product should be a', function (done) {

                Structure(payload, function (err, result) {

                    var first = result.shift()
                    var expected = JSON.stringify({
                        barcode: '0813682020101',
                        name: 'Steel Series Apex 100 Illuminate Gaming Keyboard',
                        price: '29.77',
                        url: 'https://www.walmart.com/ip/Steel-Series-Apex-100-Illuminate-Gaming-Keyboard/197738272',
                        image: 'https://i5.walmartimages.com/asr/af1d2ef4-9630-4308-902a-fcad93b55df8_1.00c132b1ee92dd99c5b89d992ee4d308.jpeg?odnHeight=180&odnWidth=180&odnBg=ffffff',
                        country: 'us',
                        sku: '197738272',
                        "productId": "35XHPXKQKKS7",
                        "usItemId": "197738272",
                        "description": "Steel Series Apex 100 Illuminate Gaming Keyboard",
                        "customerRating": 3.25,
                        "numReviews": 4,
                        "sellerId": "F55CDC31AB754BB68FE0B39041159D63",
                        "sellerName": "Walmart.com",
                        "enableAddToCart": false,
                        "canAddToCart": false,
                        "showPriceAsAvailable": true,
                        "seeAllName": "PC Gaming Accessories",
                        "seeAllLink": "cat_id=2636_1077504_1225012",
                        "itemClassId": "19",
                        "primaryOffer": {
                            "offerId": "3C1A098247764D47B6FBDEB4E531C864",
                            "offerPrice": 29.77,
                            "currencyCode": "USD"
                        },
                        "fulfillment": {
                            "isS2H": true,
                            "isS2S": true,
                            "isSOI": false,
                            "isPUT": true,
                            "s2SDisplayFlags": ["PICKUP_TODAY"]
                        },
                        "inventory": {
                            "availableOnline": true
                        },
                        "quantity": 49,
                        "blitzItem": false,
                        "marketPlaceItem": false,
                        "twoDayShippingEligible": true,
                        "pickupDiscountEligible": false,
                        "shippingPassEligible": false,
                        "preOrderAvailable": false,
                        "categories": {
                            level1: 'Electronics',
                            level2: 'Computers',
                            level3: 'PC Gaming',
                            level4: 'PC Gaming Peripherals & Accessories',
                            level5: 'PC Gaming Keyboards'
                        }

                    })

                    JSON.stringify(first).should.equal(expected)
                    done()
                })

            })

        });


    // describe('In Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : "https://www.walmart.com/ip/V7-Apple-iPhone-6-Shatterproof-Tempered-Glass-Screen-Protector/42496603?action=product_interest&action_type=title&beacon_version=1.0.1&bucket_id=irsbucketdefault&client_guid=813ab43c-b3b7-4e8e-83f0-316e6bf39ec1&config_id=2&customer_id_enc=&findingMethod=p13n&guid=813ab43c-b3b7-4e8e-83f0-316e6bf39ec1&parent_anchor_item_id=45462880&parent_item_id=45462880&placement_id=irs-2-m2&reporter=recommendations&source=new_site&strategy=PWVAV&visitor_id=dw4E62AacTHCLz7vpZOM8Q"
    //     }

    //     it('should be true when product is in stock', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "iPhone 6 V7 shatterproof tempered glass screen protector",
    //                 "price": "8.41",
    //                 "url": null,
    //                 "inStock": true,
    //                 "stockLevel": null,
    //                 "image": 'https://i5.wal.co/asr/6879a3dc-5930-4f9d-be93-bd93ace0557a_1.e1dfa76c000ff7939a2399108a7a4c2c.jpeg?odnHeight=450&odnWidth=450&odnBg=FFFFFF',
    //                 "country": 'us',
    //                 "description": 'About this item        Important Made in USA Origin Disclaimer:        For certain items sold by Walmart on Walmart.com, the displayed country of origin        information may not be accurate or consistent with manufacturer information.        For updated, accurate country of origin data, it is        recommended that you rely on product packaging or manufacturer information.      Protect your phone from unwanted damage with the V7 Apple iPhone 6 Screen Protector. The anti-fingerprint and smudge-proof translucent material features an Oleophobic coating for a consistently crystal-clear view of your device. The tempered glass screen protector, constructed from shatterproof and scratch-proof glass with a 9H hardness rating, provides protection from a variety of damaging sources including keys, pens, nails, falls and more. The edge of the material is also beveled so there are no sharp edges, which provides for safe handling, application and use with your device. The shatterproof screen protector offers consistent optical clarity and touchscreen responsiveness. It is also designed for quick and easy installation for a seamless and bubble-free fit from edge to edge. Handle your device with confidence knowing this product protects the touchscreen glass surface from damage caused by accidental bumps, scrapes, drops and falls. The V7 Apple iPhone 6 Screen Protector safeguards your device from a variety of impacts and scratches without sacrificing the clarity and function you expect from a smartphone.V7 iPhone 6 Shatterproof Tempered Glass Screen Protector: Shatterproof and scratch-proof design with 9H hardness rated tempered glass Anti-fingerprint and smudge-proof with Oleophobic coating Optical clarity and touchscreen responsiveness Shatterproof screen protector with safety beveled edge Easy and bubble-free installation for a seamless fit'
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });


    // describe('Pre-order Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : "https://www.walmart.com/ip/Ubisoft-Placeholder-2-Xbox-One/45630796"
    //     }

    //     it('should return false when product is only available for pre-order', function(done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "Tom Clancy's Ghost Recon Wildlands (Xbox One)",
    //                 "price": "59.96",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": 'https://i5.wal.co/asr/499cbb6c-5d68-4680-82eb-14a760082856_1.50700464ca8cd22ea079de5851731ad3.jpeg?odnHeight=450&odnWidth=450&odnBg=FFFFFF',
    //                 "country": 'us',
    //                 "description": 'About this item        Important Made in USA Origin Disclaimer:        For certain items sold by Walmart on Walmart.com, the displayed country of origin        information may not be accurate or consistent with manufacturer information.        For updated, accurate country of origin data, it is        recommended that you rely on product packaging or manufacturer information.      Experience total freedom of choice in Tom Clancy\'s Ghost Recon Wildlands, the ultimate military shooter set in a massive open world setting. The Santa Blanca drug cartel has transformed the beautiful South American country of Bolivia into a perilous narco-state, leading to lawlessness, fear, and rampant violence. With their corrosive influence growing, the cartel plagues the citizens of Bolivia but all hope is not lost. The Ghosts, an elite US Special Forces team, are tasked to combat the cartel and save the country from collapse. You decide how to play, and every decision affects the world around you.  THE ULTIMATE MILITARY SHOOTER SET IN AN OPEN WORLD - Giving you total freedom of choice to decide how to play. YOU DECIDE YOUR ATTACK PLAN - Play every mission the way you want. Utilize stealth, execute tactical plans or come out guns blazing. YOU DECIDE WHERE TO EXPLORE - the diverse Bolivian weather and terrain will impact your world and gameplay. YOU DECIDE THE CARTEL\'S FATE - Infiltrate enemy territories and take down cartel leaders to break the hostile Santa Blanca organization. YOU DECIDE YOUR GHOSTS - Lead your Ghost team solo or join friends in seamless drop-in, drop-out co-op. PRE-ORDER FOR BONUS MISSION: THE PERUVIAN CONNECTION - Travel to the high mountains of Bolivia to break the deadly alliance between the Santa Blanca and the Peruvian Cartels. ESRB Rating: RATING PENDING'
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     })

    // })


    describe('Out of Stock Page', function () {

        var payload = {
            "pageType": "product",
            "url": "https://www.walmart.com/ip/Ion-IPA18B-House-Party/26095115",
            "html": cache.load("https://www.walmart.com/ip/Ion-IPA18B-House-Party/26095115")
        }

        it('should return false when product is out of stock', function (done) {

            Structure(payload, function (err, inStockPage) {
                var expected = JSON.stringify({
                    "name": "Ion IPA18B House PartyIon IPA18B House Party",
                    "price": "9.00",
                    "url": payload.url,
                    "inStock": false,
                    "stockLevel": null,
                    "image": 'https://i5.walmartimages.com/asr/068d2bad-90be-41bb-9a74-629d6e82a06c_1.7ab8d9af6ceeae3e8eccb065cbe0a9f2.jpeg?odnHeight=450&odnWidth=450&odnBg=FFFFFF',
                    "country": 'us',
                    "description": ""
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        })

    })

    // describe('This item is no longer available page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : "https://www.walmart.com/ip/Barbie-2-Story-Beach-House/19476672"
    //     }

    //     it('should return false when product is out of stock', function(done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "Barbie 2-Story Beach House",
    //                 "price": '41.70',
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": 'https://i5.wal.co/asr/3bea7303-33a4-4e8b-8a05-ef621e49d851_1.ca91105eef837c9a172f8f52bf5f57f7.jpeg?odnHeight=450&odnWidth=450&odnBg=FFFFFF',
    //                 "country": 'us',
    //                 "description": 'About this itemWarning - Choking Hazard - Children Under 3This toy is not suitable for ages under 3 years. It contains one or more of the following items: marbles, small ball, or small parts.        Important Made in USA Origin Disclaimer:        For certain items sold by Walmart on Walmart.com, the displayed country of origin        information may not be accurate or consistent with manufacturer information.        For updated, accurate country of origin data, it is        recommended that you rely on product packaging or manufacturer information.      With two stories and four areas of play in the Barbie beach house, the fun never ends. The living room of the Barbie doll house is the perfect spot to lounge, with a sofa and flat-screen TV. The kitchen features typical appliances and a window bar for dining outside. The bathroom and spiral staircase add practical fun play areas and bookend the bedroom, which has a foldout bed that\'s ideal for doll sleepovers. Girls can arrange and rearrange the furniture and accessories for endless fun with the Barbie beach house. Barbie 2-Story Beach House: Two stories and four areas of play Barbie beach house features a living room, kitchen, bathroom and bedroom 20-plus play pieces Sturdy plastic construction Note: Dolls are not included with this Barbie 2-story house'
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     })

    // })

    // describe('Refurbished', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : "http://www.walmart.com/ip/Samsung-Galaxy-Wireless-Charging-Pad-w-Micro-USB-Charger-Black-EP-PG920IBUGUS-Refurbished/186561779"
    //     }

    //     it('should return false when product is out of stock', function(done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "Samsung Galaxy Wireless Charging Pad w/ Micro USB Charger Black *EP-PG920IBUGUS (Refurbished)",
    //                 "price": '7.99',
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": 'https://ll-us-i5.wal.co/asr/8104eee2-862a-4f3c-be89-67e11420fb82_1.2708525c880e70f223ea184146724534.jpeg?odnHeight=450&odnWidth=450&odnBg=FFFFFF',
    //                 "country": 'us'
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     })

    // })

    //     describe('Description', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : "https://www.walmart.com/ip/V7-Apple-iPhone-6-Shatterproof-Tempered-Glass-Screen-Protector/42496603?action=product_interest&action_type=title&beacon_version=1.0.1&bucket_id=irsbucketdefault&client_guid=c0c53c45-36f2-476b-8465-5552e2a62d42&config_id=2&customer_id_enc=&findingMethod=p13n&guid=c0c53c45-36f2-476b-8465-5552e2a62d42&parent_anchor_item_id=45462880&parent_item_id=45462880&placement_id=irs-2-m2&reporter=recommendations&source=new_site&strategy=PWVAV&visitor_id=dw4E62AacTHCLz7vpZOM8Q"
    //     }

    //     it('should return false when product is out of stock', function(done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": '',
    //                 "url": null,
    //                 "inStock": true,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": 'us',
    //                 "description": "dafas"
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     })

    // })

    // describe('Search page pagination', function() {

    //     var payload = {
    //         "pageType" : "pagination",
    //         "url" : "https://www.walmart.com/browse/cell-phones/battery-extenders/1105910_133161_1072307"
    //     }

    //     it('should be true when number of items and pages correct', function (done) {

    //         Structure(payload, function(pagination) {
    //             var expected = JSON.stringify({
    //                 "items": 40,
    //                 "pages": 7
    //             })
    //             JSON.stringify(pagination).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    // describe('Search page category', function() {

    //     var payload = {
    //         "pageType" : "search",
    //         "url" : "https://www.walmart.com/browse/electronics/gaming-keyboards/3944_3951_7052607_9433123_9135152",
    //         "html" :cache.load("https://www.walmart.com/browse/electronics/gaming-keyboards/3944_3951_7052607_9433123_9135152")
    //     }

    //     it('should be true when the category is correct', function (done) {

    //         Structure(payload, function(err, category) {
    //             var expected = JSON.stringify({
    //                 "name": "Battery Extenders"
    //             })
    //             JSON.stringify(category).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    // describe('Checking to see if no pgination works', function() {

    //     var payload = {
    //         "pageType" : "pagination",
    //         "url" : "https://www.walmart.com/"
    //     }

    //     it('should return 0/null items and null pages', function (done) {

    //         Structure(payload, function(pagination) {
    //             var expected = JSON.stringify({
    //                 "items": null,
    //                 "pages": null
    //             })
    //             JSON.stringify(pagination).should.equal(expected);
    //             done()
    //         })
    //     });

    // })


});