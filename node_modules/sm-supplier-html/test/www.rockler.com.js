var should = require('should');
var Structure = require('../lib/structure.js')

describe('www.rockler.com', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.rockler.com/table-top-fasteners"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Table Top Fasteners",
                    "price": "2.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://assets.rockler.com/media/catalog/product/cache/1/image/364x364/9df78eab33525d08d6e5fb8d27136e95/3/4/34215-05-1000.jpg',
                    "country": 'us',
                    "description": "These Table Top Fasteners provide a sturdy connection between the tabletop and apron, while still allowing the top to expand and contract with seasonal humidity changes. This prevents cracks from forming over time. The table clips slip neatly into a groove in the apron and attach to the tabletop with a single screw-simple, efficient and strong. Heavy gauge steel ensures a sturdy connection.Technical Details: Table top clips are made of extra heavy #A gauge cold rolled steel with a bright steel finish.Screws are included.Each tabletop fastener measures 5/8\" width x 1-1/4\" length.Tabletop fasteners are screwed to underside of table and hook into a 3/32\" slot on the apron, which allows for expansion and contraction of tabletop. (8) Table Top Fasteners and screws Brand: Rockler Weight (lbs): 0.2000 Hardware Type: Fasteners Table Top Fasteners Datasheet"
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.rockler.com/walnut-turning-blank-4-w-x-4-w-x-8-l"
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Walnut Turning Blank, 4'' W x 4'' W x 8'' L",
                    "price": "15.99",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": 'http://assets.rockler.com/media/catalog/product/cache/1/image/364x364/9df78eab33525d08d6e5fb8d27136e95/5/7/57825-02-1000.jpg',
                    "country": 'us',
                    "description": "Perfectly dimensioned to accept our Stainless Steel Turning Insert (#46371, sold separately), or our Travel Mug Turning Kit (#27188, sold separately). Whatever you end up using it for, the large blank provides a broad canvas for showing off its excellent grain and your turning prowess. When used for a mug or vase, it's a great way to hone your hollowing skills. Of course, the blank can also be subdivided for smaller turning projects if desired. Air-dried for the finest color.Note: Exact blank size may vary, but will not be less than 3-1/2'' x 3-1/2'' x 7-1/2''. (1) Walnut Turning Blank, 4''W x 4''W x 8''L Nominal Dimensions: 4'' x 4'' x 8''Minimum Dimensions: 3-1/2'' x 3-1/2'' x 7-1/2''Species: Walnut Manufacturer Part Number: 57825 Weight (lbs): 3.0400"
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.rockler.com/hardware/project-hardware?limit=96"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 96,
                    "pages": 3
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.rockler.com/hardware/project-hardware?limit=96"
        }

        // Change to be the number of products on the page
        var x = 96;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Corner Guards for Pullout Shelf, Pair';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '4.99',
                    url: 'http://www.rockler.com/corner-guards-for-pullout-shelf-pair',
                    image: 'http://assets.rockler.com/media/catalog/product/cache/1/small_image/295x295/9df78eab33525d08d6e5fb8d27136e95/5/7/57772-01-1000.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Mini-Flocker Suede-Tex Fibers & Adhesive - Navy Blue';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '13.99',
                    url: 'http://www.rockler.com/mini-flocker-suede-fibers-and-adhesive-suede-tex-adhesives-navy-blue',
                    image: 'http://assets.rockler.com/media/catalog/product/cache/1/small_image/295x295/9df78eab33525d08d6e5fb8d27136e95/3/5/35880-02-1000.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });
     describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.rockler.com/hardware/project-hardware?limit=96"
        }

        it('should be true when the category is correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Project Hardware"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

});
