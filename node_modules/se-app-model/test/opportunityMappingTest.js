const should = require('should');
const OpportuntiyModel = require('../index.js').model.opportunity

const config = require('../config').es;

var payload = {
        country: "uk",
        userName: "newuser99"
}


describe('Opportunity Test', function() {
        this.timeout(10000)
        it('Given A New User, When Create User Index Then err is null and true is returned', function(done) {
                var Opportunity = new OpportuntiyModel(config, payload)

                Opportunity.createUserIndex((err, result) => {
                    should(err).be.equal(null)
                    console.log(result)
                    result.should.be.equal(true)
                    done();
                })
        })

        it('Given User Index Exists, When we try and Create User Index Then ERROR_USER_EXISTS is returned', function(done) {
                var Opportunity = new OpportuntiyModel(config, payload)

                Opportunity.createUserIndex((err, result) => {
                    should(err).be.equal('ERROR_USER_EXISTS')
                    done();
                })

        })

        it('GIVEN User Index Exists, WHEN we Delete User Index THEN err is null and true is returned', function(done) {
                var Opportunity = new OpportuntiyModel(config, payload)

                Opportunity.delUserIndex('opportunity-' + payload.userName + '-uk', (err, result) => {
                    should(err).be.equal(null)
                    result.should.be.equal(true)
                    Opportunity.delUserIndex('opportunity-wishlist-' + payload.userName + '-uk', (err, result) => {
                        should(err).be.equal(null)
                        result.should.be.equal(true)
                        done();
                    })
                })

        })


})
