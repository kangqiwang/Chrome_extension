/**
 * Split an ES bulk data array into smaller "chunks" but ensure the last record doesn't break an action/data boundary
 */
module.exports = (arr, maxLen) => {
	var a = arr;

	var arrays = [];

	while (a.length > 0) {
		let offset = (a.length > maxLen &&
			a[maxLen - 1].hasOwnProperty('action') &&
			a[maxLen - 1].action !== 'delete') ? maxLen + 1 : maxLen;
		arrays.push(a.splice(0, offset));
	}
	return arrays;
};
