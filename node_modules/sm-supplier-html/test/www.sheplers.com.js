var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.sheplers.com/Scully-Long-Belted-Leather-Jacket/21944.pro?parentCategoryId=2&categoryId=112&subCategoryId=573"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Scully Long Belted Leather Jacket",
                    "price": "315.20",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://d5n0lf4gshqmd.cloudfront.net/img/225C55_41_p1/470/575/i.jpg',
                    "country": 'us',
                    "description": 'A trendy, belted leather jacket by ScullyGenuine leather jacket with genuine leather beltNotched lapels with button front placketTwo open front pocketsStraight back yokeFIT NOTE: Lightly shapedLong length for added coverageOur Scully Leather jacket is expertly crafted of genuine leather to make you feel at home on the range or in the finest of places. Jacket measures 33 1/2\" long (from collar to back hem). 100% polyester lining. Imported. Sizes: S(4-6), M(8-10), L(12-14), XL(16-18), XXL(20).'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.sheplers.com/Womens/Womens-Jackets-Coats/View-All-Womens-Jackets-Coats/pc/2/c/112/573.thm"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 51,
                    "pages": 11
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.sheplers.com/Womens/Womens-Jackets-Coats/View-All-Womens-Jackets-Coats/pc/2/c/112/573.thm"
        }

        // Change to be the number of products on the page
        var x = 51;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Ariat Team Logo Soft Shell Jacket';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '94.95',
                    url: 'http://www.sheplers.com/Ariat-Team-Logo-Soft-Shell-Jacket/30409.pro?parentCategoryId=2&categoryId=112&subCategoryId=573',
                    image: 'http://d5n0lf4gshqmd.cloudfront.net/img/268523_89_p1/225/290/i.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = "Cripple Creek Women's Metallic Leather Open Front Draped Jacket";
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '157.49',
                    url: 'http://www.sheplers.com/Cripple-Creek-Womens-Metallic-Leather-Open-Front-Draped-Jacket/45461.pro?parentCategoryId=2&categoryId=112&subCategoryId=573',
                    image: 'http://d5n0lf4gshqmd.cloudfront.net/img/225H25_89_p1/225/290/i.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.sheplers.com/Womens/Womens-Jackets-Coats/View-All-Womens-Jackets-Coats/pc/2/c/112/573.thm"
        }

        it('should be true when the category is correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "All Women's Coats & Jackets"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

});
