var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.mountainhardwear.com/scrambler-30-outdry-backpack-1586171.html?cgid=equipment-packs-backpacking&dwvar_1586171_variationColor=011"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Scrambler™ 30 OutDry® Backpack",
                    "price": "130.00",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://s7d5.scene7.com/is/image/ColumbiaSportswear2/1586171_011_f?$ALL_pdpalt$',
                    "country": 'us',
                    "description": 'DetailsGuaranteed watertight OutDry® construction main compartment and seam taped top pocket, rain room tested for 24 hoursHardWave suspension conforms comfortably to the curve of your back and distributes weight evenlyEasy access hydration sleeve with drainage under top pocketRope strap under top pocketSide compression straps keep any size load stableTwo deep side pockets for water bottles or other gearPadded shoulder straps provide excellent fit and comfortStowable webbing belt adds stability when neededAdjustable sternum strap adds stability while on the moveCarry loops for ice axes or trekking polesReinforced gear loops on lower sides of pack offer clip points for climbing gear or carrying skis A-frameMaterials        Fabric Accent: Air MeshFabric Body: 400D HD NylonMeasurements        Apparel Fit: EquipmentPack Weight Regular: 1 lb 11 oz / 770 gPack Capacity Regular: 1805 cu in / 30 ltrPack Dim Regular: 22 in x 11 in x 10 in / 55 cm x 28 cm x 24 cmPack Torso Regular: 16 in - 22 in / 41 cm - 56 cmPack Waist Regular: 25 in - 37 in / 64 cm - 94 cmTechnologyOutDryTraditional “waterproof” gloves quickly get heavy as water loads between the shell fabric and the waterproof liner. OutDry® is different. OutDry® is a patented construction technology that bonds a waterproof-breathable membrane directly to the shell fabric. There’s no gap to load with water so gloves stay, light and dry. And with no extra layer of water, gloves breathe better and stay flexible. OutDry technology for packs uniformly laminates a custom shaped waterproof membrane to the inner surface of the pack, sealing fabrics and seams in a single step. Your pack stays light and dry without compromising weight or function.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    // describe('Out of Stock Page', function() {

    //     var payload = {
    //         "pageType" : "product",
    //         "url" : ""
    //     }

    //     it('should be false when product is in store only', function (done) {

    //         Structure(payload, function(inStockPage) {
    //             var expected = JSON.stringify({
    //                 "name": "",
    //                 "price": "",
    //                 "url": null,
    //                 "inStock": false,
    //                 "stockLevel": null,
    //                 "image": '',
    //                 "country": '',
    //                 "description": ''
    //             })
    //             JSON.stringify(inStockPage).should.equal(expected);
    //             done()
    //         })
    //     });

    // });

    // describe('Search page pagination', function() {

    //     var payload = {
    //         "pageType" : "pagination",
    //         "url" : ""
    //     }

    //     it('should be true when number of items and pages correct', function (done) {

    //         Structure(payload, function(pagination) {
    //             var expected = JSON.stringify({
    //                 "items": "",
    //                 "pages": ""
    //             })
    //             JSON.stringify(pagination).should.equal(expected);
    //             done()
    //         })
    //     });

    // })

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.mountainhardwear.com/hiking-backpacks/"
        }

        // Change to be the number of products on the page
        var x = 14;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Scrambler™ 30 OutDry® Backpack';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '130.00',
                    url: 'http://www.mountainhardwear.com/scrambler-30-outdry-backpack-1586171.html?cgid=equipment-packs-backpacking&dwvar_1586171_variationColor=011',
                    image: 'http://s7d5.scene7.com/is/image/ColumbiaSportswear2/1586171_011_f?$MHW_grid$&align=0,1',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'Backpack Rain Cover 10-30L';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '22.00',
                    url: 'http://www.mountainhardwear.com/backpack-rain-cover-10-30l-1573653.html?dwvar_1573653_variationColor=342&cgid=equipment-packs-backpacking',
                    image: 'http://s7d5.scene7.com/is/image/ColumbiaSportswear2/1573653_342_f?$MHW_grid$&align=0,1',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });
    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.mountainhardwear.com/hiking-backpacks/"
        }

        it('should be true when the category is correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name":  "Packs & Luggage"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

});
