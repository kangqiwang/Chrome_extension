var should = require('should');
var Structure = require('../lib/structure.js')

describe('replaceWithwebAddress', function() {

    this.timeout(10000);

    describe('In Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.booksamillion.com/p/John/Beth-Moore/9780805448122?id=6803458689176"
        }

        it('should be true when product is in stock', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "John : 90 Days with the Beloved Disciple",
                    "price": "24.99",
                    "url": null,
                    "inStock": true,
                    "stockLevel": null,
                    "image": 'http://covers3.booksamillion.com/covers/bam/0/80/544/812/0805448128_b.jpg',
                    "country": 'us',
                    "description": 'Best-selling author Beth Moore has a remarkable gift for crafting insightful Bible character studies. Millions have been drawn to her inspired lessons, and the media has called her "America s Bible teacher." The PERSONAL REFLECTIONS series continues to reintroduce Beth s most beloved character-driven books, expanding them into 90-day experiences that include nearly all of the text from her original work, plus thoughtful questions and journal space to engage readers throughout this special time of study.John is the new presentation of Moore s enduring favorite, "The Beloved Disciple." The young gospel writer followed Jesus all the years of His ministry, experiencing more miracles, displays of power, and perfect love than he could fathom. And just as Christ led John into the depths of His love, that same journey is here for us, His beloved.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Out of Stock Page', function() {

        var payload = {
            "pageType" : "product",
            "url" : "http://www.booksamillion.com/p/Person-Community/John-Paul-II/9780820414461?id=6803458689176"
        }

        it('should be false when product is in store only', function (done) {

            Structure(payload, function(inStockPage) {
                var expected = JSON.stringify({
                    "name": "Person and Community",
                    "price": "41.95",
                    "url": null,
                    "inStock": false,
                    "stockLevel": null,
                    "image": 'http://covers2.booksamillion.com/covers/bam/0/82/041/446/0820414468_b.jpg',
                    "country": 'us',
                    "description": 'This item is Non-Returnable.'
                })
                JSON.stringify(inStockPage).should.equal(expected);
                done()
            })
        });

    });

    describe('Search page pagination', function() {

        var payload = {
            "pageType" : "pagination",
            "url" : "http://www.booksamillion.com/search?id=6803458689176&query=john&where=All"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(pagination) {
                var expected = JSON.stringify({
                    "items": 20,
                    "pages": 39323
                })
                JSON.stringify(pagination).should.equal(expected);
                done()
            })
        });

    })

    describe('Search page category', function() {

        var payload = {
            "pageType" : "category",
            "url" : "http://www.booksamillion.com/search?query=music&Ntk=all-alt&N=25207&Ntt=music&Ntx=mode%2Bmatchpartialmax&Ne=12&sort=bestselling&DDTN=Entertainment&DDLN=Browse-Pop-Music&id=6803458689176"
        }

        it('should be true when number of items and pages correct', function (done) {

            Structure(payload, function(category) {
                var expected = JSON.stringify({
                    "name": "Music"
                })
                JSON.stringify(category).should.equal(expected);
                done()
            })
        });

    });

    describe('Search Page', function() {

        var payload = {
            "pageType" : "search",
            "url" : "http://www.booksamillion.com/features?cat=electronic-gifts&id=6994358012026"
        }

        // Change to be the number of products on the page
        var x = 85;
        it('should return ' + x + ' numer of products', function (done) {
            Structure(payload, function(result) {
                result.length.should.equal(x);
                done()
            })
        });

        var firstProductName = 'Crosley Cruiser Deluxe with Bluetooth - Black ';
        it('first product should be ' + firstProductName, function(done) {
            Structure(payload, function(result) {
                var first = result.shift()
                var expected = JSON.stringify({
                    barcode: null,
                    name: firstProductName,
                    price: '69.95',
                    url: 'http://www.booksamillion.com/p/Crosley-Cruiser-Deluxe-Bluetooth-Black/Crosley/F710244209359?id=6994358012026',
                    image: 'http://covers4.booksamillion.com/covers/gift/7/10/244/209/710244209359_w.jpg',
                    country: 'us'
                })
                JSON.stringify(first).should.equal(expected)
                done()
            })

        })

        var lastProductName = 'CandyShell Clear iPhone SE/5/5s Case - Onyx Black';
        it('last product should be ' + lastProductName, function (done) {
            Structure(payload, function(result) {
                var last = result.pop()
                var expected = JSON.stringify({
                    barcode: null,
                    name: lastProductName,
                    price: '34.95',
                    url: 'http://www.booksamillion.com/p/CandyShell-Clear-iPhone-SE55s-Case/Speck/F848709033956?id=6994358012026',
                    image: 'http://covers1.booksamillion.com/covers/gift/8/48/709/033/848709033956_w.jpg',
                    country: 'us'
                })

                JSON.stringify(last).should.equal(expected)
                done()
            });
        })

    });

});
